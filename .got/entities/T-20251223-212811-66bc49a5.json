{
  "_checksum": "46c5519c64a50af6",
  "_written_at": "2025-12-23T21:59:19.401297+00:00",
  "data": {
    "created_at": "2025-12-23T21:28:11.698664+00:00",
    "description": "## Overview\n\nRefactor the monolithic `scripts/got_utils.py` (6,200+ lines) into modular CLI components under `cortical/got/cli/`, following the pattern established with `doc_utils.py` \u2192 `cortical/got/cli/doc.py`.\n\n## Background & Rationale\n\nFrom session discussion (2025-12-23):\n- User asked: \"do we really want to rely on the scripts folder for application logic?\"\n- Decision: scripts/ should be thin entry points; substantial logic belongs in cortical/\n- Pattern established: `cortical/got/cli/doc.py` (711 lines) with thin wrapper in scripts/\n\n**Why this matters:**\n1. **Testability** - CLI modules in cortical/ can be unit tested with imports\n2. **Discoverability** - `got_utils.py --help` shows all capabilities\n3. **Separation** - Library logic vs CLI vs entry points clearly separated\n4. **Future-proofing** - Enables `pip install` entry points via pyproject.toml\n\n## Current State (got_utils.py)\n\n```\nscripts/got_utils.py (6,236 lines)\n\u251c\u2500\u2500 Imports & Constants (1-100)\n\u251c\u2500\u2500 Backend Classes (1407-2761)\n\u2502   \u251c\u2500\u2500 TransactionalGoTAdapter (~400 lines)\n\u2502   \u2514\u2500\u2500 GoTProjectManager (~900 lines)\n\u251c\u2500\u2500 Query Language (~200 lines)\n\u251c\u2500\u2500 Command Handlers (4386-5702)\n\u2502   \u251c\u2500\u2500 cmd_task_* (~15 functions)\n\u2502   \u251c\u2500\u2500 cmd_sprint_* (~8 functions)\n\u2502   \u251c\u2500\u2500 cmd_handoff_* (~6 functions)\n\u2502   \u251c\u2500\u2500 cmd_decision_* (~4 functions)\n\u2502   \u2514\u2500\u2500 cmd_backup_*, cmd_validate, etc.\n\u251c\u2500\u2500 Argparse Setup (5751-6036)\n\u2514\u2500\u2500 Main Router (6054-6203)\n```\n\n## Target Architecture\n\n```\ncortical/got/cli/\n\u251c\u2500\u2500 __init__.py          # Re-exports all setup/handle functions\n\u251c\u2500\u2500 doc.py               # \u2705 DONE (711 lines) - Document commands\n\u251c\u2500\u2500 task.py              # Task commands (cmd_task_*)\n\u251c\u2500\u2500 sprint.py            # Sprint commands (cmd_sprint_*)\n\u251c\u2500\u2500 handoff.py           # Handoff commands (cmd_handoff_*)\n\u251c\u2500\u2500 decision.py          # Decision commands (cmd_decision_*)\n\u251c\u2500\u2500 query.py             # Query language commands\n\u251c\u2500\u2500 backup.py            # Backup/restore commands\n\u2514\u2500\u2500 shared.py            # Common utilities, formatters\n\nscripts/got_utils.py     # Thin dispatcher (~200 lines max)\n```\n\n## Implementation Process (Proven Pattern)\n\nUse sub-agent orchestration as done for doc.py:\n\n### Phase 1: Research (Explore agent)\n- Map current got_utils.py structure\n- Identify handler function boundaries\n- Find shared utilities to extract\n\n### Phase 2: Implementation (General-purpose agents, parallelizable)\n- Create each CLI module (task.py, sprint.py, etc.)\n- Each follows pattern: `setup_*_parser()`, `handle_*_command()`, `cmd_*()` handlers\n- Extract shared utilities to shared.py\n- Update got_utils.py to import and dispatch\n\n### Phase 3: Testing (General-purpose agents, parallel)\n- Unit tests for each module (mocked manager)\n- Integration tests for CLI invocation\n- Verify backwards compatibility\n\n### Phase 4: Review (General-purpose agent)\n- Code quality review\n- Pattern consistency check\n- Test coverage verification\n\n## Handler Function Signature (MUST FOLLOW)\n\n```python\ndef cmd_task_create(args, manager: GoTProjectManager) -> int:\n    \"\"\"Handle 'got task create' command.\"\"\"\n    # ... implementation\n    return 0  # 0 = success, 1+ = error\n```\n\n## Integration Pattern\n\n```python\n# In cortical/got/cli/task.py\ndef setup_task_parser(subparsers) -> None:\n    \"\"\"Configure task subcommand parser.\"\"\"\n    parser = subparsers.add_parser(\"task\", help=\"Task management\")\n    task_sub = parser.add_subparsers(dest=\"task_command\")\n    # ... add subcommands\n\ndef handle_task_command(args, manager) -> int:\n    \"\"\"Route task subcommand.\"\"\"\n    if args.task_command == \"create\":\n        return cmd_task_create(args, manager)\n    # ...\n\n# In scripts/got_utils.py (thin dispatcher)\nfrom cortical.got.cli.task import setup_task_parser, handle_task_command\nfrom cortical.got.cli.sprint import setup_sprint_parser, handle_sprint_command\n# ...\n\ndef main():\n    parser = argparse.ArgumentParser()\n    subparsers = parser.add_subparsers(dest=\"command\")\n    \n    setup_task_parser(subparsers)\n    setup_sprint_parser(subparsers)\n    setup_doc_parser(subparsers)\n    # ...\n    \n    if args.command == \"task\":\n        return handle_task_command(args, manager)\n    elif args.command == \"sprint\":\n        return handle_sprint_command(args, manager)\n    # ...\n```\n\n## Acceptance Criteria\n\n- [ ] Each subcommand (task, sprint, handoff, decision, backup, query, doc) has own module\n- [ ] scripts/got_utils.py reduced to <300 lines (dispatcher only)\n- [ ] All existing CLI commands work identically\n- [ ] Unit tests for each CLI module (>80% coverage)\n- [ ] Integration tests verify CLI invocation\n- [ ] Code review passes\n\n## Reference Files\n\n- **Pattern example:** `cortical/got/cli/doc.py` (711 lines)\n- **Thin wrapper:** `scripts/doc_utils.py` (19 lines)\n- **Tests:** `tests/unit/test_cli_doc.py`, `tests/integration/test_cli_doc_integration.py`\n- **Code review:** `docs/code-review-cli-doc-refactoring.md`\n\n## Estimated Scope\n\n| Module | Estimated Lines | Handlers |\n|--------|-----------------|----------|\n| task.py | ~800 | 15 cmd_task_* |\n| sprint.py | ~400 | 8 cmd_sprint_* |\n| handoff.py | ~350 | 6 cmd_handoff_* |\n| decision.py | ~200 | 4 cmd_decision_* |\n| query.py | ~250 | Query language |\n| backup.py | ~200 | Backup/restore |\n| shared.py | ~300 | Formatters, utils |\n\nTotal: ~2,500 lines in cli/, ~200 lines dispatcher\n\n## Notes\n\n- Backend classes (TransactionalGoTAdapter, GoTProjectManager) may stay in got_utils.py initially or move to cortical/got/\n- Consider phased approach: one module at a time with tests\n- Maintain backwards compatibility throughout",
    "entity_type": "task",
    "id": "T-20251223-212811-66bc49a5",
    "metadata": {
      "completed_at": "2025-12-23T21:59:19.392886+00:00",
      "updated_at": "2025-12-23T21:59:19.392889+00:00"
    },
    "modified_at": "2025-12-23T21:59:19.401238+00:00",
    "priority": "high",
    "properties": {
      "category": "feature",
      "retrospective": "Refactored got_utils.py into modular CLI components. Created 7 new files under cortical/got/cli/. All 8229 tests pass."
    },
    "status": "completed",
    "title": "Refactor got_utils.py into cortical/got/cli/ modules",
    "version": 4
  }
}