{
  "version": 1,
  "session_id": "6b01",
  "started_at": "2025-12-17T02:51:33.834930",
  "saved_at": "2025-12-17T11:13:56.053243",
  "tasks": [
    {
      "id": "T-20251217-025133-6b01-001",
      "title": "Replace broad except Exception blocks with specific exception handling",
      "status": "pending",
      "priority": "high",
      "category": "bugfix",
      "description": "Found multiple 'except Exception:' blocks in wal.py, cli_wrapper.py, state_storage.py, mcp_server.py, and ml_experiments modules that could hide bugs and make debugging difficult. Replace these with specific exception types that are actually expected.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:51:33.835462",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025138-6b01-002",
      "title": "Fix MetricsCollector thread-safety documentation",
      "status": "pending",
      "priority": "medium",
      "category": "docs",
      "description": "The MetricsCollector class comment says 'Thread-safe for single-threaded use' which is contradictory and confusing. Should clarify that thread safety is NOT guaranteed and external locking is required for multi-threaded use.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:51:38.298085",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025153-6b01-003",
      "title": "Implement LRU eviction for query expansion cache",
      "status": "pending",
      "priority": "high",
      "category": "feature",
      "description": "The _query_expansion_cache has _query_cache_max_size=100 defined but there's no actual LRU eviction logic. The cache can grow unbounded. Implement proper LRU cache behavior using collections.OrderedDict or functools.lru_cache.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:51:53.060012",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025157-6b01-004",
      "title": "Add input validation for graph_boosted_search weight parameters",
      "status": "pending",
      "priority": "medium",
      "category": "bugfix",
      "description": "The graph_boosted_search function accepts pagerank_weight and proximity_weight parameters but doesn't validate that their sum is <= 1.0. This could lead to unexpected scoring behavior where the base score is over-weighted or under-weighted.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:51:57.601737",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025201-6b01-005",
      "title": "Bound MetricsCollector timing history to prevent memory growth",
      "status": "pending",
      "priority": "high",
      "category": "bugfix",
      "description": "MetricsCollector.operations stores all timings in an unbounded list (op_data['timings']). For long-running processes, this can cause memory growth. Should implement circular buffer or rolling window for timing history.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:01.729330",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025215-6b01-006",
      "title": "Extract common document name boost logic from search functions",
      "status": "pending",
      "priority": "low",
      "category": "refactor",
      "description": "find_documents_for_query and fast_find_documents have nearly identical document name boosting code (~30 lines each). Extract this into a shared helper function to reduce code duplication and simplify maintenance.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:15.027619",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025219-6b01-007",
      "title": "Factor out common PageRank iteration logic",
      "status": "pending",
      "priority": "low",
      "category": "refactor",
      "description": "compute_pagerank, compute_semantic_pagerank, and compute_hierarchical_pagerank all contain similar iteration loops (70+ lines each). Consider extracting the core iteration logic into a shared helper to reduce code duplication.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:19.074954",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025222-6b01-008",
      "title": "Consider making JSON the default persistence format over pickle",
      "status": "pending",
      "priority": "medium",
      "category": "security",
      "description": "Pickle format is deprecated in the codebase due to security concerns (arbitrary code execution risk) with deprecation warnings. Consider making JSON/StateLoader the default format to improve security posture. Currently pickle remains the default despite deprecation.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:22.784767",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025238-6b01-009",
      "title": "Add configurable thresholds to replace hard-coded magic numbers",
      "status": "pending",
      "priority": "low",
      "category": "feature",
      "description": "Various functions have hard-coded thresholds (e.g., max_bigrams_per_term=100, max_bigrams_per_doc=500, candidate_multiplier=3). Consider making these configurable via CorticalConfig or function parameters for better tunability.\n\n**PRIMARY REASON:** Developer reliability. Magic numbers scattered throughout the codebase make it difficult for developers to understand, tune, and maintain the system. When thresholds need to change, developers must search the entire codebase to find all instances. Centralizing these in CorticalConfig improves discoverability and reduces the risk of inconsistent changes.\n\n**Note:** Low priority - address when touching related code.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:38.483580",
      "updated_at": "2025-12-17T10:36:00.000000",
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025242-6b01-010",
      "title": "Add integration tests for checkpoint resume functionality",
      "status": "pending",
      "priority": "medium",
      "category": "test",
      "description": "The compute_all checkpoint/resume feature (_save_checkpoint, _load_checkpoint_progress, resume_from_checkpoint) is implemented but could use more comprehensive integration tests to verify the full checkpoint-resume workflow survives crashes properly.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:42.907200",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025247-6b01-011",
      "title": "Add type annotations for return types in to_dict methods",
      "status": "pending",
      "priority": "low",
      "category": "docs",
      "description": "Several to_dict() methods (in Minicolumn, HierarchicalLayer, CorticalConfig) return Dict but could have more specific type hints like Dict[str, Any] or TypedDict for better IDE support and documentation.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:52:47.659523",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025300-6b01-012",
      "title": "Add docstrings to private methods in processor module",
      "status": "pending",
      "priority": "low",
      "category": "docs",
      "description": "Some private methods in processor/*.py modules (_apply_score_adjustments, _boost_overlapping_docs, etc.) lack comprehensive docstrings. Adding documentation would improve maintainability.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:53:00.861321",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025305-6b01-013",
      "title": "Consider async support for large corpus processing",
      "status": "pending",
      "priority": "low",
      "category": "feature",
      "description": "For processing very large corpora, async/await support could improve throughput. Functions like add_documents_batch and compute_all could benefit from async patterns for parallel document processing.\n\n**IMPLEMENTATION NOTES:**\n- This should only be performed on a DEDICATED THREAD\n- Do NOT process documents in batches within async (defeats the purpose)\n- Use threading.Thread or concurrent.futures.ThreadPoolExecutor\n- Keep the main processing loop synchronous; only offload I/O-bound operations\n- Consider using asyncio.to_thread() for CPU-bound operations if Python 3.9+\n\n**Complexity Warning:** This is a major architectural change. Should only be undertaken with dedicated time and thorough testing.",
      "depends_on": [],
      "effort": "high",
      "created_at": "2025-12-17T02:53:05.028714",
      "updated_at": "2025-12-17T10:36:00.000000",
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025310-6b01-014",
      "title": "Add logging level configuration guidance",
      "status": "pending",
      "priority": "low",
      "category": "docs",
      "description": "Some info-level log messages (e.g., in compute_all, save_processor) might be better as debug-level for production use. Add documentation about recommended logging configuration for different environments.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:53:10.051261",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025321-6b01-015",
      "title": "Add validation for division by zero in scoring calculations",
      "status": "pending",
      "priority": "medium",
      "category": "bugfix",
      "description": "Several scoring calculations in analysis modules use division operations (e.g., normalized_score = score / max_score). Add explicit checks for division by zero to prevent runtime errors when max_score is 0.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:53:21.701901",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-025325-6b01-016",
      "title": "Add performance benchmarks for common operations",
      "status": "pending",
      "priority": "medium",
      "category": "test",
      "description": "Add automated benchmark tests that track performance of key operations (compute_all, find_documents_for_query, process_document) to detect performance regressions. Could use pytest-benchmark or a simple timing framework.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T02:53:25.283102",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-103523-6b01-017",
      "title": "Phase out pickle persistence in favor of JSON format (SEC-003)",
      "status": "pending",
      "priority": "high",
      "category": "security",
      "description": "## PKL SECURITY ISSUES SUMMARY\n\n**Critical Security Vulnerability (RCE):**\nPython's `pickle.load()` can execute arbitrary code during deserialization. If an attacker controls a .pkl file, they achieve Remote Code Execution.\n\n**Current Mitigations (Partial):**\n1. DeprecationWarning in persistence.py (lines 133-140, 216-224)\n2. HMAC signature verification option (SEC-003) - but optional\n3. StateWriter/StateLoader JSON alternative exists (state_storage.py)\n\n**Affected Files:**\n- cortical/persistence.py: pickle.dumps (line 158), pickle.loads (line 247)\n- cortical/processor/persistence_api.py: save() and load() use pkl by default\n- scripts/index_codebase.py: corpus_dev.pkl\n- scripts/search_codebase.py: loads corpus_dev.pkl\n- tests/: Various test files reference .pkl\n\n## PROPOSED MIGRATION PATH\n\n**Phase 1: Deprecation Period (Current State)**\n- pkl works but emits DeprecationWarning \u2705 DONE\n- JSON alternative available via save_json()/load_json() \u2705 DONE\n- migrate_pkl_to_json() function available \u2705 DONE\n\n**Phase 2: Default Switch (This Task)**\n1. Update persistence.py to default to JSON format\n2. Update index_codebase.py to use chunk-based JSON by default\n3. Add --format=pkl flag for backward compatibility\n4. Update documentation to recommend JSON\n\n**Phase 3: Removal (Future)**\n1. Remove pkl support entirely\n2. Remove HMAC verification (no longer needed)\n3. Remove migration functions\n\n## IMPLEMENTATION CHECKLIST\n- [ ] Change save() default to JSON format\n- [ ] Change load() to auto-detect format (JSON vs pkl)\n- [ ] Update scripts/index_codebase.py default\n- [ ] Update scripts/search_codebase.py\n- [ ] Add format auto-detection logic\n- [ ] Update CLAUDE.md to document JSON preference\n- [ ] Add migration guide to docs/",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T10:35:23.351953",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-111334-6b01-018",
      "title": "Add regression tests for edge cases identified in code review",
      "status": "pending",
      "priority": "high",
      "category": "test",
      "description": "Create regression tests for the following edge cases found during code review:\n\n## Cache/Memory Bounds\n- Empty cache behavior for query expansion (T-003)\n- MetricsCollector with empty/single operation timing history (T-005)\n\n## Division by Zero\n- Scoring calculations when max_score is 0 (T-015)\n- TF-IDF normalization with empty corpus\n\n## Validation Edge Cases\n- graph_boosted_search with pagerank_weight + proximity_weight > 1.0 (T-004)\n- Empty query strings\n- top_n = 0 or negative\n\n## Persistence Edge Cases\n- Load pkl file with tampered HMAC\n- Load JSON with missing required fields\n- Auto-detection of format when file extension doesn't match content\n\n## Checkpoint Resume\n- Resume with corrupted checkpoint file (T-010)\n- Resume when underlying data has changed\n\nPriority: Focus on tests that prevent silent failures and data corruption.",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T11:13:34.889388",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    },
    {
      "id": "T-20251217-111356-6b01-019",
      "title": "Book generation system improvements and documentation",
      "status": "pending",
      "priority": "medium",
      "category": "docs",
      "description": "## BOOK GENERATION SYSTEM OVERVIEW\n\nThe Living Book is auto-generated from codebase artifacts by `scripts/generate_book.py`.\n\n### Generators (11 implemented + 1 placeholder):\n\n| Generator | Output Dir | Source |\n|-----------|-----------|--------|\n| AlgorithmChapterGenerator | 01-foundations | docs/VISION.md algorithm sections |\n| ModuleDocGenerator | 02-architecture | .ai_meta files from cortical/ |\n| DecisionStoryGenerator | 03-decisions | ADR files in samples/decisions/ |\n| CommitNarrativeGenerator | 04-evolution | Git history (commits, refactors, bugfixes) |\n| CaseStudyGenerator | 05-case-studies | ML sessions/chats, synthesized debug stories |\n| PlaceholderGenerator | 05-future | PLACEHOLDER - needs implementation |\n| ExerciseGenerator | 08-exercises | Generated exercises from concepts |\n| ReaderJourneyGenerator | 09-journey | Personalized learning paths |\n| ConceptEvolutionGenerator | 07-concepts | Concept clusters from Louvain |\n| SearchIndexGenerator | (index) | Semantic search data |\n| MarkdownBookGenerator | BOOK.md | Compiled full book |\n\n### Current State:\n- 05-future chapter is placeholder only\n- Most generators are functional\n- BOOK.md exceeds 256KB (needs chunking for review)\n\n### Future Work (NOT FOR NOW):\n1. Implement FutureChapterGenerator to extract roadmap from tasks/\n2. Add book quality metrics\n3. Create inter-chapter cross-references\n4. Generate book TOC with reading time estimates\n\n### Guidance for Future Claude Sessions:\n- Run `python scripts/generate_book.py --dry-run` to see what would be generated\n- Each generator has `generate()` method that returns {files, stats, errors}\n- Generators use frontmatter with tags for searchability\n- CALI store provides ML data for case studies\n- Book is meant to be read, not just generated - focus on readability",
      "depends_on": [],
      "effort": "medium",
      "created_at": "2025-12-17T11:13:56.053152",
      "updated_at": null,
      "completed_at": null,
      "context": {},
      "retrospective": null
    }
  ]
}