{
  "hash": "425ffdf05c7359ce86e9a6411b532886d4be286f",
  "message": "Merge pull request #72 from scrawlsbenches/claude/director-agent-continuation-iwpfO",
  "author": "scrawlsbenches",
  "timestamp": "2025-12-14 04:48:10 -0500",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    ".claude/prompts/director-agent-continuation.md",
    ".gitignore",
    "CLAUDE.md.potential",
    "cortical/persistence.py",
    "cortical/proto/__init__.py",
    "cortical/proto/schema.proto",
    "cortical/proto/serialization.py",
    "requirements.txt",
    "samples/customer_service/README.md",
    "samples/customer_service/account_management_faq.txt",
    "samples/customer_service/connectivity_network_troubleshooting.txt",
    "samples/customer_service/customer_feedback_survey_guide.txt",
    "samples/customer_service/electronics_product_faq.txt",
    "samples/customer_service/email_response_templates.txt",
    "samples/customer_service/login_access_troubleshooting.txt",
    "samples/customer_service/payment_billing_troubleshooting.txt",
    "samples/customer_service/privacy_data_security_policy.txt",
    "samples/customer_service/return_refund_policy.txt",
    "samples/customer_service/service_level_agreement.txt",
    "samples/customer_service/shipping_delivery_policy.txt",
    "samples/customer_service/software_installation_troubleshooting.txt",
    "samples/customer_service/software_product_faq.txt",
    "samples/customer_service/subscription_service_faq.txt",
    "tests/unit/test_protobuf_serialization.py"
  ],
  "insertions": 2777,
  "deletions": 127,
  "hunks": [
    {
      "file": ".claude/prompts/director-agent-continuation.md",
      "function": null,
      "start_line": 1,
      "lines_added": [],
      "lines_removed": [
        "# Director Agent Continuation Prompt",
        "",
        "You are resuming as the Director Agent for the Cortical Text Processor project.",
        "",
        "## Session Summary (2025-12-14)",
        "",
        "**Branch:** `claude/setup-director-agent-01337m9RiUZqGyckcS4Q6tWR`",
        "**Last Commit:** `78b3041` - feat: Complete 7 parallel tasks via Director Agent orchestration",
        "",
        "### Completed Work (7 tasks, ~4,700 lines added)",
        "",
        "| Task | Deliverable | Tests |",
        "|------|-------------|-------|",
        "| #206-P2 | `save_json()`, `load_json()`, `migrate_to_json()` in processor.py | 23 |",
        "| T-8d66-001 | `scripts/session_context.py` - agent handoff summaries | 23 |",
        "| T-8d66-003 | Checkpointing for `compute_all()` with resume support | 14 |",
        "| T-8d66-004 | `scripts/suggest_tasks.py` - auto-suggest follow-up tasks | 37 |",
        "| T-1a1d-001 | 2.78x search speedup via `name_tokens` caching | 4 |",
        "| T-e233-03 | Crash recovery tests (13 tests, 0 bugs found) | 13 |",
        "| T-6ac7-06 | Task retrospective metadata in `task_utils.py` | 20 |",
        "",
        "**All 134 new tests passing.**",
        "",
        "### Key Files Modified",
        "",
        "```",
        "cortical/processor.py     +250 lines (JSON persistence, checkpointing)",
        "cortical/minicolumn.py    +name_tokens field",
        "cortical/query/search.py  Uses cached name_tokens",
        "scripts/task_utils.py     +retrospective metadata",
        "scripts/session_context.py (new, 473 lines)",
        "scripts/suggest_tasks.py  (new, 588 lines)",
        "```",
        "",
        "### Workflow Learnings",
        "",
        "**What worked:**",
        "- Wave-based parallelization (5 agents in Wave 1, non-overlapping files)",
        "- Clear task decomposition with file scope boundaries",
        "- Dependency ordering (Wave 2 waited for Wave 1 on processor.py)",
        "",
        "**Areas to improve:**",
        "- Add quick review step between waves",
        "- Run smoke tests after each wave",
        "- Limit processor.py changes to one wave",
        "",
        "### Suggested Follow-Up Tasks",
        "",
        "| ID | Title | Priority | Rationale |",
        "|----|-------|----------|-----------|",
        "| T-new-001 | Add `clear_checkpoint()` method | Low | Checkpoints accumulate, need cleanup |",
        "| T-new-002 | Integration test for checkpoint + resume | Medium | Only unit tests, need e2e crash sim |",
        "| T-new-003 | Performance regression baseline | Medium | Hot path modified, no perf check done |",
        "",
        "### Remaining Backlog (from TASK_LIST.md)",
        "",
        "| # | Task | Priority |",
        "|---|------|----------|",
        "| 133 | WAL + snapshot persistence | Medium |",
        "| 134 | Protobuf serialization | Medium |",
        "| 135 | Chunked parallel compute_all() | Medium |",
        "| 95 | Split processor.py into modules | Medium |",
        "",
        "### Quick Commands",
        "",
        "```bash",
        "# Run all new tests",
        "python -m pytest tests/unit/test_processor_json_persistence.py tests/unit/test_session_context.py tests/unit/test_compute_checkpointing.py tests/unit/test_suggest_tasks.py tests/unit/test_task_retrospective.py tests/integration/test_task_recovery.py -v",
        "",
        "# Generate session context",
        "python scripts/session_context.py",
        "",
        "# Check for suggested tasks",
        "python scripts/suggest_tasks.py --all",
        "",
        "# Run smoke tests",
        "python -m pytest tests/smoke/ -v",
        "```",
        "",
        "### How to Continue",
        "",
        "1. Read `CLAUDE.md` for project conventions",
        "2. Run `python scripts/session_context.py` for latest status",
        "3. Check `tasks/*.json` for pending work",
        "4. Choose next task group and delegate to sub-agents",
        "",
        "",
        "*Generated by Director Agent session 01337m9RiUZqGyckcS4Q6tWR*"
      ],
      "context_before": [],
      "context_after": [],
      "change_type": "delete"
    },
    {
      "file": ".gitignore",
      "function": "CodeCoverage/",
      "start_line": 80,
      "lines_added": [
        "",
        "# Generated protobuf code (regenerated at runtime from schema.proto)",
        "cortical/proto/schema_pb2.py",
        "cortical/proto/__pycache__/"
      ],
      "lines_removed": [],
      "context_before": [
        "[Bb]uild[Ll]og.*",
        "",
        "# NUnit",
        "*.VisualState.xml",
        "TestResult.xml",
        "nunit-*.xml",
        "# Indexer progress files",
        ".index_progress.json",
        ".index_incremental_progress.json",
        "tasks/.current_session.json"
      ],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "cortical/persistence.py",
      "function": "Supports:",
      "start_line": 11,
      "lines_added": [
        "from .proto import PROTOBUF_AVAILABLE, serialize_state, deserialize_state",
        "    verbose: bool = True,",
        "    format: str = 'pickle'",
        "        format: Serialization format ('pickle' or 'protobuf'). Default: 'pickle'",
        "",
        "    Raises:",
        "        ValueError: If format is not 'pickle' or 'protobuf'",
        "        ImportError: If format='protobuf' but protobuf package is not installed",
        "    if format not in ['pickle', 'protobuf']:",
        "        raise ValueError(f\"Invalid format '{format}'. Must be 'pickle' or 'protobuf'.\")",
        "",
        "    if format == 'pickle':",
        "        # Original pickle serialization",
        "        state = {",
        "            'version': '2.2',",
        "            'layers': {},",
        "            'documents': documents,",
        "            'document_metadata': document_metadata or {},",
        "            'embeddings': embeddings or {},",
        "            'semantic_relations': semantic_relations or [],",
        "            'metadata': metadata or {}",
        "        }",
        "        # Serialize layers",
        "        for layer_enum, layer in layers.items():",
        "            state['layers'][layer_enum.value] = layer.to_dict()",
        "",
        "        with open(filepath, 'wb') as f:",
        "            pickle.dump(state, f, protocol=pickle.HIGHEST_PROTOCOL)",
        "",
        "    elif format == 'protobuf':",
        "        # Protocol Buffers serialization (text format for git-friendliness)",
        "        if not PROTOBUF_AVAILABLE:",
        "            raise ImportError(",
        "                \"protobuf package is required for Protocol Buffers serialization. \"",
        "                \"Install it with: pip install protobuf\"",
        "            )",
        "        text_output = serialize_state(",
        "            layers, documents, document_metadata,",
        "            embeddings, semantic_relations, metadata",
        "        )",
        "",
        "        with open(filepath, 'w', encoding='utf-8') as f:",
        "            f.write(text_output)",
        "        logger.info(f\"✓ Saved processor to {filepath} (format: {format})\")",
        "    verbose: bool = True,",
        "    format: Optional[str] = None",
        "        format: Serialization format ('pickle' or 'protobuf'). If None, auto-detect.",
        "        ValueError: If layer values are invalid (must be 0-3) or format is invalid",
        "        ImportError: If format='protobuf' but protobuf package is not installed",
        "    # Auto-detect format if not specified",
        "    if format is None:",
        "        # Try to detect based on file content",
        "        with open(filepath, 'rb') as f:",
        "            # Read first few bytes",
        "            header = f.read(64)",
        "",
        "            # Pickle files start with 0x80 (protocol marker)",
        "            if header[0:1] == b'\\x80':",
        "                format = 'pickle'",
        "            else:",
        "                # Protobuf text format starts with readable text like \"version:\" or \"layers {\"",
        "                # Check if it looks like text (ASCII/UTF-8)",
        "                try:",
        "                    header_text = header.decode('utf-8')",
        "                    if 'version' in header_text or 'layers' in header_text:",
        "                        format = 'protobuf'",
        "                    else:",
        "                        # Default to pickle for unknown formats",
        "                        format = 'pickle'",
        "                except UnicodeDecodeError:",
        "                    # Binary content - assume pickle",
        "                    format = 'pickle'",
        "",
        "    if format not in ['pickle', 'protobuf']:",
        "        raise ValueError(f\"Invalid format '{format}'. Must be 'pickle' or 'protobuf'.\")",
        "",
        "    if format == 'pickle':",
        "        # Original pickle deserialization",
        "        with open(filepath, 'rb') as f:",
        "            state = pickle.load(f)",
        "",
        "        # Reconstruct layers",
        "        layers = {}",
        "        for level_value, layer_data in state.get('layers', {}).items():",
        "            # Validate layer value before creating enum",
        "            level_int = int(level_value)",
        "            if level_int not in [0, 1, 2, 3]:",
        "                raise ValueError(",
        "                    f\"Invalid layer value {level_int} in saved state. \"",
        "                    f\"Layer values must be 0-3 (TOKENS=0, BIGRAMS=1, CONCEPTS=2, DOCUMENTS=3).\"",
        "                )",
        "            layer = HierarchicalLayer.from_dict(layer_data)",
        "            layers[CorticalLayer(level_int)] = layer",
        "",
        "        documents = state.get('documents', {})",
        "        document_metadata = state.get('document_metadata', {})",
        "        embeddings = state.get('embeddings', {})",
        "        semantic_relations = state.get('semantic_relations', [])",
        "        metadata = state.get('metadata', {})",
        "",
        "    elif format == 'protobuf':",
        "        # Protocol Buffers deserialization (text format)",
        "        if not PROTOBUF_AVAILABLE:",
        "            raise ImportError(",
        "                \"protobuf package is required for Protocol Buffers deserialization. \"",
        "                \"Install it with: pip install protobuf\"",
        "        with open(filepath, 'r', encoding='utf-8') as f:",
        "            proto_text = f.read()",
        "",
        "        layers, documents, document_metadata, embeddings, semantic_relations, metadata = deserialize_state(proto_text)",
        "        logger.info(f\"✓ Loaded processor from {filepath} (format: {format})\")"
      ],
      "lines_removed": [
        "    verbose: bool = True",
        "    state = {",
        "        'version': '2.2',",
        "        'layers': {},",
        "        'documents': documents,",
        "        'document_metadata': document_metadata or {},",
        "        'embeddings': embeddings or {},",
        "        'semantic_relations': semantic_relations or [],",
        "        'metadata': metadata or {}",
        "    }",
        "    # Serialize layers",
        "    for layer_enum, layer in layers.items():",
        "        state['layers'][layer_enum.value] = layer.to_dict()",
        "    with open(filepath, 'wb') as f:",
        "        pickle.dump(state, f, protocol=pickle.HIGHEST_PROTOCOL)",
        "        logger.info(f\"✓ Saved processor to {filepath}\")",
        "    verbose: bool = True",
        "        ValueError: If layer values are invalid (must be 0-3)",
        "    with open(filepath, 'rb') as f:",
        "        state = pickle.load(f)",
        "",
        "    # Reconstruct layers",
        "    layers = {}",
        "    for level_value, layer_data in state.get('layers', {}).items():",
        "        # Validate layer value before creating enum",
        "        level_int = int(level_value)",
        "        if level_int not in [0, 1, 2, 3]:",
        "            raise ValueError(",
        "                f\"Invalid layer value {level_int} in saved state. \"",
        "                f\"Layer values must be 0-3 (TOKENS=0, BIGRAMS=1, CONCEPTS=2, DOCUMENTS=3).\"",
        "        layer = HierarchicalLayer.from_dict(layer_data)",
        "        layers[CorticalLayer(level_int)] = layer",
        "    documents = state.get('documents', {})",
        "    document_metadata = state.get('document_metadata', {})",
        "    embeddings = state.get('embeddings', {})",
        "    semantic_relations = state.get('semantic_relations', [])",
        "    metadata = state.get('metadata', {})",
        "        logger.info(f\"✓ Loaded processor from {filepath}\")"
      ],
      "context_before": [
        "\"\"\"",
        "",
        "import pickle",
        "import json",
        "import os",
        "import logging",
        "from typing import Dict, Optional, Any",
        "",
        "from .layers import CorticalLayer, HierarchicalLayer",
        "from .minicolumn import Minicolumn"
      ],
      "context_after": [
        "",
        "logger = logging.getLogger(__name__)",
        "",
        "",
        "def save_processor(",
        "    filepath: str,",
        "    layers: Dict[CorticalLayer, HierarchicalLayer],",
        "    documents: Dict[str, str],",
        "    document_metadata: Optional[Dict[str, Dict[str, Any]]] = None,",
        "    embeddings: Optional[Dict[str, list]] = None,",
        "    semantic_relations: Optional[list] = None,",
        "    metadata: Optional[Dict] = None,",
        ") -> None:",
        "    \"\"\"",
        "    Save processor state to a file.",
        "",
        "    Args:",
        "        filepath: Path to save file",
        "        layers: Dictionary of all layers",
        "        documents: Document collection",
        "        document_metadata: Per-document metadata (source, timestamp, etc.)",
        "        embeddings: Graph embeddings for terms (optional)",
        "        semantic_relations: Extracted semantic relations (optional)",
        "        metadata: Optional processor metadata (version, settings, etc.)",
        "        verbose: Print progress",
        "    \"\"\"",
        "",
        "",
        "",
        "    if verbose:",
        "        total_cols = sum(len(layer.minicolumns) for layer in layers.values())",
        "        total_conns = sum(layer.total_connections() for layer in layers.values())",
        "        logger.info(f\"  - {len(documents)} documents\")",
        "        logger.info(f\"  - {total_cols} minicolumns\")",
        "        logger.info(f\"  - {total_conns} connections\")",
        "        if embeddings:",
        "            logger.info(f\"  - {len(embeddings)} embeddings\")",
        "        if semantic_relations:",
        "            logger.info(f\"  - {len(semantic_relations)} semantic relations\")",
        "",
        "",
        "def load_processor(",
        "    filepath: str,",
        ") -> tuple:",
        "    \"\"\"",
        "    Load processor state from a file.",
        "",
        "    Args:",
        "        filepath: Path to saved file",
        "        verbose: Print progress",
        "",
        "    Returns:",
        "        Tuple of (layers, documents, document_metadata, embeddings, semantic_relations, metadata)",
        "",
        "    Raises:",
        "    \"\"\"",
        "            )",
        "",
        "",
        "    if verbose:",
        "        total_cols = sum(len(layer.minicolumns) for layer in layers.values())",
        "        total_conns = sum(layer.total_connections() for layer in layers.values())",
        "        logger.info(f\"  - {len(documents)} documents\")",
        "        logger.info(f\"  - {total_cols} minicolumns\")",
        "        logger.info(f\"  - {total_conns} connections\")",
        "        if embeddings:",
        "            logger.info(f\"  - {len(embeddings)} embeddings\")",
        "        if semantic_relations:",
        "            logger.info(f\"  - {len(semantic_relations)} semantic relations\")",
        "",
        "    return layers, documents, document_metadata, embeddings, semantic_relations, metadata",
        ""
      ],
      "change_type": "modify"
    },
    {
      "file": "cortical/proto/__init__.py",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "\"\"\"",
        "Protocol Buffers Serialization Facade",
        "=====================================",
        "",
        "Provides a clean API for Protocol Buffers text-format serialization.",
        "",
        "This module hides protobuf implementation details and provides simple",
        "functions for serializing/deserializing processor state to git-friendly",
        "text format.",
        "",
        "Usage:",
        "    from cortical.proto import serialize_state, deserialize_state, PROTOBUF_AVAILABLE",
        "",
        "    if PROTOBUF_AVAILABLE:",
        "        # Serialize state to text",
        "        text = serialize_state(layers, documents, metadata, ...)",
        "",
        "        # Deserialize text back to state",
        "        layers, docs, meta, emb, rels, info = deserialize_state(text)",
        "\"\"\"",
        "",
        "from typing import Dict, List, Optional, Any, Tuple",
        "",
        "# Check if protobuf is available",
        "PROTOBUF_AVAILABLE = False",
        "_text_format = None",
        "_to_proto = None",
        "_from_proto = None",
        "_schema_pb2 = None",
        "",
        "try:",
        "    from google.protobuf import text_format as _text_format",
        "    from .serialization import to_proto as _to_proto, from_proto as _from_proto",
        "    from . import schema_pb2 as _schema_pb2",
        "    PROTOBUF_AVAILABLE = True",
        "except ImportError:",
        "    pass",
        "",
        "",
        "def serialize_state(",
        "    layers: Dict,",
        "    documents: Dict[str, str],",
        "    document_metadata: Optional[Dict[str, Dict[str, Any]]] = None,",
        "    embeddings: Optional[Dict[str, list]] = None,",
        "    semantic_relations: Optional[list] = None,",
        "    metadata: Optional[Dict] = None",
        ") -> str:",
        "    \"\"\"",
        "    Serialize processor state to protobuf text format.",
        "",
        "    Args:",
        "        layers: Dictionary of CorticalLayer -> HierarchicalLayer",
        "        documents: Document collection {doc_id: content}",
        "        document_metadata: Per-document metadata",
        "        embeddings: Graph embeddings for terms",
        "        semantic_relations: Extracted semantic relations",
        "        metadata: Processor metadata (version, settings)",
        "",
        "    Returns:",
        "        Human-readable protobuf text format string",
        "",
        "    Raises:",
        "        ImportError: If protobuf package is not installed",
        "    \"\"\"",
        "    if not PROTOBUF_AVAILABLE:",
        "        raise ImportError(",
        "            \"protobuf package required for serialization. \"",
        "            \"Install with: pip install protobuf\"",
        "        )",
        "",
        "    proto_state = _to_proto(",
        "        layers, documents, document_metadata,",
        "        embeddings, semantic_relations, metadata",
        "    )",
        "    return _text_format.MessageToString(proto_state)",
        "",
        "",
        "def deserialize_state(text: str) -> Tuple:",
        "    \"\"\"",
        "    Deserialize protobuf text format to processor state.",
        "",
        "    Args:",
        "        text: Protobuf text format string",
        "",
        "    Returns:",
        "        Tuple of (layers, documents, document_metadata,",
        "                  embeddings, semantic_relations, metadata)",
        "",
        "    Raises:",
        "        ImportError: If protobuf package is not installed",
        "    \"\"\"",
        "    if not PROTOBUF_AVAILABLE:",
        "        raise ImportError(",
        "            \"protobuf package required for deserialization. \"",
        "            \"Install with: pip install protobuf\"",
        "        )",
        "",
        "    proto_state = _schema_pb2.ProcessorState()",
        "    _text_format.Parse(text, proto_state)",
        "    return _from_proto(proto_state)",
        "",
        "",
        "# Export public API",
        "__all__ = [",
        "    'PROTOBUF_AVAILABLE',",
        "    'serialize_state',",
        "    'deserialize_state',",
        "]"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "cortical/proto/schema.proto",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "syntax = \"proto3\";",
        "",
        "package cortical;",
        "",
        "// Edge represents a typed connection with metadata",
        "message Edge {",
        "  string target_id = 1;",
        "  double weight = 2;",
        "  string relation_type = 3;",
        "  double confidence = 4;",
        "  string source = 5;",
        "}",
        "",
        "// Minicolumn represents a cortical minicolumn",
        "message Minicolumn {",
        "  string id = 1;",
        "  string content = 2;",
        "  int32 layer = 3;",
        "  double activation = 4;",
        "  int32 occurrence_count = 5;",
        "  repeated string document_ids = 6;",
        "  map<string, double> lateral_connections = 7;",
        "  map<string, Edge> typed_connections = 8;",
        "  repeated string feedforward_sources = 9;",
        "  map<string, double> feedforward_connections = 10;",
        "  map<string, double> feedback_connections = 11;",
        "  double tfidf = 12;",
        "  map<string, double> tfidf_per_doc = 13;",
        "  double pagerank = 14;",
        "  optional int32 cluster_id = 15;",
        "  map<string, int32> doc_occurrence_counts = 16;",
        "  repeated string name_tokens = 17;",
        "}",
        "",
        "// HierarchicalLayer represents a layer in the cortical hierarchy",
        "message HierarchicalLayer {",
        "  int32 level = 1;",
        "  map<string, Minicolumn> minicolumns = 2;",
        "}",
        "",
        "// FloatList represents a list of floats (for embeddings)",
        "message FloatList {",
        "  repeated double values = 1;",
        "}",
        "",
        "// SemanticRelation represents a semantic relation tuple",
        "message SemanticRelation {",
        "  string term1 = 1;",
        "  string relation_type = 2;",
        "  string term2 = 3;",
        "  double weight = 4;",
        "}",
        "",
        "// AnyValue represents arbitrary metadata values",
        "message AnyValue {",
        "  oneof value {",
        "    string string_value = 1;",
        "    int64 int_value = 2;",
        "    double double_value = 3;",
        "    bool bool_value = 4;",
        "    AnyDict dict_value = 5;",
        "    AnyList list_value = 6;",
        "  }",
        "}",
        "",
        "// AnyDict represents arbitrary metadata dictionaries",
        "message AnyDict {",
        "  map<string, AnyValue> values = 1;",
        "}",
        "",
        "// AnyList represents arbitrary metadata lists",
        "message AnyList {",
        "  repeated AnyValue values = 1;",
        "}",
        "",
        "// ProcessorState represents the complete state of a CorticalTextProcessor",
        "message ProcessorState {",
        "  string version = 1;",
        "  map<int32, HierarchicalLayer> layers = 2;",
        "  map<string, string> documents = 3;",
        "  map<string, AnyDict> document_metadata = 4;",
        "  map<string, FloatList> embeddings = 5;",
        "  repeated SemanticRelation semantic_relations = 6;",
        "  AnyDict metadata = 7;",
        "}"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "cortical/proto/serialization.py",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "\"\"\"",
        "Protocol Buffers Serialization",
        "===============================",
        "",
        "Converts between Python data structures and Protocol Buffer messages.",
        "",
        "This module provides serialization and deserialization functions for the",
        "Cortical Text Processor state, enabling cross-language corpus sharing.",
        "\"\"\"",
        "",
        "import os",
        "import sys",
        "from typing import Dict, List, Optional, Any, Tuple",
        "from pathlib import Path",
        "",
        "try:",
        "    import google.protobuf",
        "    from google.protobuf import descriptor_pool",
        "    from google.protobuf import symbol_database",
        "    from google.protobuf.descriptor import FileDescriptor",
        "    from google.protobuf import message_factory",
        "    PROTOBUF_AVAILABLE = True",
        "except ImportError:",
        "    PROTOBUF_AVAILABLE = False",
        "    raise ImportError(",
        "        \"protobuf package is required for Protocol Buffers serialization. \"",
        "        \"Install it with: pip install protobuf\"",
        "    )",
        "",
        "from ..layers import CorticalLayer, HierarchicalLayer",
        "from ..minicolumn import Minicolumn, Edge",
        "",
        "",
        "# Dynamically compile and load proto definitions",
        "def _load_proto_definitions():",
        "    \"\"\"",
        "    Load Protocol Buffer definitions from schema.proto.",
        "",
        "    Uses runtime proto compilation to avoid requiring protoc at build time.",
        "",
        "    Returns:",
        "        Tuple of (ProcessorState class, message factory)",
        "    \"\"\"",
        "    proto_dir = Path(__file__).parent",
        "    proto_file = proto_dir / \"schema.proto\"",
        "",
        "    if not proto_file.exists():",
        "        raise FileNotFoundError(f\"schema.proto not found at {proto_file}\")",
        "",
        "    # Read the proto file content",
        "    with open(proto_file, 'r') as f:",
        "        proto_content = f.read()",
        "",
        "    # Try to use compiled protos first (if available)",
        "    try:",
        "        # Import generated pb2 module if it exists",
        "        from . import schema_pb2",
        "        return (",
        "            schema_pb2.ProcessorState,",
        "            schema_pb2.Edge,",
        "            schema_pb2.Minicolumn,",
        "            schema_pb2.HierarchicalLayer,",
        "            schema_pb2.FloatList,",
        "            schema_pb2.SemanticRelation,",
        "            schema_pb2.AnyValue,",
        "            schema_pb2.AnyDict,",
        "            schema_pb2.AnyList",
        "        )",
        "    except ImportError:",
        "        # Compiled protos not available - use runtime compilation",
        "        # This is a fallback that requires the 'protoc' compiler",
        "        import subprocess",
        "        import tempfile",
        "",
        "        # Create temporary directory for compilation",
        "        with tempfile.TemporaryDirectory() as tmpdir:",
        "            # Write proto file to temp location",
        "            temp_proto = Path(tmpdir) / \"schema.proto\"",
        "            temp_proto.write_text(proto_content)",
        "",
        "            # Compile proto file",
        "            try:",
        "                subprocess.run(",
        "                    [",
        "                        'protoc',",
        "                        f'--python_out={tmpdir}',",
        "                        f'--proto_path={tmpdir}',",
        "                        str(temp_proto)",
        "                    ],",
        "                    check=True,",
        "                    capture_output=True,",
        "                    text=True",
        "                )",
        "            except FileNotFoundError:",
        "                raise RuntimeError(",
        "                    \"protoc compiler not found. Please install Protocol Buffers compiler:\\n\"",
        "                    \"  Ubuntu/Debian: sudo apt-get install protobuf-compiler\\n\"",
        "                    \"  macOS: brew install protobuf\\n\"",
        "                    \"  Or compile protos manually: protoc --python_out=. schema.proto\"",
        "                )",
        "            except subprocess.CalledProcessError as e:",
        "                raise RuntimeError(f\"Failed to compile schema.proto: {e.stderr}\")",
        "",
        "            # Import the generated module",
        "            sys.path.insert(0, tmpdir)",
        "            try:",
        "                import schema_pb2",
        "                return (",
        "                    schema_pb2.ProcessorState,",
        "                    schema_pb2.Edge,",
        "                    schema_pb2.Minicolumn,",
        "                    schema_pb2.HierarchicalLayer,",
        "                    schema_pb2.FloatList,",
        "                    schema_pb2.SemanticRelation,",
        "                    schema_pb2.AnyValue,",
        "                    schema_pb2.AnyDict,",
        "                    schema_pb2.AnyList",
        "                )",
        "            finally:",
        "                sys.path.pop(0)",
        "",
        "",
        "# Load proto message classes",
        "(",
        "    ProcessorStateProto,",
        "    EdgeProto,",
        "    MinicolumnProto,",
        "    HierarchicalLayerProto,",
        "    FloatListProto,",
        "    SemanticRelationProto,",
        "    AnyValueProto,",
        "    AnyDictProto,",
        "    AnyListProto",
        ") = _load_proto_definitions()",
        "",
        "",
        "def _python_value_to_any_value(value: Any) -> Any:",
        "    \"\"\"",
        "    Convert a Python value to AnyValue protobuf message.",
        "",
        "    Args:",
        "        value: Python value (str, int, float, bool, dict, list)",
        "",
        "    Returns:",
        "        AnyValue protobuf message",
        "    \"\"\"",
        "    any_val = AnyValueProto()",
        "",
        "    if isinstance(value, str):",
        "        any_val.string_value = value",
        "    elif isinstance(value, bool):  # Check bool before int (bool is subclass of int)",
        "        any_val.bool_value = value",
        "    elif isinstance(value, int):",
        "        any_val.int_value = value",
        "    elif isinstance(value, float):",
        "        any_val.double_value = value",
        "    elif isinstance(value, dict):",
        "        any_dict = AnyDictProto()",
        "        for k, v in value.items():",
        "            any_dict.values[k].CopyFrom(_python_value_to_any_value(v))",
        "        any_val.dict_value.CopyFrom(any_dict)",
        "    elif isinstance(value, (list, tuple)):",
        "        any_list = AnyListProto()",
        "        for item in value:",
        "            any_list.values.append(_python_value_to_any_value(item))",
        "        any_val.list_value.CopyFrom(any_list)",
        "    else:",
        "        # Fallback: convert to string",
        "        any_val.string_value = str(value)",
        "",
        "    return any_val",
        "",
        "",
        "def _any_value_to_python(any_val: Any) -> Any:",
        "    \"\"\"",
        "    Convert AnyValue protobuf message to Python value.",
        "",
        "    Args:",
        "        any_val: AnyValue protobuf message",
        "",
        "    Returns:",
        "        Python value",
        "    \"\"\"",
        "    which = any_val.WhichOneof('value')",
        "",
        "    if which == 'string_value':",
        "        return any_val.string_value",
        "    elif which == 'int_value':",
        "        return any_val.int_value",
        "    elif which == 'double_value':",
        "        return any_val.double_value",
        "    elif which == 'bool_value':",
        "        return any_val.bool_value",
        "    elif which == 'dict_value':",
        "        return {",
        "            k: _any_value_to_python(v)",
        "            for k, v in any_val.dict_value.values.items()",
        "        }",
        "    elif which == 'list_value':",
        "        return [_any_value_to_python(v) for v in any_val.list_value.values]",
        "    else:",
        "        return None",
        "",
        "",
        "def edge_to_proto(edge: Edge) -> Any:",
        "    \"\"\"",
        "    Convert an Edge to protobuf message.",
        "",
        "    Args:",
        "        edge: Edge object",
        "",
        "    Returns:",
        "        Edge protobuf message",
        "    \"\"\"",
        "    proto = EdgeProto()",
        "    proto.target_id = edge.target_id",
        "    proto.weight = edge.weight",
        "    proto.relation_type = edge.relation_type",
        "    proto.confidence = edge.confidence",
        "    proto.source = edge.source",
        "    return proto",
        "",
        "",
        "def edge_from_proto(proto: Any) -> Edge:",
        "    \"\"\"",
        "    Convert Edge protobuf message to Edge object.",
        "",
        "    Args:",
        "        proto: Edge protobuf message",
        "",
        "    Returns:",
        "        Edge object",
        "    \"\"\"",
        "    return Edge(",
        "        target_id=proto.target_id,",
        "        weight=proto.weight,",
        "        relation_type=proto.relation_type,",
        "        confidence=proto.confidence,",
        "        source=proto.source",
        "    )",
        "",
        "",
        "def minicolumn_to_proto(col: Minicolumn) -> Any:",
        "    \"\"\"",
        "    Convert a Minicolumn to protobuf message.",
        "",
        "    Args:",
        "        col: Minicolumn object",
        "",
        "    Returns:",
        "        Minicolumn protobuf message",
        "    \"\"\"",
        "    proto = MinicolumnProto()",
        "    proto.id = col.id",
        "    proto.content = col.content",
        "    proto.layer = col.layer",
        "    proto.activation = col.activation",
        "    proto.occurrence_count = col.occurrence_count",
        "    proto.document_ids.extend(list(col.document_ids))",
        "",
        "    # Lateral connections",
        "    for target_id, weight in col.lateral_connections.items():",
        "        proto.lateral_connections[target_id] = weight",
        "",
        "    # Typed connections",
        "    for target_id, edge in col.typed_connections.items():",
        "        proto.typed_connections[target_id].CopyFrom(edge_to_proto(edge))",
        "",
        "    # Feedforward",
        "    proto.feedforward_sources.extend(list(col.feedforward_sources))",
        "    for target_id, weight in col.feedforward_connections.items():",
        "        proto.feedforward_connections[target_id] = weight",
        "",
        "    # Feedback",
        "    for target_id, weight in col.feedback_connections.items():",
        "        proto.feedback_connections[target_id] = weight",
        "",
        "    # TF-IDF",
        "    proto.tfidf = col.tfidf",
        "    for doc_id, score in col.tfidf_per_doc.items():",
        "        proto.tfidf_per_doc[doc_id] = score",
        "",
        "    # PageRank",
        "    proto.pagerank = col.pagerank",
        "",
        "    # Cluster ID (optional)",
        "    if col.cluster_id is not None:",
        "        proto.cluster_id = col.cluster_id",
        "",
        "    # Doc occurrence counts",
        "    for doc_id, count in col.doc_occurrence_counts.items():",
        "        proto.doc_occurrence_counts[doc_id] = count",
        "",
        "    # Name tokens (optional)",
        "    if col.name_tokens is not None:",
        "        proto.name_tokens.extend(list(col.name_tokens))",
        "",
        "    return proto",
        "",
        "",
        "def minicolumn_from_proto(proto: Any) -> Minicolumn:",
        "    \"\"\"",
        "    Convert Minicolumn protobuf message to Minicolumn object.",
        "",
        "    Args:",
        "        proto: Minicolumn protobuf message",
        "",
        "    Returns:",
        "        Minicolumn object",
        "    \"\"\"",
        "    col = Minicolumn(proto.id, proto.content, proto.layer)",
        "    col.activation = proto.activation",
        "    col.occurrence_count = proto.occurrence_count",
        "    col.document_ids = set(proto.document_ids)",
        "",
        "    # Typed connections (primary)",
        "    for target_id, edge_proto in proto.typed_connections.items():",
        "        col.typed_connections[target_id] = edge_from_proto(edge_proto)",
        "",
        "    # If no typed connections but lateral_connections exists (old format), convert",
        "    if not col.typed_connections and proto.lateral_connections:",
        "        for target_id, weight in proto.lateral_connections.items():",
        "            col.typed_connections[target_id] = Edge(",
        "                target_id=target_id,",
        "                weight=weight,",
        "                relation_type='co_occurrence',",
        "                confidence=1.0,",
        "                source='corpus'",
        "            )",
        "",
        "    # Invalidate cache to rebuild from typed_connections",
        "    col._lateral_cache_valid = False",
        "",
        "    # Feedforward",
        "    col.feedforward_sources = set(proto.feedforward_sources)",
        "    col.feedforward_connections = dict(proto.feedforward_connections)",
        "",
        "    # Feedback",
        "    col.feedback_connections = dict(proto.feedback_connections)",
        "",
        "    # TF-IDF",
        "    col.tfidf = proto.tfidf",
        "    col.tfidf_per_doc = dict(proto.tfidf_per_doc)",
        "",
        "    # PageRank",
        "    col.pagerank = proto.pagerank",
        "",
        "    # Cluster ID (optional)",
        "    if proto.HasField('cluster_id'):",
        "        col.cluster_id = proto.cluster_id",
        "",
        "    # Doc occurrence counts",
        "    col.doc_occurrence_counts = dict(proto.doc_occurrence_counts)",
        "",
        "    # Name tokens (optional)",
        "    if proto.name_tokens:",
        "        col.name_tokens = set(proto.name_tokens)",
        "",
        "    return col",
        "",
        "",
        "def layer_to_proto(layer: HierarchicalLayer) -> Any:",
        "    \"\"\"",
        "    Convert a HierarchicalLayer to protobuf message.",
        "",
        "    Args:",
        "        layer: HierarchicalLayer object",
        "",
        "    Returns:",
        "        HierarchicalLayer protobuf message",
        "    \"\"\"",
        "    proto = HierarchicalLayerProto()",
        "    proto.level = layer.level",
        "",
        "    for content, col in layer.minicolumns.items():",
        "        proto.minicolumns[content].CopyFrom(minicolumn_to_proto(col))",
        "",
        "    return proto",
        "",
        "",
        "def layer_from_proto(proto: Any) -> HierarchicalLayer:",
        "    \"\"\"",
        "    Convert HierarchicalLayer protobuf message to HierarchicalLayer object.",
        "",
        "    Args:",
        "        proto: HierarchicalLayer protobuf message",
        "",
        "    Returns:",
        "        HierarchicalLayer object",
        "    \"\"\"",
        "    layer = HierarchicalLayer(CorticalLayer(proto.level))",
        "",
        "    for content, col_proto in proto.minicolumns.items():",
        "        col = minicolumn_from_proto(col_proto)",
        "        layer.minicolumns[content] = col",
        "        layer._id_index[col.id] = content  # Rebuild ID index",
        "",
        "    return layer",
        "",
        "",
        "def to_proto(",
        "    layers: Dict[CorticalLayer, HierarchicalLayer],",
        "    documents: Dict[str, str],",
        "    document_metadata: Optional[Dict[str, Dict[str, Any]]] = None,",
        "    embeddings: Optional[Dict[str, list]] = None,",
        "    semantic_relations: Optional[list] = None,",
        "    metadata: Optional[Dict] = None",
        ") -> Any:",
        "    \"\"\"",
        "    Convert processor state to Protocol Buffer message.",
        "",
        "    Args:",
        "        layers: Dictionary of all layers",
        "        documents: Document collection",
        "        document_metadata: Per-document metadata",
        "        embeddings: Graph embeddings for terms",
        "        semantic_relations: Extracted semantic relations",
        "        metadata: Processor metadata",
        "",
        "    Returns:",
        "        ProcessorState protobuf message",
        "    \"\"\"",
        "    proto = ProcessorStateProto()",
        "    proto.version = '2.2'",
        "",
        "    # Serialize layers",
        "    for layer_enum, layer in layers.items():",
        "        proto.layers[layer_enum.value].CopyFrom(layer_to_proto(layer))",
        "",
        "    # Documents",
        "    for doc_id, text in documents.items():",
        "        proto.documents[doc_id] = text",
        "",
        "    # Document metadata",
        "    if document_metadata:",
        "        for doc_id, meta in document_metadata.items():",
        "            any_dict = AnyDictProto()",
        "            for k, v in meta.items():",
        "                any_dict.values[k].CopyFrom(_python_value_to_any_value(v))",
        "            proto.document_metadata[doc_id].CopyFrom(any_dict)",
        "",
        "    # Embeddings",
        "    if embeddings:",
        "        for term, embedding in embeddings.items():",
        "            float_list = FloatListProto()",
        "            float_list.values.extend(embedding)",
        "            proto.embeddings[term].CopyFrom(float_list)",
        "",
        "    # Semantic relations",
        "    if semantic_relations:",
        "        for rel in semantic_relations:",
        "            if len(rel) >= 4:",
        "                rel_proto = SemanticRelationProto()",
        "                rel_proto.term1 = rel[0]",
        "                rel_proto.relation_type = rel[1]",
        "                rel_proto.term2 = rel[2]",
        "                rel_proto.weight = float(rel[3])",
        "                proto.semantic_relations.append(rel_proto)",
        "",
        "    # Metadata",
        "    if metadata:",
        "        any_dict = AnyDictProto()",
        "        for k, v in metadata.items():",
        "            any_dict.values[k].CopyFrom(_python_value_to_any_value(v))",
        "        proto.metadata.CopyFrom(any_dict)",
        "",
        "    return proto",
        "",
        "",
        "def from_proto(proto: Any) -> Tuple:",
        "    \"\"\"",
        "    Convert Protocol Buffer message to processor state.",
        "",
        "    Args:",
        "        proto: ProcessorState protobuf message",
        "",
        "    Returns:",
        "        Tuple of (layers, documents, document_metadata, embeddings, semantic_relations, metadata)",
        "    \"\"\"",
        "    # Reconstruct layers",
        "    layers = {}",
        "    for level_value, layer_proto in proto.layers.items():",
        "        layer = layer_from_proto(layer_proto)",
        "        layers[CorticalLayer(level_value)] = layer",
        "",
        "    # Documents",
        "    documents = dict(proto.documents)",
        "",
        "    # Document metadata",
        "    document_metadata = {}",
        "    for doc_id, any_dict_proto in proto.document_metadata.items():",
        "        document_metadata[doc_id] = {",
        "            k: _any_value_to_python(v)",
        "            for k, v in any_dict_proto.values.items()",
        "        }",
        "",
        "    # Embeddings",
        "    embeddings = {}",
        "    for term, float_list_proto in proto.embeddings.items():",
        "        embeddings[term] = list(float_list_proto.values)",
        "",
        "    # Semantic relations",
        "    semantic_relations = []",
        "    for rel_proto in proto.semantic_relations:",
        "        semantic_relations.append((",
        "            rel_proto.term1,",
        "            rel_proto.relation_type,",
        "            rel_proto.term2,",
        "            rel_proto.weight",
        "        ))",
        "",
        "    # Metadata",
        "    metadata = {}",
        "    if proto.HasField('metadata'):",
        "        metadata = {",
        "            k: _any_value_to_python(v)",
        "            for k, v in proto.metadata.values.items()",
        "        }",
        "",
        "    return layers, documents, document_metadata, embeddings, semantic_relations, metadata"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "requirements.txt",
      "function": null,
      "start_line": 6,
      "lines_added": [
        "",
        "# Optional dependencies",
        "protobuf>=4.0        # Protocol Buffers serialization (optional, for cross-language support)",
        "grpcio-tools>=1.0    # Protocol Buffers compiler (optional, for schema compilation)"
      ],
      "lines_removed": [],
      "context_before": [
        "# No pip install required for production use.",
        "#",
        "# DEVELOPMENT: Install with `pip install -e \".[dev]\"`",
        "# Or install these manually:",
        "",
        "# Development dependencies",
        "coverage>=7.0        # Test coverage reporting",
        "pytest>=7.0          # Test framework (required by tests/unit/)",
        "mcp>=1.0             # MCP server tests (Model Context Protocol)",
        "pyyaml>=6.0          # Workflow integration tests"
      ],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/README.md",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "# Customer Service Document Cluster",
        "",
        "This directory contains 14 customer service documents designed for semantic search testing.",
        "",
        "## Document Categories",
        "",
        "### FAQ Documents (4 files, 2,274 words)",
        "- **software_product_faq.txt** - CloudSync Pro cloud storage software",
        "- **electronics_product_faq.txt** - TechGear wireless earbuds  ",
        "- **subscription_service_faq.txt** - StreamFlix entertainment service",
        "- **account_management_faq.txt** - Account access and user management",
        "",
        "### Troubleshooting Guides (4 files, 4,228 words)",
        "- **software_installation_troubleshooting.txt** - Installation errors and setup",
        "- **connectivity_network_troubleshooting.txt** - Network and connection issues",
        "- **payment_billing_troubleshooting.txt** - Payment processing and billing",
        "- **login_access_troubleshooting.txt** - Authentication and account access",
        "",
        "### Policy Documents (3 files, 4,804 words)",
        "- **return_refund_policy.txt** - Return procedures and refund policies",
        "- **shipping_delivery_policy.txt** - Shipping methods and delivery",
        "- **privacy_data_security_policy.txt** - Data privacy and security practices",
        "",
        "### Templates and Guidelines (3 files, 4,337 words)",
        "- **email_response_templates.txt** - Standard customer service email templates",
        "- **service_level_agreement.txt** - SLA commitments and metrics",
        "- **customer_feedback_survey_guide.txt** - Survey design and feedback collection",
        "",
        "## Total Content",
        "- **14 documents**",
        "- **15,643 words**",
        "- **Average: 1,117 words per document**",
        "",
        "## Key Themes Covered",
        "",
        "### Product Support",
        "- Software installation and configuration",
        "- Hardware setup and troubleshooting",
        "- Feature explanations and how-to guides",
        "- System requirements and compatibility",
        "",
        "### Technical Issues",
        "- Network connectivity problems",
        "- Authentication and login errors",
        "- Payment processing failures",
        "- Device pairing and synchronization",
        "",
        "### Customer Policies",
        "- Return eligibility and procedures",
        "- Refund processing timelines",
        "- Shipping methods and costs",
        "- Privacy and data protection",
        "",
        "### Service Operations",
        "- Response time commitments",
        "- Escalation procedures",
        "- Support channel availability",
        "- Performance metrics",
        "",
        "### Communication",
        "- Email response templates",
        "- Complaint resolution approaches",
        "- Feedback collection methods",
        "- Survey best practices",
        "",
        "## Suggested Test Queries",
        "",
        "### Product-Specific Queries",
        "- \"How do I pair wireless earbuds with my phone?\"",
        "- \"Cloud storage encryption security\"",
        "- \"Streaming service device limits\"",
        "- \"Two-factor authentication setup\"",
        "",
        "### Problem-Solving Queries",
        "- \"Installation fails with permission error\"",
        "- \"Cannot connect to service\"",
        "- \"Payment declined troubleshooting\"",
        "- \"Forgot password reset\"",
        "",
        "### Policy Information Queries",
        "- \"Return policy for opened electronics\"",
        "- \"International shipping costs\"",
        "- \"Data privacy GDPR compliance\"",
        "- \"Refund processing time\"",
        "",
        "### Process and Procedure Queries",
        "- \"How to escalate support ticket\"",
        "- \"SLA response time commitments\"",
        "- \"Customer satisfaction survey best practices\"",
        "- \"Email template for order confirmation\"",
        "",
        "### Cross-Document Semantic Queries",
        "- \"Security and privacy protection\" (should find privacy policy, 2FA, encryption)",
        "- \"Delivery problems and solutions\" (should find shipping policy, tracking, delays)",
        "- \"Account access issues\" (should find login troubleshooting, password reset, 2FA)",
        "- \"Payment and billing concerns\" (should find billing troubleshooting, refund policy, SLA)",
        "",
        "## Testing Value",
        "",
        "These documents provide:",
        "- **Vocabulary diversity** - Multiple product types (software, hardware, services)",
        "- **Semantic overlap** - Concepts appear across different contexts",
        "- **Question-answer patterns** - FAQ format tests retrieval matching",
        "- **Procedural knowledge** - Step-by-step troubleshooting sequences",
        "- **Policy complexity** - Nuanced rules and conditions",
        "- **Customer intent variety** - Different goals (learn, fix, understand policy)"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/account_management_faq.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Account Management FAQ",
        "",
        "Q: How do I create a new account?",
        "A: Visit our website homepage and click the \"Sign Up\" button. Provide your email address, create a strong password with at least 8 characters including uppercase, lowercase, numbers, and symbols. Verify your email by clicking the link sent to your inbox within 24 hours. Complete your profile with billing information to activate full account features. Two-factor authentication is recommended for enhanced security.",
        "",
        "Q: I forgot my password. How can I reset it?",
        "A: Click \"Forgot Password\" on the login page and enter your registered email address. Check your inbox for a password reset link valid for 2 hours. Click the link and create a new password meeting our security requirements. If you don't receive the email within 10 minutes, check your spam folder or request another reset link. For security reasons, we cannot tell you your current password - it must be reset.",
        "",
        "Q: How do I enable two-factor authentication?",
        "A: Navigate to Account Settings and select Security Options. Choose your preferred 2FA method: authenticator app (recommended), SMS text message, or email code. Follow the setup wizard to configure your chosen method. Save backup codes in a secure location in case you lose access to your primary 2FA device. Once enabled, you'll need both your password and verification code to log in.",
        "",
        "Q: Can I change my registered email address?",
        "A: Yes, go to Account Settings and click \"Change Email Address\" under Contact Information. Enter your new email and confirm your current password. A verification link will be sent to both your old and new email addresses. Click the link in your new email within 24 hours to complete the change. Your old email will receive a notification confirming the change for security purposes.",
        "",
        "Q: How do I update my billing information?",
        "A: Log into your account dashboard and select Billing & Payment from the menu. Click \"Update Payment Method\" to modify credit card details, billing address, or payment preferences. Changes take effect immediately for future charges. Previous invoices remain unchanged. We use industry-standard encryption to protect all payment information. Card details are never displayed in full for security reasons.",
        "",
        "Q: What information is stored in my account profile?",
        "A: Your profile contains contact information (name, email, phone), billing details (payment methods, billing address), subscription information (plan type, renewal date), purchase history, communication preferences, and usage data for personalization. You can view, download, or delete your personal data through the Privacy Dashboard in Account Settings. We comply with GDPR and CCPA privacy regulations.",
        "",
        "Q: How do I delete my account permanently?",
        "A: Account deletion is permanent and cannot be undone. Navigate to Account Settings and scroll to the bottom for \"Delete Account\" option. You'll be asked to confirm your password and provide feedback about your decision. All personal data will be deleted within 30 days per our data retention policy. Active subscriptions will be cancelled, and any remaining balance will be forfeited unless you request a refund before deletion.",
        "",
        "Q: Can I have multiple accounts?",
        "A: Our Terms of Service permit one personal account per individual. Business accounts or family accounts may include multiple user profiles under a single subscription. Creating duplicate accounts to abuse promotions, free trials, or circumvent restrictions is prohibited and may result in account suspension. If you need separate accounts for personal and business use, contact our sales team about enterprise options.",
        "",
        "Q: Why is my account locked or suspended?",
        "A: Accounts may be locked due to multiple failed login attempts (unlocks automatically after 30 minutes), suspicious activity detected by our security systems, payment failures for active subscriptions, or Terms of Service violations. Check your email for notifications explaining the reason and instructions for resolution. Contact customer support if you believe your account was locked in error. Serious violations may result in permanent account termination.",
        "",
        "Q: How do I export my account data?",
        "A: We provide data portability rights under privacy regulations. Go to Privacy Dashboard in Account Settings and click \"Request Data Export.\" You'll receive a download link within 48 hours containing your account information, purchase history, uploaded content, and activity logs in machine-readable JSON format. Data exports are available for download for 14 days before automatic deletion."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/connectivity_network_troubleshooting.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Connectivity and Network Troubleshooting Guide",
        "",
        "Cannot Connect to Service - Basic Diagnostics",
        "",
        "Begin by verifying your internet connection is working. Open a web browser and visit several different websites to confirm general internet connectivity. If websites load slowly or not at all, the problem is with your internet connection rather than our service specifically.",
        "",
        "Check our status page at status.ourservice.com to see if we're experiencing service disruptions or planned maintenance. Widespread outages are announced on our status page and social media channels. If services are operational, the issue is likely with your local network configuration or internet service provider.",
        "",
        "Restart your modem and router by unplugging them for 30 seconds, then reconnecting power. Allow 2-3 minutes for them to fully reboot and establish connections. Restart your computer or device as well. This simple step resolves most intermittent connectivity issues by clearing temporary network state.",
        "",
        "Firewall Blocking Connection",
        "",
        "Corporate firewalls, security software, or home router settings may block our service's required network ports. Our application requires outbound access on ports 443 (HTTPS), 80 (HTTP), and 8883 (secure messaging). Check your firewall settings to ensure these ports aren't blocked for our application.",
        "",
        "Add our application to your firewall's trusted applications list or create specific rules allowing outbound connections to our server domains. Windows Defender Firewall, third-party security suites, and router firewalls all have different configuration interfaces. Consult your security software's documentation for adding exceptions.",
        "",
        "Enterprise networks often require proxy configuration or whitelist approval for external services. Contact your IT department to whitelist our service domains and IP ranges listed in our technical documentation. Provide your IT team with our network requirements document available in the support portal.",
        "",
        "VPN or Proxy Interference",
        "",
        "Virtual private networks and proxy servers can interfere with our service's connection protocols. Temporarily disable your VPN to test if it's causing connectivity issues. If the service works without VPN, configure your VPN to split-tunnel our application's traffic or exclude our domains from VPN routing.",
        "",
        "Some VPN services are incompatible with real-time features like video streaming or live chat due to packet inspection or compression. Check your VPN provider's support documentation or try a different VPN server location. Corporate VPNs may require configuration changes that need IT department assistance.",
        "",
        "Proxy settings configured in your browser or operating system can prevent our application from reaching our servers. Check Internet Options (Windows) or Network Preferences (Mac) for proxy configuration. Ensure proxy settings allow connections to our service domains or configure the application to bypass proxy servers.",
        "",
        "DNS Resolution Failures",
        "",
        "Domain Name System problems prevent translating our service URLs into IP addresses. Test DNS resolution by opening Command Prompt (Windows) or Terminal (Mac/Linux) and typing: nslookup api.ourservice.com",
        "",
        "If nslookup fails or returns errors, try changing your DNS servers to public alternatives like Google DNS (8.8.8.8, 8.8.4.4) or Cloudflare DNS (1.1.1.1, 1.0.0.1). Configure DNS servers in your network adapter settings or router configuration. Flush your local DNS cache after changing servers using: ipconfig /flushdns (Windows) or sudo killall -HUP mDNSResponder (Mac).",
        "",
        "Intermittent Disconnections",
        "",
        "Unstable connections that drop frequently may indicate WiFi signal strength issues, internet service provider problems, or network congestion. Run a speed test at speedtest.net during different times of day to identify patterns. Consistent slow speeds or high packet loss indicate ISP issues requiring contact with your internet provider.",
        "",
        "Move closer to your WiFi router or use a wired Ethernet connection for more stable connectivity. WiFi interference from neighboring networks, microwave ovens, or physical obstacles degrades signal quality. Use WiFi analyzer tools to find less congested channels and optimize router placement.",
        "",
        "Network adapter drivers can cause disconnection issues when outdated or corrupted. Update your network adapter drivers through Device Manager (Windows) or Software Update (Mac). Disable power management features that turn off network adapters to save energy, as this causes unexpected disconnections.",
        "",
        "Error: \"SSL Certificate Validation Failed\"",
        "",
        "This security error indicates problems verifying our server's encryption certificate. Ensure your system clock is set correctly - incorrect date and time cause certificate validation to fail. Synchronize your system clock with internet time servers through Date & Time settings.",
        "",
        "Outdated operating systems may lack current certificate authority root certificates needed to validate modern SSL certificates. Install the latest operating system updates which include updated certificate stores. Windows users should run Windows Update, macOS users should check Software Update.",
        "",
        "Security software or corporate network inspection can interfere with SSL certificate validation. Some antivirus programs perform SSL inspection which can trigger certificate errors. Check your security software settings and add exceptions for our service if needed.",
        "",
        "Mobile Data Connection Issues",
        "",
        "Mobile devices may restrict background data for our application to save data allowance. Check your device's app settings to ensure background data and unrestricted data usage are enabled for our application. Some devices have data saver modes that need to be disabled or configured with app exceptions.",
        "",
        "Cellular carriers sometimes throttle data speeds after exceeding plan limits or during network congestion. Run a speed test on your mobile connection to verify adequate bandwidth. Some features may require WiFi connection if cellular data speeds are insufficient.",
        "",
        "Verify the application has necessary permissions to access network connectivity. On iOS, check Settings > Privacy > Local Network. On Android, check App Permissions for network access. Denying these permissions prevents the application from establishing connections.",
        "",
        "Connection Works on Some Devices But Not Others",
        "",
        "Device-specific connectivity issues suggest firewall settings, security software, or system configuration differences between devices. Compare working and non-working devices to identify differences in security software, VPN usage, or network settings.",
        "",
        "Reinstall the application on non-working devices to eliminate corrupted installation files. Clear application cache and data which might contain outdated or invalid connection parameters. On mobile devices, uninstall completely and reinstall from the app store rather than updating.",
        "",
        "Check if the working devices are on different network segments or using different internet connections. Enterprise networks may apply different firewall rules to different device types or user accounts. Wireless guest networks often have more restrictive policies than primary networks."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/customer_feedback_survey_guide.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Customer Feedback and Survey Guide",
        "",
        "Post-Purchase Satisfaction Survey",
        "",
        "Survey Timing: Send 7-10 days after delivery confirmation to allow sufficient product experience time. Earlier surveys capture initial impressions but miss usage-related issues. Later surveys risk lower response rates due to fading memory of purchase experience.",
        "",
        "Core Questions:",
        "",
        "1. Overall Satisfaction (1-5 scale)",
        "\"How satisfied are you with your recent purchase from [Company Name]?\"",
        "1 = Very Dissatisfied, 2 = Dissatisfied, 3 = Neutral, 4 = Satisfied, 5 = Very Satisfied",
        "",
        "2. Product Quality (1-5 scale)",
        "\"How would you rate the quality of the product you received?\"",
        "Follow-up for ratings 1-3: \"What specific aspects fell short of your expectations?\"",
        "",
        "3. Value Assessment (1-5 scale)",
        "\"How would you rate the value for money of your purchase?\"",
        "This measures price-to-quality perception and pricing strategy effectiveness.",
        "",
        "4. Delivery Experience (1-5 scale)",
        "\"How satisfied were you with the delivery speed and packaging quality?\"",
        "Follow-up: \"Did your order arrive on time and undamaged?\"",
        "",
        "5. Product Expectations (1-5 scale)",
        "\"How well did the product match the description and images on our website?\"",
        "Lower scores indicate listing accuracy issues requiring attention.",
        "",
        "6. Likelihood to Recommend (0-10 scale - Net Promoter Score)",
        "\"How likely are you to recommend [Company Name] to friends or colleagues?\"",
        "0 = Not at all likely, 10 = Extremely likely",
        "NPS calculation: % Promoters (9-10) minus % Detractors (0-6)",
        "",
        "7. Open Feedback (Text field)",
        "\"Is there anything else you'd like to share about your experience?\"",
        "Optional field captures unanticipated insights beyond structured questions.",
        "",
        "Target response rate: 15-25% for email surveys. Incentivize with discount codes for completion to boost participation. Keep total survey time under 2 minutes to minimize abandonment.",
        "",
        "Customer Support Interaction Survey",
        "",
        "Survey Timing: Send immediately after ticket closure while interaction memory is fresh. Same-day response rates are 3x higher than delayed surveys.",
        "",
        "Core Questions:",
        "",
        "1. Issue Resolution (Yes/No)",
        "\"Was your issue completely resolved?\"",
        "If No: \"What remains unresolved?\" (Text field for follow-up action)",
        "",
        "2. Resolution Time Satisfaction (1-5 scale)",
        "\"How satisfied were you with the time it took to resolve your issue?\"",
        "Measures whether SLA compliance meets customer expectations.",
        "",
        "3. Agent Knowledge (1-5 scale)",
        "\"How knowledgeable was our support agent about your issue?\"",
        "Identifies training needs and agent performance variations.",
        "",
        "4. Agent Professionalism (1-5 scale)",
        "\"How would you rate the professionalism and courtesy of our support agent?\"",
        "Tracks soft skills and customer service quality beyond technical competence.",
        "",
        "5. Communication Clarity (1-5 scale)",
        "\"How clear and understandable was the support agent's communication?\"",
        "Identifies needs for simplified explanations or better documentation.",
        "",
        "6. Effort Required (1-5 scale - Customer Effort Score)",
        "\"How much effort did you personally have to put forth to resolve your issue?\"",
        "1 = Very Low Effort, 5 = Very High Effort",
        "Lower scores indicate better self-service resources and efficient support processes.",
        "",
        "7. Support Channel Preference",
        "\"Which support channel did you use? Was it your preferred method?\"",
        "Options: Email, Phone, Chat, Knowledge Base, Community Forum",
        "Tracks channel usage patterns and preferences for capacity planning.",
        "",
        "8. Open Feedback (Text field)",
        "\"How could we have improved your support experience?\"",
        "",
        "Target response rate: 25-35% for post-support surveys. Higher engagement due to recent interaction and investment in resolution.",
        "",
        "Feature Request and Product Improvement Survey",
        "",
        "Survey Timing: Quarterly to active users, or triggered when customers use advanced features indicating higher engagement levels.",
        "",
        "Core Questions:",
        "",
        "1. Feature Usage Assessment",
        "\"Which features do you use regularly?\" (Multi-select checklist)",
        "Identifies popular features and underutilized functionality needing improvement or deprecation.",
        "",
        "2. Pain Points Identification (Text field)",
        "\"What tasks or workflows are most frustrating or time-consuming in our product?\"",
        "Uncovers improvement opportunities from user perspective.",
        "",
        "3. Missing Functionality (Text field)",
        "\"What features or capabilities do you wish our product had?\"",
        "Direct feature request gathering for product roadmap prioritization.",
        "",
        "4. Competitive Comparison",
        "\"What features in competing products do you find valuable that we don't offer?\"",
        "Competitive intelligence and gap analysis from customer viewpoint.",
        "",
        "5. Feature Importance Rating",
        "Present list of potential features: \"Rate how valuable each feature would be to you\"",
        "1 = Not valuable, 5 = Extremely valuable",
        "Quantifies demand for planned features to prioritize development.",
        "",
        "6. Integration Needs",
        "\"What other tools or platforms would you like to see integrated with our product?\"",
        "Identifies partnership and integration opportunities.",
        "",
        "7. Workflow Description (Text field)",
        "\"Describe a typical workflow you perform with our product\"",
        "Reveals how customers actually use the product versus intended usage patterns.",
        "",
        "Response rate: 10-15% for feature surveys as they require more thought and investment. Target power users and early adopters for higher-quality feedback.",
        "",
        "Website User Experience Survey",
        "",
        "Survey Format: Non-intrusive pop-up or slide-in after user completes action (purchase, account creation, etc.) or spends 60+ seconds on specific pages. Limit frequency to once per user per 30 days to avoid annoyance.",
        "",
        "Core Questions:",
        "",
        "1. Task Completion Success",
        "\"Were you able to accomplish what you came to do today?\"",
        "Yes/No with text field for \"No\" responses explaining barriers.",
        "",
        "2. Navigation Ease (1-5 scale)",
        "\"How easy was it to find what you were looking for?\"",
        "Identifies navigation, search, and information architecture issues.",
        "",
        "3. Page Load Performance",
        "\"How satisfied were you with page loading speed?\"",
        "Correlate with actual performance metrics to identify perception versus reality gaps.",
        "",
        "4. Mobile Experience (if applicable)",
        "\"How would you rate your mobile browsing experience?\"",
        "Mobile-specific pain points often differ from desktop issues.",
        "",
        "5. Visual Design Feedback (1-5 scale)",
        "\"How appealing do you find our website design?\"",
        "Tracks brand perception and aesthetic preferences.",
        "",
        "6. Checkout Experience (e-commerce)",
        "\"How would you rate the checkout process?\" (1-5 scale)",
        "Critical for conversion optimization and cart abandonment reduction.",
        "",
        "7. Improvement Suggestions (Text field)",
        "\"What would make our website better?\"",
        "",
        "Utilize exit intent surveys for visitors who don't convert asking: \"What prevented you from completing your purchase/signup today?\"",
        "",
        "Churn Prevention Survey",
        "",
        "Survey Timing: Send when cancellation detected or subscription not renewed. Time-sensitive as customer decision is fresh and potentially reversible.",
        "",
        "Core Questions:",
        "",
        "1. Cancellation Reason (Multi-select)",
        "- Too expensive / not worth the cost",
        "- Missing features I need",
        "- Found a better alternative",
        "- No longer need this type of service",
        "- Technical problems or poor performance",
        "- Difficult to use",
        "- Poor customer support",
        "- Other (text field)",
        "",
        "2. Decision Reversibility",
        "\"Is there anything we could do to keep you as a customer?\"",
        "Open text field for win-back opportunities.",
        "",
        "3. Alternative Solution",
        "\"What product or service are you switching to, if any?\"",
        "Competitive intelligence on churn destinations.",
        "",
        "4. Price Sensitivity",
        "\"Would you reconsider if we offered [X% discount/different pricing tier]?\"",
        "Tests price elasticity and retention offer effectiveness.",
        "",
        "5. Feature Gaps",
        "\"What missing features led to your decision to cancel?\"",
        "Product development priorities for retention.",
        "",
        "6. Overall Experience Rating (1-5 scale)",
        "\"Overall, how would you rate your experience as our customer?\"",
        "Tracks whether churn is due to dissatisfaction or changing needs.",
        "",
        "7. Willingness to Return",
        "\"Would you consider using our service again in the future?\"",
        "Identifies churned customers worth re-engagement campaigns.",
        "",
        "Response rate: 20-30% for cancellation surveys due to high engagement during decision moment. Offer incentive to complete survey and reconsider (limited-time retention discount).",
        "",
        "Survey Best Practices",
        "",
        "Keep surveys short: 5-7 questions maximum taking under 3 minutes. Higher question counts exponentially increase abandonment rates. Use branching logic to show follow-up questions only when relevant based on previous answers.",
        "",
        "Mix question types: Combine quantitative scales (for metrics tracking) with qualitative open text (for insight depth). Ratio of 60% quantitative, 40% qualitative balances analysis with nuance.",
        "",
        "Avoid leading questions: \"How much do you love our product?\" biases responses. Use neutral phrasing: \"How do you feel about our product?\"",
        "",
        "Provide context: Explain how feedback will be used. \"Your responses help us improve our service\" increases completion rates by 15-20%.",
        "",
        "Make surveys mobile-friendly: 40-60% of responses come from mobile devices. Test survey rendering on various screen sizes. Use large tap targets and minimal typing requirements.",
        "",
        "Time distribution appropriately: Send surveys during business hours Tuesday-Thursday for highest response rates. Avoid Mondays (email overload) and Fridays (weekend mindset).",
        "",
        "Close the feedback loop: Email respondents thanking them and summarizing how their feedback is being used. Share when suggested improvements are implemented to encourage future participation.",
        "",
        "Segment analysis: Analyze responses by customer segments (new vs. returning, account tier, product usage patterns) to identify segment-specific issues and opportunities.",
        "",
        "Track trends over time: Monitor metric changes month-over-month and year-over-year. Identify seasonal patterns and measure impact of improvement initiatives.",
        "",
        "Act on feedback: Surveys without action damage credibility and reduce future response rates. Prioritize high-impact issues mentioned frequently in feedback for addressing first.",
        "",
        "Response Analysis Framework",
        "",
        "Quantitative Metrics:",
        "- Calculate average scores for scale questions by segment",
        "- Track response distribution (% selecting each option)",
        "- Monitor trends over time periods",
        "- Set target thresholds (e.g., 4.0+ average satisfaction score)",
        "- Alert on significant drops month-over-month",
        "",
        "Qualitative Analysis:",
        "- Categorize open text responses into themes",
        "- Count frequency of each theme mention",
        "- Identify emerging patterns not captured by structured questions",
        "- Extract specific customer quotes for sharing with teams",
        "- Prioritize issues by severity and frequency",
        "",
        "Sentiment Analysis:",
        "- Classify text responses as positive, neutral, negative",
        "- Cross-reference sentiment with quantitative scores",
        "- Identify disconnects between numerical ratings and written feedback",
        "",
        "Response Prioritization:",
        "- High impact + high frequency = immediate action required",
        "- High impact + low frequency = monitor for trend emergence",
        "- Low impact + high frequency = process improvement opportunity",
        "- Low impact + low frequency = log for potential future consideration",
        "",
        "Reporting Cadence:",
        "- Daily: Critical support satisfaction scores for immediate intervention",
        "- Weekly: Support interaction metrics for agent coaching",
        "- Monthly: Overall satisfaction trends for management review",
        "- Quarterly: Comprehensive analysis for strategic planning"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/electronics_product_faq.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Electronics Product FAQ - TechGear Wireless Earbuds",
        "",
        "Q: How do I pair my earbuds with my phone?",
        "A: Remove both earbuds from the charging case - they'll automatically enter pairing mode with a blue flashing LED. Open your phone's Bluetooth settings and select \"TechGear Earbuds\" from the available devices list. You'll hear a confirmation chime when successfully connected. The earbuds will automatically reconnect to previously paired devices when removed from the case.",
        "",
        "Q: What is the battery life?",
        "A: Each earbud provides up to 8 hours of continuous playback on a single charge. The charging case provides an additional 24 hours, giving you 32 hours total. Charging time is approximately 90 minutes for the earbuds and 2 hours for the case using the included USB-C cable. Quick charge feature provides 2 hours of playback from a 15-minute charge.",
        "",
        "Q: Are these earbuds water resistant?",
        "A: Yes, the earbuds are rated IPX7 for water resistance, meaning they can withstand submersion in up to 1 meter of water for 30 minutes. This makes them suitable for workouts, running in rain, and accidental splashes. The charging case is IPX4 rated for splash resistance only. Do not submerge the case in water.",
        "",
        "Q: How do I control music playback and calls?",
        "A: Single tap on the right earbud plays or pauses music. Double tap skips to the next track. Triple tap returns to the previous track. Single tap on the left earbud answers or ends calls. Press and hold for 2 seconds to activate your phone's voice assistant. Custom controls can be configured through the TechGear mobile app.",
        "",
        "Q: Can I use just one earbud at a time?",
        "A: Yes, either earbud can be used independently in mono mode. Remove one earbud from the case while leaving the other inside. This is useful for staying aware of your surroundings or extending battery life. Audio will automatically switch from stereo to mono. Both earbuds must be used for stereo sound and full bass response.",
        "",
        "Q: What Bluetooth version do these use?",
        "A: The earbuds use Bluetooth 5.2 technology, providing stable connections up to 30 feet from your device in open space. Advanced codec support includes SBC, AAC, and aptX for high-quality audio streaming. Multi-point connectivity allows simultaneous connection to two devices, letting you switch seamlessly between your phone and laptop.",
        "",
        "Q: How do I update the firmware?",
        "A: Download the TechGear mobile app from your device's app store. Place both earbuds in the case and ensure the case has at least 50% battery. Open the app, navigate to Settings, and select \"Firmware Update\" if an update is available. Keep earbuds in the case during the update process, which typically takes 5-10 minutes. Do not interrupt the update or close the app.",
        "",
        "Q: What should I do if one earbud stops working?",
        "A: First, ensure both earbuds are fully charged. Try resetting by placing both earbuds in the case, then press and hold the case button for 10 seconds until the LED flashes red and blue. Remove earbuds and re-pair with your device. If issues persist, clean the charging contacts with a dry cloth and ensure the earbud speaker mesh is clear of debris."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/email_response_templates.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Customer Service Email Response Templates",
        "",
        "Order Confirmation Template",
        "",
        "Subject: Order Confirmation - Order #[ORDER_NUMBER]",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Thank you for your order! We're excited to get your items to you as quickly as possible.",
        "",
        "Order Number: [ORDER_NUMBER]",
        "Order Date: [DATE]",
        "Estimated Delivery: [DELIVERY_DATE_RANGE]",
        "",
        "Items Ordered:",
        "[ITEM_LIST with quantities and prices]",
        "",
        "Subtotal: $[SUBTOTAL]",
        "Shipping: $[SHIPPING]",
        "Tax: $[TAX]",
        "Total: $[TOTAL]",
        "",
        "Shipping Address:",
        "[FORMATTED_ADDRESS]",
        "",
        "Payment Method: [PAYMENT_TYPE] ending in [LAST_4_DIGITS]",
        "",
        "Your order is currently being processed and will ship within 24 hours. You'll receive a shipping confirmation email with tracking information once your package leaves our warehouse.",
        "",
        "View your order status anytime by logging into your account at [ACCOUNT_URL].",
        "",
        "If you have any questions about your order, please don't hesitate to contact our support team.",
        "",
        "Thank you for your business!",
        "",
        "[COMPANY_NAME] Customer Service Team",
        "",
        "---",
        "",
        "Shipping Confirmation Template",
        "",
        "Subject: Your Order Has Shipped! - Order #[ORDER_NUMBER]",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Great news! Your order has shipped and is on its way to you.",
        "",
        "Order Number: [ORDER_NUMBER]",
        "Tracking Number: [TRACKING_NUMBER]",
        "Carrier: [CARRIER_NAME]",
        "Estimated Delivery: [DELIVERY_DATE]",
        "",
        "Track your package: [TRACKING_URL]",
        "",
        "Items Shipped:",
        "[ITEM_LIST]",
        "",
        "Delivery Address:",
        "[FORMATTED_ADDRESS]",
        "",
        "Your package should arrive by [DELIVERY_DATE]. Please note that delivery times are estimates and may vary due to carrier schedules or weather conditions.",
        "",
        "If you have any questions or concerns about your shipment, please contact us and reference your order number.",
        "",
        "Thank you for choosing [COMPANY_NAME]!",
        "",
        "Best regards,",
        "[COMPANY_NAME] Shipping Department",
        "",
        "---",
        "",
        "Refund Processed Template",
        "",
        "Subject: Refund Confirmation - Order #[ORDER_NUMBER]",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Your refund has been processed successfully.",
        "",
        "Order Number: [ORDER_NUMBER]",
        "Refund Amount: $[REFUND_AMOUNT]",
        "Refund Method: [PAYMENT_METHOD] ending in [LAST_4_DIGITS]",
        "Processing Date: [DATE]",
        "",
        "Your refund will appear on your statement within 5-10 business days depending on your financial institution. The refund will show as a credit from [COMPANY_NAME].",
        "",
        "Items Refunded:",
        "[ITEM_LIST with quantities and refund amounts]",
        "",
        "If you have any questions about this refund or need further assistance, please don't hesitate to contact us.",
        "",
        "We appreciate your business and hope to serve you again in the future.",
        "",
        "Sincerely,",
        "[COMPANY_NAME] Customer Service Team",
        "",
        "---",
        "",
        "Technical Support Response Template",
        "",
        "Subject: Re: [ORIGINAL_SUBJECT] - Ticket #[TICKET_NUMBER]",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Thank you for contacting our technical support team. I understand you're experiencing [BRIEF_ISSUE_DESCRIPTION], and I'm here to help resolve this for you.",
        "",
        "Based on the information you provided, I recommend trying the following steps:",
        "",
        "1. [TROUBLESHOOTING_STEP_1]",
        "   [Detailed explanation of why and how]",
        "",
        "2. [TROUBLESHOOTING_STEP_2]",
        "   [Detailed explanation of why and how]",
        "",
        "3. [TROUBLESHOOTING_STEP_3]",
        "   [Detailed explanation of why and how]",
        "",
        "Please try these steps and let me know the results. If the issue persists after completing these steps, we'll escalate to our specialized technical team for further investigation.",
        "",
        "For your reference, your support ticket number is [TICKET_NUMBER]. Include this number in any future correspondence about this issue for faster service.",
        "",
        "I'm committed to resolving this issue for you. Please reply with the results of these troubleshooting steps, or let me know if you have any questions.",
        "",
        "Best regards,",
        "[AGENT_NAME]",
        "Technical Support Specialist",
        "[COMPANY_NAME]",
        "",
        "---",
        "",
        "Product Not Available Template",
        "",
        "Subject: Re: Product Inquiry - [PRODUCT_NAME]",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Thank you for your interest in [PRODUCT_NAME]. Unfortunately, this item is currently out of stock due to [REASON - high demand/supply chain delays/discontinued].",
        "",
        "We have a few options for you:",
        "",
        "1. Back-Order: We expect stock to arrive by [EXPECTED_DATE]. We can place a back-order for you now and ship as soon as inventory arrives. You won't be charged until the item ships.",
        "",
        "2. Similar Products: We have similar items available that might meet your needs:",
        "   - [ALTERNATIVE_1]: [BRIEF_DESCRIPTION] - [PRICE] - [IN_STOCK_STATUS]",
        "   - [ALTERNATIVE_2]: [BRIEF_DESCRIPTION] - [PRICE] - [IN_STOCK_STATUS]",
        "",
        "3. Notification: Sign up for back-in-stock notifications at [PRODUCT_URL]. We'll email you immediately when this item becomes available.",
        "",
        "If you'd like to proceed with any of these options or have questions about the alternatives, please let me know and I'll be happy to assist.",
        "",
        "Thank you for your patience and understanding.",
        "",
        "Sincerely,",
        "[AGENT_NAME]",
        "[COMPANY_NAME] Sales Team",
        "",
        "---",
        "",
        "Complaint Acknowledgment Template",
        "",
        "Subject: We're Sorry - Your Feedback Is Important - Case #[CASE_NUMBER]",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Thank you for bringing this matter to our attention. I sincerely apologize for [SPECIFIC_ISSUE] and the frustration this has caused you. Your feedback is valuable and helps us improve our service.",
        "",
        "I want to assure you that we take your concerns seriously. Here's what I'm doing to address your situation:",
        "",
        "Immediate Action:",
        "[IMMEDIATE_STEPS_BEING_TAKEN]",
        "",
        "Resolution:",
        "[PROPOSED_SOLUTION with timeline]",
        "",
        "Prevention:",
        "I've shared your feedback with [RELEVANT_DEPARTMENT] to prevent similar issues in the future. Your experience will help us improve our [PROCESS/PRODUCT/SERVICE].",
        "",
        "To make this right, I'd like to offer [COMPENSATION/GOODWILL_GESTURE if appropriate]. This will be [HOW_IT_WILL_BE_APPLIED].",
        "",
        "I'll personally monitor this case to ensure complete resolution. You can expect [NEXT_STEPS] by [TIMELINE]. I'll follow up with you on [DATE] to confirm everything has been resolved to your satisfaction.",
        "",
        "If you have any additional concerns or questions, please don't hesitate to contact me directly at this email address.",
        "",
        "Again, I apologize for this experience, and I appreciate the opportunity to make it right.",
        "",
        "Best regards,",
        "[AGENT_NAME]",
        "[TITLE]",
        "[COMPANY_NAME]",
        "Direct: [CONTACT_INFO if appropriate]",
        "",
        "---",
        "",
        "Password Reset Instructions Template",
        "",
        "Subject: Password Reset Request - [COMPANY_NAME] Account",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "We received a request to reset the password for your [COMPANY_NAME] account associated with this email address.",
        "",
        "To reset your password, click the link below:",
        "[RESET_LINK]",
        "",
        "This link will expire in 2 hours for security purposes.",
        "",
        "If you didn't request a password reset, please ignore this email. Your password will remain unchanged. If you're concerned about your account security, contact our support team immediately.",
        "",
        "For your security, remember to:",
        "- Create a strong password with at least 8 characters",
        "- Include uppercase and lowercase letters, numbers, and symbols",
        "- Never share your password with anyone",
        "- Use a unique password not used on other websites",
        "",
        "If you continue to have trouble accessing your account, please contact our support team for assistance.",
        "",
        "Best regards,",
        "[COMPANY_NAME] Security Team",
        "",
        "---",
        "",
        "Subscription Renewal Reminder Template",
        "",
        "Subject: Your [PLAN_NAME] Subscription Renews in 7 Days",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "This is a friendly reminder that your [PLAN_NAME] subscription will automatically renew on [RENEWAL_DATE].",
        "",
        "Subscription Details:",
        "Plan: [PLAN_NAME]",
        "Renewal Date: [RENEWAL_DATE]",
        "Amount: $[AMOUNT]",
        "Payment Method: [PAYMENT_TYPE] ending in [LAST_4_DIGITS]",
        "",
        "Your subscription will automatically renew to ensure uninterrupted service. No action is needed if you wish to continue your subscription.",
        "",
        "If you'd like to make any changes:",
        "- Upgrade or downgrade your plan: [PLAN_CHANGE_URL]",
        "- Update payment method: [PAYMENT_UPDATE_URL]",
        "- Cancel subscription: [CANCELLATION_URL]",
        "",
        "Remember that if you cancel, your service will continue through [CURRENT_PERIOD_END_DATE], but you won't be charged for subsequent periods.",
        "",
        "Thank you for being a valued subscriber!",
        "",
        "Best regards,",
        "[COMPANY_NAME] Subscription Team",
        "",
        "---",
        "",
        "Account Closure Confirmation Template",
        "",
        "Subject: Account Closure Confirmation",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "This email confirms that your [COMPANY_NAME] account has been permanently closed as requested on [DATE].",
        "",
        "Account Details:",
        "Username: [USERNAME]",
        "Email: [EMAIL]",
        "Closure Date: [CLOSURE_DATE]",
        "",
        "Per your request and our privacy policy:",
        "- Your personal information will be deleted within 30 days",
        "- Any active subscriptions have been cancelled",
        "- Remaining account balance of $[BALANCE] [will be refunded/has been forfeited - as applicable]",
        "- Order history will be retained for [RETENTION_PERIOD] for legal and accounting purposes",
        "",
        "Please note that account closure is permanent and cannot be reversed. If you wish to use our services in the future, you'll need to create a new account.",
        "",
        "We're sorry to see you go and would appreciate any feedback about your experience with [COMPANY_NAME]. Your insights help us improve our service for future customers.",
        "",
        "If this account closure was made in error or without your authorization, please contact our security team immediately at security@ourservice.com.",
        "",
        "Thank you for being a customer. We wish you all the best.",
        "",
        "Sincerely,",
        "[COMPANY_NAME] Customer Service Team",
        "",
        "---",
        "",
        "Positive Feedback Response Template",
        "",
        "Subject: Re: [ORIGINAL_SUBJECT] - Thank You!",
        "",
        "Dear [CUSTOMER_NAME],",
        "",
        "Thank you so much for taking the time to share your positive feedback! Messages like yours make our day and remind us why we love what we do.",
        "",
        "I'm thrilled to hear that [SPECIFIC_ASPECT they praised] met your expectations. We work hard to [COMPANY_VALUE related to their feedback], and it's wonderful to know we succeeded in your case.",
        "",
        "I've shared your kind words with [TEAM/INDIVIDUAL mentioned], who will be delighted to know their efforts made a difference for you. Your feedback is also being shared with our leadership team as an example of the experience we strive to deliver to all customers.",
        "",
        "If there's anything else we can do to enhance your experience with [COMPANY_NAME], please don't hesitate to reach out. We're always here to help.",
        "",
        "Thank you again for your business and for taking the time to share your experience. Customers like you make our work truly rewarding!",
        "",
        "Warmest regards,",
        "[AGENT_NAME]",
        "[COMPANY_NAME] Customer Service Team",
        "",
        "P.S. If you'd be willing to share your experience publicly, we'd be grateful for a review on [REVIEW_PLATFORM]. Here's a quick link: [REVIEW_URL]"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/login_access_troubleshooting.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Login and Account Access Troubleshooting Guide",
        "",
        "Forgot Password - Cannot Reset",
        "",
        "Password reset emails should arrive within 10 minutes of requesting them. Check your spam, junk, and promotions folders thoroughly as security-related emails often get filtered. Search your entire mailbox for emails from noreply@ourservice.com or security@ourservice.com to locate the reset message.",
        "",
        "Reset links expire after 2 hours for security purposes. If the link expired, request a new password reset and complete the process immediately. Only the most recent reset link remains valid - earlier reset requests are automatically invalidated when you request a new one.",
        "",
        "If you registered with a different email address than you remember, try common variations or check previous confirmation emails from our service. The password reset must be sent to your registered email address. Contact support with alternative verification information if you cannot access your registered email account.",
        "",
        "Email account access problems prevent you from receiving reset links. If you no longer have access to your registered email address, contact customer support with account verification details: username, previous transaction information, or answers to security questions configured during registration.",
        "",
        "\"Invalid Email or Password\" Error",
        "",
        "Double-check that you're entering the correct email address registered with your account. Email addresses are case-insensitive, but ensure no extra spaces, typos, or autocorrect changes. Copy-paste your email address carefully to eliminate typing errors.",
        "",
        "Passwords are case-sensitive and must be entered exactly as created, including uppercase letters, numbers, and special characters. Disable caps lock and ensure your keyboard layout matches the one used when creating the password. Number pad behavior differs from number row on some keyboards.",
        "",
        "Browser password managers sometimes autofill incorrect credentials from similar websites. Manually type your password instead of using autofill to verify saved credentials are current. Update your password manager after successful password resets to prevent future mismatches.",
        "",
        "After five failed login attempts, your account is temporarily locked for 30 minutes as a security measure. Wait for the lockout period to expire, then try again with correct credentials. If you're certain your credentials are correct but still cannot log in after the lockout period, request a password reset.",
        "",
        "Two-Factor Authentication Issues",
        "",
        "If you lost access to your two-factor authentication device, use backup codes provided during 2FA setup. Each backup code works once to bypass the 2FA requirement and access your account. After logging in with a backup code, reconfigure 2FA with your current device immediately.",
        "",
        "Time-based one-time passwords (TOTP) from authenticator apps are only valid for 30-60 seconds. Enter the code quickly after it's generated. Ensure your device's system clock is accurate - incorrect device time causes authentication code mismatches. Enable automatic date and time synchronization in your device settings.",
        "",
        "SMS-based two-factor codes may be delayed by carrier networks. Wait up to 5 minutes for code delivery. Check that your phone number registered in account settings is current and includes the correct country code. Request a new code if the first doesn't arrive within 5 minutes.",
        "",
        "Some regions or carriers block automated SMS messages including authentication codes. Contact your mobile carrier to remove SMS blocking restrictions. Authenticator apps are more reliable than SMS and recommended for primary 2FA method.",
        "",
        "Account Locked Due to Suspicious Activity",
        "",
        "Automated security systems lock accounts when detecting unusual login patterns: logins from new locations, multiple failed attempts, or simultaneous access from different IP addresses. Check your email for security alert notifications explaining the reason for the lockout and instructions for account recovery.",
        "",
        "Verify recent login activity in your account security settings after regaining access. Look for unfamiliar IP addresses, locations, or devices. If you don't recognize certain logins, your password may be compromised. Change your password immediately and enable two-factor authentication for enhanced protection.",
        "",
        "Contact customer support if the automated unlock process doesn't work. Provide verification information proving account ownership: registered email, billing information, security question answers, or recent transaction details. Security verification may take 24-48 hours for thorough investigation.",
        "",
        "VPN usage or traveling can trigger security locks when accessing your account from unusual locations. Adding trusted devices to your account or notifying us of travel plans before accessing from new locations prevents false security triggers.",
        "",
        "Session Expired - Repeatedly Logged Out",
        "",
        "Automatic session expiration after periods of inactivity is a security feature. Sessions typically expire after 30-60 minutes of no activity. Actively using the service should extend your session, but some actions don't count as activity. Enable \"keep me logged in\" option at login for extended sessions, but only on personal devices.",
        "",
        "Browser privacy settings that clear cookies on exit or block third-party cookies can cause session problems. Configure your browser to allow cookies from our domain. Add our website to your browser's exceptions list if you block cookies globally.",
        "",
        "Security software or browser extensions that block tracking cookies may interfere with session management. Disable these extensions temporarily to test if they're causing logout issues. Whitelist our service in privacy-focused extensions like Privacy Badger or uBlock Origin.",
        "",
        "Multiple device logins can cause session conflicts if security settings limit simultaneous sessions. Some account types permit only one active login at a time. Logging in from a new device automatically ends the previous session. Upgrade to plans supporting multiple concurrent sessions if needed.",
        "",
        "Cannot Access Account from Specific Device or Browser",
        "",
        "Clear your browser cache, cookies, and site data specifically for our website. Accumulated cache can cause login and session problems. After clearing, restart your browser completely before attempting to log in again. Most browsers allow clearing data for individual sites without affecting other websites.",
        "",
        "Ensure your browser is current and supported. We support recent versions of Chrome, Firefox, Safari, and Edge. Very old browsers lack security features required for modern authentication. Update your browser or try a different supported browser if update isn't possible.",
        "",
        "Private or incognito browsing modes have stricter security policies that can interfere with login functionality. Test login in normal browsing mode first. If private browsing is required, you may need to relax certain privacy settings or enable specific permissions for our site.",
        "",
        "Workplace or school networks may block access to certain services or restrict authentication methods. Corporate firewalls, content filters, or network policies can prevent successful logins. Contact your IT department about access requirements or try connecting from a different network to isolate the issue.",
        "",
        "Email Verification Link Not Working",
        "",
        "Verification links expire after 24 hours for security. Request a new verification email from your account settings if the original link expired. Only the most recent verification link sent remains active - previous links are automatically invalidated.",
        "",
        "Copy the entire verification URL from your email and paste it directly into your browser address bar. Email clients sometimes break long URLs across multiple lines, creating incomplete links when clicked. Ensure the complete URL is copied without extra characters or line breaks.",
        "",
        "Browser security settings or extensions may block the verification redirect. Disable popup blockers, tracking protection, and security extensions temporarily during verification. Try verifying in a different browser or incognito mode to bypass extension interference.",
        "",
        "Some email clients convert URLs into trackable links that break the verification token. Look for an \"original message\" or \"plain text\" view option in your email that displays the unmodified verification URL. Forward the verification email to a different email account if your email client consistently breaks verification links.",
        "",
        "If verification repeatedly fails despite trying different browsers and link formats, contact customer support. We can manually verify your email address or send verification through alternative methods. Provide your account username and registered email address for manual verification assistance."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/payment_billing_troubleshooting.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Payment and Billing Troubleshooting Guide",
        "",
        "Payment Declined or Failed",
        "",
        "Payment declines occur for numerous reasons, most commonly insufficient funds, expired cards, incorrect billing information, or fraud prevention triggers. Contact your bank or credit card issuer first to determine why the charge was declined. Banks often have more detailed information about decline reasons than merchants receive.",
        "",
        "Verify all payment information entered correctly: card number, expiration date, CVV security code, billing address, and ZIP code. Even minor discrepancies between entered information and your card's billing address can cause declines. Billing addresses must match exactly what your bank has on file, including apartment numbers and street abbreviations.",
        "",
        "Fraud detection systems sometimes block legitimate transactions appearing suspicious due to unusual purchase patterns, international transactions, or first-time vendor charges. Call your bank to approve the transaction and remove temporary blocks. Inform your bank that you're attempting to purchase from our service and the approximate amount.",
        "",
        "Prepaid cards and some debit cards require pre-authorization holds that temporarily reserve the full transaction amount. Ensure your card has sufficient balance for both the purchase amount and potential authorization holds. Virtual cards, gift cards, or limited-use card numbers may have restrictions preventing recurring subscription charges.",
        "",
        "Duplicate Charges or Multiple Billing",
        "",
        "Check your statement carefully - authorization holds appear as separate pending transactions but only one charge will post to your account. Authorization holds typically disappear within 3-5 business days. If you see multiple completed charges for the same subscription period, contact our billing support immediately.",
        "",
        "Duplicate charges sometimes occur when customers repeatedly retry failed payments or click \"submit\" multiple times during checkout. Only one charge should finalize, but contact us if you see duplicate completed transactions. Provide transaction IDs, dates, and amounts for investigation.",
        "",
        "Multiple subscriptions on one account can appear as duplicate charges but represent separate billing cycles or different service tiers. Review your subscription settings to identify all active subscriptions. Cancel any unwanted subscriptions immediately to prevent future charges.",
        "",
        "Cannot Update Payment Method",
        "",
        "Payment method updates may fail during active subscription renewal attempts. Wait until the current billing cycle processes, then update your payment information. If your card expired and renewal failed, you may need to contact support for manual payment method updates to restore service access.",
        "",
        "Browser cache and cookies sometimes prevent payment form updates from saving properly. Clear your browser cache, disable browser extensions, or try a different browser. Ensure JavaScript is enabled as payment forms require it for validation and encryption.",
        "",
        "Some payment processors require phone number or address verification before allowing payment method changes. Complete any verification steps requested during the update process. Check your email for verification links or codes that must be confirmed before changes take effect.",
        "",
        "Subscription Cancelled But Still Being Charged",
        "",
        "Verify cancellation processed successfully by checking your account subscription status. You should see a cancellation confirmation email and your account dashboard should show subscription end date. If you don't have confirmation, the cancellation may not have completed properly.",
        "",
        "Cancellations take effect at the end of your current billing period, so one more charge after cancelling is expected and correct. Review the cancellation date and the charge date to confirm this is the final charge. No refunds are provided for early cancellation within a billing period unless otherwise stated in our refund policy.",
        "",
        "If you're being charged after your subscription end date, contact billing support immediately with your cancellation confirmation email, account details, and statement showing unexpected charges. We'll investigate and process refunds for any charges that occurred after confirmed cancellation dates.",
        "",
        "Wrong Amount Charged",
        "",
        "Verify the charge amount matches your subscription plan pricing. Check for any add-ons, extra features, or one-time purchases included in the charge. Promotional pricing or discount codes expire, potentially causing prices to return to standard rates.",
        "",
        "Currency conversion fees applied by your bank or credit card processor can make charges appear higher than expected. International transaction fees typically add 1-3% to the base charge. These fees are charged by your financial institution, not by us. Check with your bank about foreign transaction fees if our company is based in a different country.",
        "",
        "Tax amounts vary by location and change when you move or update your billing address. Sales tax, VAT, GST, or other regional taxes are calculated based on your billing location and added to subscription prices. Review the itemized charge breakdown in your invoice for tax amounts and rates applied.",
        "",
        "Refund Not Received",
        "",
        "Refund processing requires 5-10 business days for the funds to appear in your account after we initiate the refund. Credit card refunds take longer than the original charge due to banking processing times. Check your original payment method - refunds return to the same card or account used for purchase.",
        "",
        "Refunds to expired or closed cards are processed by your bank, which typically issues a check or transfers funds to your current account. Contact your card issuer if a refund was processed but hasn't appeared after 14 days. We can provide proof of refund processing to help your bank locate the transaction.",
        "",
        "PayPal, digital wallets, and alternative payment methods have different refund timeframes. Check your payment provider's account for refund status. Some payment processors hold refunds for verification before crediting your account balance.",
        "",
        "Invoice or Receipt Not Received",
        "",
        "Invoices and receipts are automatically emailed to your account's registered email address after each successful charge. Check your spam, junk, or promotions folders if you don't see the email in your inbox. Add billing@ourservice.com to your email contacts to prevent future filtering.",
        "",
        "Download invoices directly from your account dashboard under Billing History. Click any transaction to view detailed invoice information and download PDF copies. Invoice history is maintained for up to 7 years for your records.",
        "",
        "Update your email address in account settings if invoices are being sent to an old or incorrect email. Request reissue of specific invoices through the billing dashboard or contact support with the transaction dates you need.",
        "",
        "Promotional Code Not Working",
        "",
        "Verify the promotional code hasn't expired by checking the expiration date in the promotion terms. Codes are case-sensitive and must be entered exactly as provided, including any hyphens or capital letters. Remove any extra spaces before or after the code when pasting.",
        "",
        "Promotional codes often have eligibility restrictions: new customers only, specific subscription tiers, minimum purchase amounts, or incompatibility with other promotions. Read the promotion details carefully to ensure you meet all requirements. Some codes cannot be combined with existing discounts or applied to accounts with active subscriptions.",
        "",
        "One-time use codes are invalidated after first use. If you previously used a code on a different account or purchase, it won't work again. Contact the promotion source for a replacement code if you believe yours was invalidated in error.",
        "",
        "Unexpected Subscription Renewal",
        "",
        "Subscriptions automatically renew unless cancelled before the renewal date to provide uninterrupted service. Renewal reminder emails are sent 7 days before your billing date. Check your spam folder if you didn't receive renewal reminders - this may indicate email delivery issues requiring address verification.",
        "",
        "Free trials convert to paid subscriptions automatically when the trial period ends. Trial period length and end date are displayed during signup and in your account dashboard. Cancel before the trial ends to avoid charges. Some trials require payment method entry at signup but don't charge until trial completion.",
        "",
        "Review your subscription renewal settings to enable or disable automatic renewal. Disabling automatic renewal will maintain access through your current period's end date but prevent future charges. You'll need to manually renew if you want to continue service after the current period expires."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/privacy_data_security_policy.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Privacy and Data Security Policy",
        "",
        "Information Collection and Usage",
        "",
        "We collect personal information necessary to provide services, process transactions, and enhance user experience. Information collected includes name, email address, phone number, billing address, shipping address, payment details, and account credentials. Order history, browsing behavior, device information, and IP addresses are collected to improve service quality and prevent fraud.",
        "",
        "Information is used to fulfill orders, process payments, communicate order status, provide customer support, send marketing communications (with consent), detect fraud, comply with legal obligations, and improve our products and services. We do not sell personal information to third parties. Information is shared only with service providers necessary for business operations under strict confidentiality agreements.",
        "",
        "Marketing emails are sent only to customers who opted in during account creation or checkout. Unsubscribe links appear in every marketing email. Transactional emails regarding orders, account security, and service updates are sent regardless of marketing preferences as they're necessary for service provision. You can manage email preferences in account settings.",
        "",
        "Data Storage and Protection",
        "",
        "Personal information is stored on secure servers with encryption at rest and in transit. Database access is restricted to authorized personnel only with multi-factor authentication required. Regular security audits, penetration testing, and vulnerability assessments ensure ongoing protection. We employ industry-standard security measures including firewalls, intrusion detection, and DDoS protection.",
        "",
        "Payment information is not stored on our servers. Credit card details are tokenized by PCI-compliant payment processors. We receive only anonymized payment tokens for transaction processing. Full card numbers are never visible to our staff or stored in our systems. This reduces risk and ensures compliance with payment card industry security standards.",
        "",
        "Data backups are performed daily and stored in geographically distributed locations. Backup data receives the same security protections as production data. Disaster recovery procedures enable service restoration within 24-48 hours of catastrophic events. Backup retention follows data protection regulations with automatic deletion after required retention periods.",
        "",
        "Account Security Best Practices",
        "",
        "Create strong unique passwords with minimum 12 characters including uppercase, lowercase, numbers, and symbols. Never reuse passwords across multiple sites. Password managers securely store and generate strong passwords. We'll never ask for your password via email or phone - any such request is a phishing attempt that should be reported.",
        "",
        "Enable two-factor authentication in account security settings for enhanced protection. Two-factor authentication requires both your password and a temporary code from your phone or authenticator app to access your account. This prevents unauthorized access even if your password is compromised. Backup codes should be saved securely for account recovery if your 2FA device is lost.",
        "",
        "Monitor your account activity regularly in the Account Activity section showing recent logins, IP addresses, devices, and locations. Unfamiliar activity may indicate unauthorized access requiring immediate password change. Enable login notifications to receive alerts when your account is accessed from new devices or locations.",
        "",
        "Log out when using shared or public computers. Browser \"remember me\" options should only be used on personal devices. Clear browser cache and cookies on shared devices after accessing your account. Public WiFi networks are inherently insecure - avoid accessing sensitive accounts or use VPN protection on public networks.",
        "",
        "Data Sharing and Third Parties",
        "",
        "We share information with service providers who perform business functions on our behalf: payment processors, shipping carriers, email service providers, cloud hosting providers, customer service platforms, and analytics services. These providers access only information necessary for their specific functions and are contractually obligated to protect data confidentiality and use information solely for agreed purposes.",
        "",
        "Shipping carriers receive recipient names, addresses, and phone numbers necessary for delivery. Payment processors receive billing information to process transactions. Email providers receive addresses to send order confirmations and updates. Analytics services receive anonymized usage data to improve service quality. None of these providers may use information for their own marketing without your explicit consent.",
        "",
        "We may disclose information when required by law, legal process, litigation, or government requests. We'll notify users of legal demands for information unless prohibited by law or when disclosure might create safety risks. We contest overbroad or inappropriate demands for customer information and publish transparency reports detailing government data requests.",
        "",
        "We do not sell, rent, or trade personal information to third parties for their marketing purposes. Aggregated anonymized data may be shared for industry research, trend analysis, or business intelligence without identifying individual users. Any business sale or merger requires successor entities to honor this privacy policy regarding existing customer data.",
        "",
        "User Rights and Data Control",
        "",
        "Access your personal information anytime through account settings. Download a complete copy of your data in machine-readable format via the Privacy Dashboard. This includes profile information, order history, communications, and usage data. Data portability enables you to transfer information to other services.",
        "",
        "Request correction of inaccurate personal information through account settings or by contacting customer support. We'll verify your identity and update records within 30 days. Some information like order histories cannot be altered as they represent factual transaction records, but supplementary corrections or clarifications can be noted.",
        "",
        "Delete your account and personal information through account settings or customer support. Account deletion is permanent and cannot be reversed. We retain certain information as required by law for tax, accounting, fraud prevention, or legal compliance purposes - typically 7 years for financial records. After required retention periods, information is permanently deleted from all systems including backups.",
        "",
        "Opt out of marketing communications via unsubscribe links in emails or account communication preferences. Marketing opt-out doesn't affect transactional messages necessary for service provision. California residents have additional rights under CCPA including the right to know what information is collected and the right to non-discrimination for exercising privacy rights.",
        "",
        "Cookies and Tracking Technologies",
        "",
        "We use cookies, web beacons, and similar technologies to enhance user experience, remember preferences, analyze site usage, and deliver relevant content. Essential cookies enable core functionality like shopping cart and account authentication. These cookies are necessary for site operation and cannot be disabled.",
        "",
        "Analytics cookies collect aggregated information about site usage, page views, navigation paths, and feature usage. This helps us understand how customers interact with our service and identify improvement opportunities. Marketing cookies track effectiveness of advertising campaigns and may display personalized ads on other websites you visit.",
        "",
        "You control cookie preferences through browser settings or our cookie consent manager. Blocking certain cookies may limit site functionality. Browser Do Not Track signals are respected for third-party advertising cookies. First-party operational cookies remain necessary for site functionality regardless of Do Not Track settings.",
        "",
        "Third-party cookies from social media plugins, analytics providers, or advertising networks may be present. These third parties have their own privacy policies governing their data collection and use. Review third-party privacy policies to understand their data practices. We contractually limit third-party data usage to agreed purposes.",
        "",
        "Children's Privacy",
        "",
        "Our services are not directed to children under 13 years old. We do not knowingly collect personal information from children under 13. If we learn we've collected child information without parental consent, we'll delete it promptly. Parents who believe we've collected child information should contact us immediately for deletion.",
        "",
        "Age verification during account creation prevents children from registering. Some services may be appropriate for minors aged 13-17 with parental consent. Parental controls enable parents to manage minor children's access and activity. Parents can review, modify, or delete children's information through family account management features.",
        "",
        "Educators using our services in classroom settings must obtain appropriate parental consents required by COPPA and FERPA regulations. Educational accounts have enhanced privacy protections and limited data collection. Student data is used solely for educational purposes and is never used for marketing. Educational data is deleted when no longer needed for educational purposes or upon request.",
        "",
        "Data Breach Notification",
        "",
        "Despite strong security measures, no system is completely invulnerable. In the unlikely event of a data breach affecting personal information, we'll notify affected users within 72 hours of discovering the breach as required by law. Notification includes details about compromised information types, breach circumstances, steps we're taking, and recommended actions for affected users.",
        "",
        "Breach notifications are sent via email to registered addresses with additional notice on our website and social media channels. Notifications include information about free credit monitoring services if financial information was compromised. We'll cooperate with law enforcement investigations and regulatory authorities regarding any breach incidents.",
        "",
        "Report suspected security vulnerabilities or breaches to security@ourservice.com. We take all reports seriously and investigate promptly. Responsible disclosure of security issues allows us to fix problems before exploitation. We won't take legal action against security researchers who report vulnerabilities responsibly without exploiting or disclosing them publicly before we can remediate.",
        "",
        "International Data Transfers",
        "",
        "We operate globally with data processing occurring in multiple countries. Personal information may be transferred to and stored in countries different from your residence. These countries may have different data protection laws than your jurisdiction. We ensure appropriate safeguards are in place for international transfers through standard contractual clauses, adequacy decisions, or other legal mechanisms.",
        "",
        "European Union and UK users' data transfers outside the EU/UK are protected by Standard Contractual Clauses approved by European authorities. These contracts require recipients to provide equivalent protection to EU/UK data protection standards. Users can request copies of transfer safeguard documents from our privacy team.",
        "",
        "Privacy rights vary by jurisdiction. European users have rights under GDPR including data portability, right to be forgotten, and right to object to processing. California residents have rights under CCPA. Other jurisdictions may provide additional rights. Contact our privacy team to exercise jurisdiction-specific privacy rights applicable to your location.",
        "",
        "Policy Updates and Changes",
        "",
        "This privacy policy may be updated periodically to reflect changing practices, technologies, or legal requirements. Material changes will be prominently announced via email and website notice at least 30 days before taking effect. Policy version dates appear at the top of this document. Continued use of services after policy changes constitutes acceptance of updated terms.",
        "",
        "Review privacy policy updates to stay informed about how we protect and use your information. Significant changes require renewed consent for affected practices. You may decline consent and close your account if you disagree with policy changes. Previous policy versions are archived and available upon request.",
        "",
        "Contact our privacy team at privacy@ourservice.com with questions, concerns, or requests regarding this privacy policy or our data practices. We'll respond to privacy inquiries within 30 days. You may also contact our Data Protection Officer for EU/UK-related privacy matters at dpo@ourservice.com."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/return_refund_policy.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Return and Refund Policy",
        "",
        "Return Eligibility and Time Limits",
        "",
        "Physical products may be returned within 30 days of delivery for a full refund if unused, undamaged, and in original packaging with all accessories and documentation. The 30-day window begins on the delivery date shown in your shipping confirmation, not the order date. Items purchased during promotional periods follow the same return policy unless explicitly stated otherwise.",
        "",
        "Certain product categories have modified return periods or restrictions. Software licenses and digital downloads are non-returnable once activation codes are revealed or downloads initiated. Opened hygiene products, personalized items, and clearance merchandise marked \"final sale\" cannot be returned for safety or business reasons. Gift cards and subscription services are non-refundable except where required by law.",
        "",
        "To initiate a return, log into your account and select the order from your purchase history. Click \"Return Items\" and follow the return authorization process. You'll receive a return merchandise authorization (RMA) number and prepaid shipping label via email within 24 hours. Include the RMA number on the outside of the return package.",
        "",
        "Condition Requirements for Refunds",
        "",
        "Returned items must be in resalable condition to qualify for full refund. Products showing signs of use, damage, missing components, or removed serial numbers may be subject to partial refunds or rejected returns. We inspect all returns upon receipt before processing refunds. Restocking fees of 15-25% may apply to items returned in non-original condition.",
        "",
        "Original packaging must be intact and unmarked. Do not write or place stickers directly on manufacturer packaging - use an outer shipping box. Include all manuals, cables, accessories, warranty cards, and bonus items that came with the product. Missing accessories reduce refund amounts proportionally to their value.",
        "",
        "Electronic devices must be factory reset before return to remove personal data. We're not responsible for personal information left on returned devices. Failure to wipe devices may delay refund processing while we perform data erasure for your protection. Consult device manuals for factory reset procedures.",
        "",
        "Refund Processing Timeline",
        "",
        "Refunds are processed within 5-7 business days after we receive and inspect your return. You'll receive email confirmation when your return is received and again when the refund is approved. Actual credit to your account depends on your financial institution and typically takes an additional 3-5 business days for credit cards or 5-10 business days for bank transfers.",
        "",
        "Original shipping charges are non-refundable unless the return is due to our error such as wrong item shipped or defective product. Return shipping costs are your responsibility for buyer's remorse returns. Use the prepaid label we provide or choose your own carrier - you're responsible for return shipping costs regardless of method chosen.",
        "",
        "Refunds are issued to the original payment method used for purchase. Credit card refunds return to the same card number. PayPal purchases receive PayPal refunds. Purchases made with multiple payment methods are refunded proportionally to each method. Gift card purchases receive account credit or replacement gift cards rather than cash refunds.",
        "",
        "Defective or Damaged Products",
        "",
        "Report defective items or shipping damage within 48 hours of delivery for fastest resolution. Take photos of all damage including outer packaging, inner packaging, and the product itself. Submit photos through our returns portal along with your order number. We may file shipping insurance claims requiring this documentation.",
        "",
        "Defective products receive free return shipping and full refunds including original shipping costs. We'll email a prepaid return label immediately upon defect verification. Alternatively, request an exchange for the same product. Exchanges ship as soon as we receive the defective item, or we can ship the replacement immediately and charge your card if the defective item isn't returned within 14 days.",
        "",
        "Manufacturing defects discovered within the manufacturer's warranty period should be processed directly with the manufacturer for potentially faster resolution. We facilitate warranty service for items purchased from us. Warranty service often provides repairs or replacements without requiring product returns to us. Contact our support team for warranty claim assistance.",
        "",
        "Wrong Item Received",
        "",
        "We occasionally ship incorrect items due to warehouse picking errors. Contact customer service immediately upon receiving wrong items. We'll arrange free return pickup and expedite shipment of correct items. Priority processing ensures correct items ship within 24 hours, usually before the wrong item is even picked up.",
        "",
        "Do not refuse delivery or return items to carrier without authorization. Carrier-refused packages experience significant processing delays. Accept delivery, then contact us for return authorization. We track all shipments and proactively reach out if tracking indicates delivery issues, but customer notification speeds resolution.",
        "",
        "Keep wrong items in original unopened condition when possible. Opened wrong items are still eligible for free return and exchange, but unopened items can be processed faster. You're not responsible for costs associated with our shipping errors including return shipping, restocking, or original shipping charges.",
        "",
        "Digital Products and Subscriptions",
        "",
        "Digital software licenses, downloadable content, and online courses are non-refundable once access is granted or activation codes revealed. We cannot revoke licenses or verify deletion of downloaded content, making refunds impractical. Review product descriptions, system requirements, and trial versions before purchasing.",
        "",
        "Subscription services can be cancelled at any time, but refunds for partial billing periods are not provided except where legally required. Service access continues through the end of the paid period after cancellation. Auto-renewal can be disabled in account settings to prevent future charges while maintaining current access.",
        "",
        "Technical issues preventing access to digital purchases may qualify for refunds at our discretion. Contact technical support first to resolve access problems. If technical support cannot restore access within 48 hours, refund requests will be evaluated case-by-case based on the specific circumstances.",
        "",
        "Exchanges and Store Credit",
        "",
        "Product exchanges for different items require processing the return for refund and placing a new order. We cannot guarantee inventory availability for exchanges. To secure replacement items before returning originals, place a new order and process the original as a separate return. Some customers prefer store credit rather than waiting for refunds to original payment methods.",
        "",
        "Store credit issued for returns can be used for future purchases without expiration. Credits are applied to your account and automatically appear as payment options during checkout. Store credit cannot be transferred between accounts, redeemed for cash, or used to purchase gift cards.",
        "",
        "Damaged, defective, or wrong items receive free exchanges with prepaid return shipping. Preference changes or buyer's remorse exchanges require return shipping payment. Consider size or compatibility issues carefully before ordering to minimize exchange needs. Detailed product descriptions, specifications, and customer reviews help prevent ordering wrong items.",
        "",
        "International Returns",
        "",
        "International return shipping costs can be substantial. Contact customer support before initiating international returns to discuss options. In some cases, partial refunds accounting for return shipping costs may be more economical than physical returns. Each situation is evaluated individually to find fair resolution.",
        "",
        "International customers are responsible for any customs duties, taxes, or fees incurred during returns. These charges are not refundable as they were paid to government agencies rather than to us. Declare returned merchandise accurately on customs forms to minimize return-related customs charges.",
        "",
        "International return processing takes longer due to shipping times and customs clearance. Allow 3-4 weeks for international returns to reach our warehouse. Refunds process within 5-7 business days after receipt. Use tracked shipping methods for international returns to monitor delivery progress and provide proof of return if needed.",
        "",
        "Restocking Fees",
        "",
        "Non-defective returns of opened electronics, large appliances, and special order items incur 15% restocking fees to offset depreciation and re-certification costs. Restocking fees are deducted from refund amounts. The fee covers inspection, cleaning, repackaging, and return to inventory. Items showing any use or cosmetic imperfection may incur higher restocking fees up to 25%.",
        "",
        "No restocking fees apply to defective items, wrong items shipped, or items returned unopened in original condition. Restocking fees are clearly indicated during the return authorization process before you commit to the return. If the fee seems excessive, contact customer service to discuss the assessment.",
        "",
        "Refused or Abandoned Returns",
        "",
        "Returns must be shipped within 14 days of receiving the RMA number. RMA numbers expire after 14 days, requiring new authorization for subsequent return attempts. Expired RMA returns may be refused by our warehouse or treated as unauthorized returns subject to receiving fees before processing.",
        "",
        "Packages sent to us without return authorization are held for 30 days awaiting customer contact. Unauthorized returns cannot be matched to orders or customers without RMA numbers. Contact customer service if you shipped a return without authorization. After 30 days without contact, unauthorized returns are disposed of or donated without refund."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/service_level_agreement.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Service Level Agreement (SLA) for Customer Support",
        "",
        "Response Time Commitments",
        "",
        "Our customer support team is committed to providing timely responses based on issue priority and customer tier. Response times are measured from initial ticket submission to first agent response during business hours. Business hours are Monday through Friday, 8:00 AM to 8:00 PM EST, excluding federal holidays.",
        "",
        "Critical Priority Issues (System Down, Security Breach, Payment Failures)",
        "- Enterprise Customers: 1 hour response time, 24/7 availability",
        "- Professional Customers: 2 hour response time during business hours",
        "- Standard Customers: 4 hour response time during business hours",
        "",
        "High Priority Issues (Major Feature Unavailable, Recurring Problems, Billing Disputes)",
        "- Enterprise Customers: 4 hour response time, 24/7 availability",
        "- Professional Customers: 8 hour response time during business hours",
        "- Standard Customers: 12 hour response time during business hours",
        "",
        "Medium Priority Issues (Minor Feature Issues, General Questions, How-To Requests)",
        "- Enterprise Customers: 8 hour response time",
        "- Professional Customers: 24 hour response time",
        "- Standard Customers: 48 hour response time",
        "",
        "Low Priority Issues (Feature Requests, General Feedback, Documentation Questions)",
        "- Enterprise Customers: 24 hour response time",
        "- Professional Customers: 48 hour response time",
        "- Standard Customers: 72 hour response time",
        "",
        "Priority classification is determined by business impact, number of affected users, and availability of workarounds. Customers cannot manually set priority levels; our triage team assigns priority based on issue description and account tier.",
        "",
        "Resolution Time Objectives",
        "",
        "Resolution time measures from initial ticket submission to complete issue resolution and customer confirmation. These are target objectives, not guarantees, as resolution complexity varies significantly between issues.",
        "",
        "Critical Priority: 4-8 hours for Enterprise, 8-24 hours for Professional, 24-48 hours for Standard",
        "High Priority: 24-48 hours for Enterprise, 48-72 hours for Professional, 3-5 business days for Standard",
        "Medium Priority: 2-5 business days for Enterprise, 5-7 business days for Professional, 7-10 business days for Standard",
        "Low Priority: 5-10 business days for Enterprise, 10-14 business days for Professional, 14-21 business days for Standard",
        "",
        "Complex issues requiring engineering involvement, third-party coordination, or extensive investigation may exceed these objectives. Customers receive regular status updates every 24-48 hours for ongoing issues until resolution.",
        "",
        "Support Channels and Availability",
        "",
        "Email Support: Available 24/7 for all customer tiers. Emails sent outside business hours receive responses when support operations resume. Enterprise customers receive priority queue placement ensuring faster response times.",
        "",
        "Live Chat Support: Available during business hours (8 AM - 8 PM EST, Monday-Friday) for Professional and Enterprise customers. Standard customers have access to AI-powered chat assistance 24/7 with agent escalation during business hours.",
        "",
        "Phone Support: Available 9 AM - 6 PM EST, Monday-Friday for Professional and Enterprise customers. Enterprise customers have access to dedicated support phone lines with extended hours and escalation paths. Standard customers may request phone callbacks for high-priority issues at agent discretion.",
        "",
        "Emergency Hotline: Enterprise customers receive emergency hotline numbers for critical issues requiring immediate assistance outside normal business hours. Emergency line is staffed 24/7/365 for system-down situations affecting business operations.",
        "",
        "Customer Portal: Self-service portal available 24/7 for all customers providing knowledge base access, ticket submission, status tracking, and account management. Portal uptime guarantee of 99.9% with scheduled maintenance announced 7 days in advance.",
        "",
        "Escalation Procedures",
        "",
        "First Level Support: All tickets begin with our front-line support team handling common issues, account questions, and basic troubleshooting. 80% of issues are resolved at this level without escalation.",
        "",
        "Second Level Support: Complex technical issues, bugs, or unresolved first-level tickets escalate to specialized technical support teams. Escalation occurs automatically after 3 business days without resolution or immediately for critical issues.",
        "",
        "Third Level Support: Engineering team involvement for software defects, architectural issues, or system-level problems requiring code changes or infrastructure modifications. Engineering escalations follow formal bug tracking and release cycle processes.",
        "",
        "Management Escalation: Unresolved issues after 7 business days or customer dissatisfaction with support quality can be escalated to support management. Enterprise customers have direct access to dedicated account managers for escalation coordination.",
        "",
        "Executive Escalation: Prolonged unresolved issues, major business impact, or failed management escalations can be escalated to executive support leadership. Executive escalations trigger executive review meetings and dedicated resolution task forces.",
        "",
        "Customers can request escalation at any time if they feel their issue requires higher-level attention. Escalation requests are reviewed within 24 hours and approved based on issue severity and resolution progress.",
        "",
        "Performance Metrics and Reporting",
        "",
        "First Response Time: Percentage of tickets receiving initial response within SLA commitments. Current performance: 95% for Enterprise, 92% for Professional, 88% for Standard.",
        "",
        "Resolution Time: Percentage of tickets resolved within target timeframes. Current performance: 87% for Enterprise, 84% for Professional, 79% for Standard.",
        "",
        "Customer Satisfaction (CSAT): Post-resolution survey responses rating support interaction quality. Current average: 4.6/5.0 across all tiers.",
        "",
        "First Contact Resolution: Percentage of issues resolved during initial support interaction without follow-up required. Current performance: 73% across all tiers.",
        "",
        "Ticket Reopening Rate: Percentage of resolved tickets reopened due to incomplete resolution or recurring issues. Target: Below 8%. Current performance: 6.2%.",
        "",
        "Monthly SLA reports are provided to Enterprise customers showing performance against commitments, ticket volume trends, and common issue categories. Professional customers receive quarterly reports upon request.",
        "",
        "Exclusions and Limitations",
        "",
        "SLA commitments do not apply to: issues caused by customer misuse or unauthorized modifications, third-party service outages beyond our control, scheduled maintenance windows announced 7+ days in advance, force majeure events (natural disasters, pandemics, civil unrest), internet connectivity issues on customer side, or unsupported configurations not covered in documentation.",
        "",
        "Response and resolution times may be extended during peak support periods, major version releases, or widespread service disruptions affecting multiple customers. Customers receive notification when SLA extensions are in effect.",
        "",
        "Support is provided in English only. Customers requiring support in other languages may experience delays while translation resources are arranged. Technical support covers current software versions and one prior major version. Legacy versions are not supported under standard SLA.",
        "",
        "SLA Credits and Remediation",
        "",
        "Enterprise customers receive SLA credits for failures to meet committed response times:",
        "- Missing Critical response time: 10% monthly service credit",
        "- Missing High response time 3+ times per month: 5% monthly service credit",
        "- Missing Medium response time 5+ times per month: 3% monthly service credit",
        "",
        "SLA credits are applied automatically to next month's invoice and do not require customer request. Credits are capped at 25% of monthly service fees per month regardless of multiple SLA failures.",
        "",
        "Professional customers do not receive automatic SLA credits but may request service credits for significant support failures through account review process.",
        "",
        "Standard customers are not eligible for SLA credits but receive best-effort support with continuous improvement focus.",
        "",
        "Knowledge Base and Self-Service",
        "",
        "Comprehensive knowledge base contains 500+ articles covering common issues, how-to guides, troubleshooting procedures, and best practices. Knowledge base is searchable and organized by topic, updated weekly based on support ticket trends.",
        "",
        "Video tutorials demonstrate complex procedures and feature usage. Tutorial library contains 50+ videos ranging from 2-15 minutes in length covering beginner through advanced topics.",
        "",
        "Community forums enable peer-to-peer support and knowledge sharing. Forums are moderated by support staff who verify technical accuracy of community-provided solutions. Top community contributors receive recognition and early access to new features.",
        "",
        "Self-service resources enable customers to resolve many issues independently outside support hours. Knowledge base analytics show 40% of support tickets include knowledge base article references in resolution.",
        "",
        "Continuous Improvement Commitment",
        "",
        "Quarterly service reviews analyze support metrics, customer feedback, and emerging trends to identify improvement opportunities. New knowledge base articles, process refinements, and agent training programs address identified gaps.",
        "",
        "Customer feedback surveys follow every support interaction requesting ratings and comments. Feedback directly influences agent performance evaluations, training priorities, and process improvements.",
        "",
        "Root cause analysis for recurring issues identifies systematic problems requiring product changes, documentation improvements, or process modifications. Engineering receives prioritized enhancement requests based on support impact analysis.",
        "",
        "Annual SLA reviews evaluate performance against commitments and adjust objectives based on business growth, technology changes, and customer expectations. SLA modifications require 90-day advance notice to customers."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/shipping_delivery_policy.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Shipping and Delivery Policy",
        "",
        "Processing Time and Order Fulfillment",
        "",
        "Orders placed before 2:00 PM EST on business days ship the same day. Orders placed after 2:00 PM EST or on weekends and holidays are processed the next business day. Business days are Monday through Friday excluding federal holidays. During high-volume periods like holidays, processing may extend to 1-2 business days.",
        "",
        "Order processing involves payment authorization, fraud screening, inventory verification, picking, packing, and carrier handoff. You'll receive an order confirmation email immediately after placing your order and a shipping confirmation with tracking number once the package leaves our warehouse. Most orders ship within 24 hours of order placement.",
        "",
        "Customized, personalized, or made-to-order products require additional production time before shipping. Estimated production times are displayed on product pages and vary by item complexity. Custom orders typically ship within 5-10 business days. You'll receive production status updates via email and can check progress in your account dashboard.",
        "",
        "Shipping Methods and Delivery Times",
        "",
        "Standard shipping via USPS or UPS Ground delivers within 5-7 business days after shipment. Expedited shipping options include 3-day, 2-day, and overnight delivery. Expedited delivery times are business days from shipment date, not order date. Choose expedited shipping at checkout and ensure orders are placed before cutoff time for same-day processing.",
        "",
        "Delivery times are estimates, not guarantees. Carrier delays due to weather, natural disasters, customs processing, or logistical issues are beyond our control. We're not responsible for carrier delays, but we'll assist with tracking and carrier communication for significantly delayed shipments. Contact carriers directly for real-time delivery information.",
        "",
        "Weekend and holiday delivery is not available for most shipping methods. Packages in transit over weekends show no tracking updates until the next business day. UPS and FedEx offer Saturday delivery for additional fees on some service levels. USPS Priority Mail may deliver on Saturdays depending on destination. Sunday delivery is generally unavailable except for Amazon Logistics in select areas.",
        "",
        "Shipping Costs and Calculation",
        "",
        "Shipping costs are calculated based on package weight, dimensions, destination, and selected shipping method. Real-time carrier rates are displayed during checkout before payment. Some promotions include free standard shipping - details appear on product pages and during checkout. Free shipping typically applies only to standard ground service within the continental United States.",
        "",
        "Oversized or heavy items may incur special handling fees beyond standard shipping costs. Weight-based pricing transitions to dimensional weight pricing for large but lightweight packages. Dimensional weight is calculated as length × width × height ÷ 166 (for inches) or 5000 (for centimeters). Items charged by dimensional weight are noted on product pages.",
        "",
        "Multi-item orders may ship from multiple warehouse locations to optimize delivery speed and costs. This results in multiple tracking numbers for one order. You'll receive separate shipping confirmations for each package. Partial shipments don't incur additional charges - total shipping cost is calculated on the complete order before splitting.",
        "",
        "Delivery Address Accuracy",
        "",
        "Verify your shipping address carefully before completing checkout. Address validation tools catch many errors, but you're responsible for ensuring accuracy. Incorrect addresses cause delivery delays, return-to-sender situations, or package loss. Correcting addresses after shipment is difficult or impossible depending on carrier and shipment progress.",
        "",
        "We ship to the address provided during checkout exactly as entered. If you realize an address error after ordering, contact customer service immediately - before order processing we can sometimes update the shipping address. After carrier pickup, address changes must be made through the carrier's interception or delivery change services which charge fees.",
        "",
        "Post office boxes are acceptable for small packages shipped via USPS. UPS and FedEx generally cannot deliver to PO boxes - use street addresses for non-USPS carriers. Some products cannot ship to PO boxes due to size or signature requirements. Address type restrictions are noted during checkout if applicable. Military APO/FPO addresses are supported via USPS with extended delivery times.",
        "",
        "International Shipping",
        "",
        "International shipping is available to most countries with extended delivery times of 7-21 business days depending on destination and customs clearance. International orders may incur customs duties, taxes, import fees, and brokerage charges upon delivery. These charges are the recipient's responsibility and are not included in order totals or shipping costs.",
        "",
        "Customs charges vary by country, product type, and declared value. Research your country's customs policies before ordering internationally. We cannot control or predict customs charges. Refusing delivery due to customs fees does not eliminate your responsibility for these charges and may result in package abandonment without refund.",
        "",
        "International shipments require customs declarations with accurate product descriptions and values. Deliberate misdeclaration to avoid customs fees is illegal and violates our terms of service. We declare actual product values on customs forms as required by law. International returns are customer's responsibility including return shipping costs and any customs fees incurred.",
        "",
        "Tracking and Delivery Confirmation",
        "",
        "Tracking numbers are emailed within 24 hours of shipment and are also visible in your order history. Allow 24 hours after receiving tracking numbers for information to appear in carrier systems. Tracking updates may be infrequent during transit - gaps of 24-48 hours between scans are normal, especially in rural areas.",
        "",
        "Signature confirmation can be requested during checkout for valuable items or added to existing orders before shipment. Some high-value items automatically include signature confirmation for security. If signature confirmation wasn't selected and you won't be home during delivery, carriers often allow release authorization or alternative delivery locations through their websites.",
        "",
        "Delivered packages show \"Delivered\" status in tracking with timestamp and location - \"Front door,\" \"Mailbox,\" etc. Check all potential delivery locations including side doors, garages, porches, mailrooms, or with neighbors. Delivery drivers sometimes leave packages in less visible locations for security. Contact carriers if tracking shows delivery but you cannot locate the package.",
        "",
        "Missing or Lost Packages",
        "",
        "If tracking shows delivery but you didn't receive the package, first check with neighbors, household members, building management, or mail rooms. Check all entrances and less obvious delivery spots. Misdeliveries to similar addresses are common - neighbors often hold packages for later return.",
        "",
        "Wait 24 hours after delivered status before reporting packages as missing - carriers occasionally mark packages delivered prematurely, with actual delivery following shortly. If 24 hours pass without locating the package, contact us to initiate a carrier investigation. Lost package claims require carrier investigations taking 5-10 business days.",
        "",
        "Once carriers conclude investigations, we'll reship lost items or issue refunds. We cannot reship or refund before investigation completion. For time-sensitive orders, you may purchase replacement items immediately and we'll refund if investigations confirm loss. Frequent missing package claims may require signature confirmation for future orders as a security measure.",
        "",
        "Delivery Delays and Service Disruptions",
        "",
        "Weather events, natural disasters, pandemic-related disruptions, or peak season congestion cause systemic carrier delays. These affect all shippers and cannot be avoided. We post service alerts on our shipping information page when widespread delays are occurring. Consider ordering early during known busy periods to ensure timely delivery.",
        "",
        "If your package shows no tracking updates for 7+ business days while in carrier possession, contact us to investigate potential transit issues. We'll coordinate with carriers to locate packages and determine estimated delivery. Significantly delayed packages may qualify for reshipment at our discretion if resolution is not forthcoming.",
        "",
        "Shipping refunds for late expedited delivery are provided when delays result from our error - such as late handoff to carrier or incorrect service level. Carrier-caused delays for expedited services may qualify for shipping refunds directly from carriers - we'll provide necessary documentation for carrier claims. Standard shipping refunds are not provided for late delivery as timeframes are estimates only.",
        "",
        "Refused or Undeliverable Packages",
        "",
        "Packages refused at delivery or deemed undeliverable by carriers return to our warehouse. Common undeliverable reasons include insufficient address, recipient moved, no access to delivery location, or excess storage time at carrier facilities. You'll be notified of returns with options to correct address and reship or cancel for refund.",
        "",
        "Reshipping refused or returned packages requires new shipping payment at current rates. Original shipping charges are not refunded for buyer-initiated refusals or incorrect addresses. If the undeliverable situation resulted from our error, reshipping is free. Review address carefully before ordering to avoid return-to-sender scenarios and delays.",
        "",
        "Unclaimed packages held at carrier facilities or post offices are eventually returned as undeliverable. Track packages and respond to carrier delivery notices promptly. Carriers typically hold packages 5-15 days depending on service level before returning to sender. Retrieve packages from carrier facilities before hold periods expire to avoid return-to-sender processing.",
        "",
        "Damaged in Transit",
        "",
        "Inspect packages immediately upon delivery before accepting them. Visible outer box damage should be noted with the delivery driver and photographed. Carriers may allow refusal of obviously damaged packages. If damage isn't visible until opening, document everything with photos showing outer box, inner packaging, and product damage.",
        "",
        "Report shipping damage within 48 hours of delivery with photos for fastest resolution. We'll file carrier damage claims and arrange replacement shipment or refund. Keep all packaging materials until the claim is resolved - carriers may request inspection of damaged items and packaging. Claims require complete packaging for investigation.",
        "",
        "Damaged items should not be discarded or returned without authorization. Disposing of damaged items before claim completion may invalidate claims. We handle all carrier claim filing - you don't need to contact carriers directly about damage. Once damage is confirmed, we ship replacements immediately rather than waiting for claim resolution.",
        "",
        "Holiday Shipping Deadlines",
        "",
        "Order by specific cutoff dates to ensure holiday delivery. Holiday shipping deadlines are posted on our homepage and shipping information page starting in November. These deadlines account for carrier capacity constraints during peak seasons. Order well before deadlines to accommodate potential delays.",
        "",
        "Last-minute orders require expedited shipping for holiday delivery guarantee. Standard shipping isn't recommended within 2 weeks of major holidays due to unpredictable delays. Consider sending digital gift cards if ordering close to holidays - these deliver instantly via email.",
        "",
        "December carrier cutoff dates for end-of-year holidays vary by service level: Standard Ground by December 15th, 3-Day by December 20th, 2-Day by December 22nd, Overnight by December 23rd. These are approximate dates that vary yearly - check current year deadlines on our website. International holiday orders require even earlier placement, typically early December."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/software_installation_troubleshooting.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Software Installation Troubleshooting Guide",
        "",
        "Installation Fails with \"Insufficient Permissions\" Error",
        "",
        "This error indicates the installer lacks administrative rights to modify system files or registry entries. Right-click the installer executable and select \"Run as Administrator\" from the context menu. On macOS, you may need to enter your administrator password during installation. Linux users should use sudo or ensure proper file permissions in the installation directory.",
        "",
        "If running as administrator doesn't resolve the issue, check that your user account has proper administrative privileges in your operating system's user management settings. Corporate or managed devices may require IT department assistance to grant necessary permissions.",
        "",
        "Antivirus Software Blocking Installation",
        "",
        "Security software sometimes flags legitimate installers as suspicious due to code signing issues or behavioral analysis. Temporarily disable your antivirus protection during installation, then re-enable it immediately afterward. Add the installer and application directory to your antivirus whitelist to prevent future conflicts.",
        "",
        "If you're uncomfortable disabling antivirus protection, verify the installer's digital signature by right-clicking the file and checking Properties > Digital Signatures. Our installers are signed by \"TechCorp Software LLC\" with a valid certificate. Never disable antivirus for unsigned or suspicious installers.",
        "",
        "Installation Hangs or Freezes at Specific Percentage",
        "",
        "First, ensure no other applications are using excessive system resources during installation. Close unnecessary programs, especially other installation processes, system utilities, or backup software. Check Task Manager (Windows) or Activity Monitor (Mac) for high CPU or disk usage that might slow installation.",
        "",
        "If installation consistently freezes at the same point, there may be a corrupted download. Delete the installer file and download a fresh copy from our official website. Verify the file checksum matches the value published on our download page. Unstable internet connections can corrupt large downloads.",
        "",
        "Some installations hang during the \"Configuring system components\" phase while waiting for system services. Restart your computer and try installation again. Disable any virtual private network (VPN) or proxy connections that might interfere with license activation or component downloads.",
        "",
        "\"Installation Directory Not Found\" Error",
        "",
        "The installer cannot access or create the specified installation directory. This typically occurs when targeting network drives, external storage, or locations with restricted permissions. Install to your local primary drive (typically C: on Windows or /Applications on macOS) unless you have specific reasons to use alternative locations.",
        "",
        "Verify the installation path doesn't contain special characters, unicode symbols, or excessive length. Windows has a 260-character path length limit that can cause failures. Shorten folder names in the installation path if necessary. Some characters like <, >, :, \", |, ?, * are forbidden in Windows paths.",
        "",
        "Missing Dependencies or Prerequisites",
        "",
        "Our software requires certain system libraries, runtime environments, or frameworks to function. The installer should automatically download these, but failures can occur. Check the error message for specific missing components like \".NET Framework 4.8\", \"Visual C++ Redistributables\", or \"Java Runtime Environment\".",
        "",
        "Visit our support website's Downloads section for manual dependency installers. Install prerequisites separately before retrying the main application installation. On Linux systems, use your package manager to install required libraries listed in our documentation.",
        "",
        "Installation Completes But Application Won't Launch",
        "",
        "Verify the installation actually completed successfully by checking the installation directory for application files. Look for the main executable file and supporting libraries. Incomplete installations may appear successful but lack critical components.",
        "",
        "Try launching the application as administrator, which can bypass certain permission issues. Check Windows Event Viewer (eventvwr.msc) or system logs for error messages when attempting to launch. These logs often provide specific details about missing files or configuration problems.",
        "",
        "If you recently upgraded from a previous version, uninstall the old version completely before installing the new version. Some upgrades fail due to conflicting file versions or registry entries. Use our official uninstaller rather than manual file deletion to ensure clean removal.",
        "",
        "Installer File Corrupted or Won't Run",
        "",
        "Download integrity problems prevent installers from executing. Verify the downloaded file size matches the expected size listed on our website. Compare the file's MD5 or SHA-256 hash with published checksums using tools like certutil (Windows) or shasum (Mac/Linux).",
        "",
        "Browser download managers or security software sometimes quarantine or modify downloaded files. Check your Downloads folder, browser's download history, and security software quarantine for the complete installer. Download using a different browser if problems persist.",
        "",
        "For Windows users, ensure the .exe file association hasn't been corrupted. You can manually repair file associations through Default Apps settings. On macOS, right-click the installer and select \"Open\" to bypass Gatekeeper security if the installer is from an identified developer but won't launch normally."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/software_product_faq.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Software Product FAQ - CloudSync Pro",
        "",
        "Q: How do I install CloudSync Pro on my computer?",
        "A: Download the installer from our website, run the setup wizard, and sign in with your account credentials. The application will automatically configure itself based on your subscription tier. Installation typically takes 3-5 minutes. Make sure you have administrator privileges on your machine before beginning the installation process.",
        "",
        "Q: What are the system requirements?",
        "A: CloudSync Pro requires Windows 10 or later, macOS 10.15 or later, or Ubuntu 20.04 or later. You need at least 4GB of RAM, 500MB of free disk space, and a stable internet connection with minimum 5Mbps bandwidth. For optimal performance, we recommend 8GB RAM and SSD storage.",
        "",
        "Q: How many devices can I sync with one account?",
        "A: Basic plans support up to 3 devices, Professional plans allow 10 devices, and Enterprise plans offer unlimited device connections. Each device must be authorized through your account dashboard. You can deauthorize devices remotely if needed.",
        "",
        "Q: Can I share files with people who don't have CloudSync Pro?",
        "A: Yes, you can create public or password-protected share links that anyone can access through a web browser. Recipients can view and download files without creating an account. Link permissions can be customized to allow viewing only, downloading, or uploading. Links can be set to expire after a specified time period.",
        "",
        "Q: What happens if I exceed my storage limit?",
        "A: When you reach 90% capacity, we'll send notification emails. At 100%, new file uploads will be blocked, but existing files remain accessible. You can upgrade your plan, delete unnecessary files, or purchase additional storage. No files are automatically deleted due to storage limits.",
        "",
        "Q: How do I recover deleted files?",
        "A: Deleted files are moved to the trash folder where they remain for 30 days. Navigate to the trash in your application or web interface and select restore. Permanently deleted files cannot be recovered unless you have backup enabled. Premium plans include extended 90-day retention and version history.",
        "",
        "Q: Is my data encrypted?",
        "A: Yes, all files are encrypted in transit using TLS 1.3 and at rest using AES-256 encryption. Zero-knowledge encryption is available for Premium and Enterprise customers, meaning only you can decrypt your files. We never have access to your encryption keys when zero-knowledge mode is enabled.",
        "",
        "Q: Can I access my files offline?",
        "A: Files marked as \"Available Offline\" will sync to your local device and remain accessible without internet connectivity. Changes made offline will automatically sync when you reconnect. You can manage offline availability for individual files or entire folders through the application settings."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "samples/customer_service/subscription_service_faq.txt",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "Subscription Service FAQ - StreamFlix Entertainment",
        "",
        "Q: What plans are available and what's included?",
        "A: We offer three subscription tiers. Basic plan ($9.99/month) includes HD streaming on one device with limited content library. Standard plan ($14.99/month) provides Full HD streaming on two simultaneous devices with complete content access. Premium plan ($19.99/month) offers 4K Ultra HD streaming on four devices plus offline downloads and exclusive early access to new releases. All plans include ad-free viewing and parental controls.",
        "",
        "Q: Can I cancel my subscription at any time?",
        "A: Yes, you can cancel anytime without penalty or cancellation fees. Your service continues until the end of your current billing period. After cancellation, you won't be charged for subsequent months, but you'll lose access to content when the period ends. You can reactivate your subscription anytime, and your viewing history and preferences will be preserved for 12 months.",
        "",
        "Q: How do I change my subscription plan?",
        "A: Log into your account dashboard and navigate to Subscription Settings. Select your desired plan and confirm the change. Upgrades take effect immediately, and you'll be charged the prorated difference for the remainder of your billing cycle. Downgrades become effective at the start of your next billing period to maximize your current plan benefits.",
        "",
        "Q: What payment methods do you accept?",
        "A: We accept major credit cards (Visa, MasterCard, American Express, Discover), debit cards, PayPal, Apple Pay, Google Pay, and gift cards. Payment information is securely stored and automatically charged on your billing date. You can update payment methods in your account settings. Failed payments trigger email notifications with instructions to update your payment information within 7 days to avoid service interruption.",
        "",
        "Q: Can I share my account with family members?",
        "A: Yes, all subscription plans support multiple user profiles within a single account. Standard and Premium plans allow simultaneous streaming on multiple devices as specified in your plan. Each user can maintain separate watchlists, viewing history, and personalized recommendations. Parental controls can be configured individually for each profile to restrict age-inappropriate content.",
        "",
        "Q: Do you offer student or family discounts?",
        "A: Students enrolled in accredited universities receive 25% off any plan with valid student email verification through our education partner. Family plans bundling multiple profiles at discounted rates are available for Premium subscribers. Annual subscription payments receive two months free compared to monthly billing. Military personnel and first responders qualify for 15% discount with verification.",
        "",
        "Q: What devices are supported?",
        "A: StreamFlix works on smart TVs (Samsung, LG, Sony, Vizio), streaming devices (Roku, Apple TV, Chromecast, Fire TV), game consoles (PlayStation, Xbox), computers (Windows, Mac, Linux via web browser), smartphones and tablets (iOS, Android), and web browsers (Chrome, Firefox, Safari, Edge). Download the StreamFlix app from your device's app store or visit our website to stream directly.",
        "",
        "Q: Can I download content for offline viewing?",
        "A: Premium subscribers can download select movies and TV shows to watch without internet connection. Downloads are available in the mobile apps for iOS and Android devices only. Most content allows up to 100 downloads across your devices simultaneously. Downloaded content expires after 30 days or 48 hours after you start watching, whichever comes first. Downloaded files cannot be transferred to other devices or external storage.",
        "",
        "Q: Why isn't certain content available in my region?",
        "A: Content availability varies by geographic location due to licensing agreements with content providers and studios. We continuously work to expand our library globally, but distribution rights determine regional availability. Using VPNs or proxy services to access content from other regions violates our Terms of Service and may result in account suspension. Check your local content catalog for available titles in your country."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "tests/unit/test_protobuf_serialization.py",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "\"\"\"",
        "Unit tests for Protocol Buffers serialization.",
        "",
        "Tests the protobuf serialization and deserialization functionality",
        "for cross-language corpus sharing.",
        "\"\"\"",
        "",
        "import unittest",
        "import tempfile",
        "import os",
        "from pathlib import Path",
        "",
        "# Import core modules",
        "from cortical.layers import CorticalLayer, HierarchicalLayer",
        "from cortical.minicolumn import Minicolumn, Edge",
        "from cortical.persistence import save_processor, load_processor",
        "",
        "# Try to import protobuf modules",
        "try:",
        "    from cortical.proto.serialization import (",
        "        to_proto, from_proto,",
        "        edge_to_proto, edge_from_proto,",
        "        minicolumn_to_proto, minicolumn_from_proto,",
        "        layer_to_proto, layer_from_proto",
        "    )",
        "    PROTOBUF_AVAILABLE = True",
        "except ImportError:",
        "    PROTOBUF_AVAILABLE = False",
        "",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestEdgeSerialization(unittest.TestCase):",
        "    \"\"\"Test Edge protobuf serialization.\"\"\"",
        "",
        "    def test_edge_round_trip(self):",
        "        \"\"\"Test Edge serialization and deserialization.\"\"\"",
        "        edge = Edge(",
        "            target_id=\"L0_network\",",
        "            weight=0.8,",
        "            relation_type=\"RelatedTo\",",
        "            confidence=0.9,",
        "            source=\"semantic\"",
        "        )",
        "",
        "        # Convert to protobuf and back",
        "        proto = edge_to_proto(edge)",
        "        restored = edge_from_proto(proto)",
        "",
        "        # Verify all fields",
        "        self.assertEqual(restored.target_id, edge.target_id)",
        "        self.assertEqual(restored.weight, edge.weight)",
        "        self.assertEqual(restored.relation_type, edge.relation_type)",
        "        self.assertEqual(restored.confidence, edge.confidence)",
        "        self.assertEqual(restored.source, edge.source)",
        "",
        "    def test_edge_default_values(self):",
        "        \"\"\"Test Edge with default values.\"\"\"",
        "        edge = Edge(target_id=\"L0_test\")",
        "",
        "        proto = edge_to_proto(edge)",
        "        restored = edge_from_proto(proto)",
        "",
        "        self.assertEqual(restored.target_id, \"L0_test\")",
        "        self.assertEqual(restored.weight, 1.0)",
        "        self.assertEqual(restored.relation_type, \"co_occurrence\")",
        "        self.assertEqual(restored.confidence, 1.0)",
        "        self.assertEqual(restored.source, \"corpus\")",
        "",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestMinicolumnSerialization(unittest.TestCase):",
        "    \"\"\"Test Minicolumn protobuf serialization.\"\"\"",
        "",
        "    def test_minicolumn_basic(self):",
        "        \"\"\"Test basic Minicolumn serialization.\"\"\"",
        "        col = Minicolumn(\"L0_neural\", \"neural\", 0)",
        "        col.occurrence_count = 15",
        "        col.activation = 0.5",
        "        col.pagerank = 0.01",
        "        col.tfidf = 2.5",
        "        col.document_ids.add(\"doc1\")",
        "        col.document_ids.add(\"doc2\")",
        "",
        "        # Add connections",
        "        col.add_lateral_connection(\"L0_network\", 3.0)",
        "        col.add_typed_connection(\"L0_brain\", 2.0, relation_type=\"RelatedTo\", confidence=0.85)",
        "",
        "        # Convert to protobuf and back",
        "        proto = minicolumn_to_proto(col)",
        "        restored = minicolumn_from_proto(proto)",
        "",
        "        # Verify basic fields",
        "        self.assertEqual(restored.id, col.id)",
        "        self.assertEqual(restored.content, col.content)",
        "        self.assertEqual(restored.layer, col.layer)",
        "        self.assertEqual(restored.occurrence_count, col.occurrence_count)",
        "        self.assertEqual(restored.activation, col.activation)",
        "        self.assertEqual(restored.pagerank, col.pagerank)",
        "        self.assertEqual(restored.tfidf, col.tfidf)",
        "        self.assertEqual(restored.document_ids, col.document_ids)",
        "",
        "        # Verify connections",
        "        self.assertEqual(len(restored.lateral_connections), 2)",
        "        self.assertEqual(restored.lateral_connections[\"L0_network\"], 3.0)",
        "        self.assertEqual(restored.lateral_connections[\"L0_brain\"], 2.0)",
        "",
        "        # Verify typed connections",
        "        self.assertEqual(len(restored.typed_connections), 2)",
        "        brain_edge = restored.typed_connections[\"L0_brain\"]",
        "        self.assertEqual(brain_edge.relation_type, \"RelatedTo\")",
        "        self.assertEqual(brain_edge.confidence, 0.85)",
        "",
        "    def test_minicolumn_with_feedforward_feedback(self):",
        "        \"\"\"Test Minicolumn with feedforward/feedback connections.\"\"\"",
        "        col = Minicolumn(\"L1_neural_network\", \"neural network\", 1)",
        "        col.add_feedforward_connection(\"L0_neural\", 1.0)",
        "        col.add_feedforward_connection(\"L0_network\", 1.0)",
        "        col.add_feedback_connection(\"L2_cluster_5\", 0.5)",
        "",
        "        proto = minicolumn_to_proto(col)",
        "        restored = minicolumn_from_proto(proto)",
        "",
        "        self.assertEqual(len(restored.feedforward_connections), 2)",
        "        self.assertEqual(restored.feedforward_connections[\"L0_neural\"], 1.0)",
        "        self.assertEqual(len(restored.feedback_connections), 1)",
        "        self.assertEqual(restored.feedback_connections[\"L2_cluster_5\"], 0.5)",
        "",
        "    def test_minicolumn_with_tfidf_per_doc(self):",
        "        \"\"\"Test Minicolumn with per-document TF-IDF scores.\"\"\"",
        "        col = Minicolumn(\"L0_test\", \"test\", 0)",
        "        col.tfidf_per_doc = {\"doc1\": 1.5, \"doc2\": 2.0, \"doc3\": 0.8}",
        "        col.doc_occurrence_counts = {\"doc1\": 3, \"doc2\": 5, \"doc3\": 1}",
        "",
        "        proto = minicolumn_to_proto(col)",
        "        restored = minicolumn_from_proto(proto)",
        "",
        "        self.assertEqual(restored.tfidf_per_doc, col.tfidf_per_doc)",
        "        self.assertEqual(restored.doc_occurrence_counts, col.doc_occurrence_counts)",
        "",
        "    def test_minicolumn_with_cluster(self):",
        "        \"\"\"Test Minicolumn with cluster ID.\"\"\"",
        "        col = Minicolumn(\"L0_test\", \"test\", 0)",
        "        col.cluster_id = 42",
        "",
        "        proto = minicolumn_to_proto(col)",
        "        restored = minicolumn_from_proto(proto)",
        "",
        "        self.assertEqual(restored.cluster_id, 42)",
        "",
        "    def test_minicolumn_with_name_tokens(self):",
        "        \"\"\"Test Minicolumn with name tokens (for documents).\"\"\"",
        "        col = Minicolumn(\"L3_doc1\", \"doc1\", 3)",
        "        col.name_tokens = {\"test\", \"document\", \"sample\"}",
        "",
        "        proto = minicolumn_to_proto(col)",
        "        restored = minicolumn_from_proto(proto)",
        "",
        "        self.assertEqual(restored.name_tokens, col.name_tokens)",
        "",
        "    def test_empty_minicolumn(self):",
        "        \"\"\"Test Minicolumn with no connections or metadata.\"\"\"",
        "        col = Minicolumn(\"L0_empty\", \"empty\", 0)",
        "",
        "        proto = minicolumn_to_proto(col)",
        "        restored = minicolumn_from_proto(proto)",
        "",
        "        self.assertEqual(restored.id, col.id)",
        "        self.assertEqual(len(restored.lateral_connections), 0)",
        "        self.assertEqual(len(restored.typed_connections), 0)",
        "",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestLayerSerialization(unittest.TestCase):",
        "    \"\"\"Test HierarchicalLayer protobuf serialization.\"\"\"",
        "",
        "    def test_layer_basic(self):",
        "        \"\"\"Test basic HierarchicalLayer serialization.\"\"\"",
        "        layer = HierarchicalLayer(CorticalLayer.TOKENS)",
        "        col1 = layer.get_or_create_minicolumn(\"neural\")",
        "        col1.occurrence_count = 10",
        "        col2 = layer.get_or_create_minicolumn(\"network\")",
        "        col2.occurrence_count = 8",
        "        col1.add_lateral_connection(\"L0_network\", 5.0)",
        "",
        "        proto = layer_to_proto(layer)",
        "        restored = layer_from_proto(proto)",
        "",
        "        # Verify layer structure",
        "        self.assertEqual(restored.level, CorticalLayer.TOKENS)",
        "        self.assertEqual(len(restored.minicolumns), 2)",
        "        self.assertIn(\"neural\", restored.minicolumns)",
        "        self.assertIn(\"network\", restored.minicolumns)",
        "",
        "        # Verify minicolumn data",
        "        restored_col1 = restored.minicolumns[\"neural\"]",
        "        self.assertEqual(restored_col1.occurrence_count, 10)",
        "        self.assertEqual(len(restored_col1.lateral_connections), 1)",
        "",
        "        # Verify ID index was rebuilt",
        "        self.assertEqual(restored.get_by_id(\"L0_neural\"), restored_col1)",
        "",
        "    def test_empty_layer(self):",
        "        \"\"\"Test empty HierarchicalLayer serialization.\"\"\"",
        "        layer = HierarchicalLayer(CorticalLayer.CONCEPTS)",
        "",
        "        proto = layer_to_proto(layer)",
        "        restored = layer_from_proto(proto)",
        "",
        "        self.assertEqual(restored.level, CorticalLayer.CONCEPTS)",
        "        self.assertEqual(len(restored.minicolumns), 0)",
        "",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestProcessorStateSerialization(unittest.TestCase):",
        "    \"\"\"Test complete processor state protobuf serialization.\"\"\"",
        "",
        "    def setUp(self):",
        "        \"\"\"Create test processor state.\"\"\"",
        "        # Create layers",
        "        self.layers = {",
        "            CorticalLayer.TOKENS: HierarchicalLayer(CorticalLayer.TOKENS),",
        "            CorticalLayer.BIGRAMS: HierarchicalLayer(CorticalLayer.BIGRAMS),",
        "            CorticalLayer.CONCEPTS: HierarchicalLayer(CorticalLayer.CONCEPTS),",
        "            CorticalLayer.DOCUMENTS: HierarchicalLayer(CorticalLayer.DOCUMENTS)",
        "        }",
        "",
        "        # Add some data to token layer",
        "        layer0 = self.layers[CorticalLayer.TOKENS]",
        "        col1 = layer0.get_or_create_minicolumn(\"neural\")",
        "        col1.occurrence_count = 10",
        "        col1.pagerank = 0.05",
        "        col1.tfidf = 2.5",
        "        col1.document_ids.add(\"doc1\")",
        "        col1.add_lateral_connection(\"L0_network\", 3.0)",
        "",
        "        col2 = layer0.get_or_create_minicolumn(\"network\")",
        "        col2.occurrence_count = 8",
        "        col2.pagerank = 0.04",
        "        col2.tfidf = 2.0",
        "        col2.document_ids.add(\"doc1\")",
        "",
        "        # Documents",
        "        self.documents = {",
        "            \"doc1\": \"Neural networks are powerful.\",",
        "            \"doc2\": \"Machine learning is fascinating.\"",
        "        }",
        "",
        "        # Document metadata",
        "        self.document_metadata = {",
        "            \"doc1\": {\"source\": \"test\", \"timestamp\": \"2025-01-01\"},",
        "            \"doc2\": {\"source\": \"test\", \"timestamp\": \"2025-01-02\"}",
        "        }",
        "",
        "        # Embeddings",
        "        self.embeddings = {",
        "            \"neural\": [0.1, 0.2, 0.3],",
        "            \"network\": [0.15, 0.25, 0.35]",
        "        }",
        "",
        "        # Semantic relations",
        "        self.semantic_relations = [",
        "            (\"neural\", \"RelatedTo\", \"network\", 0.8),",
        "            (\"neural\", \"UsedFor\", \"learning\", 0.5)",
        "        ]",
        "",
        "        # Metadata",
        "        self.metadata = {",
        "            \"created\": \"2025-01-01\",",
        "            \"version\": \"1.0\",",
        "            \"settings\": {\"alpha\": 0.85, \"enabled\": True}",
        "        }",
        "",
        "    def test_full_state_round_trip(self):",
        "        \"\"\"Test full processor state serialization.\"\"\"",
        "        # Convert to protobuf",
        "        proto = to_proto(",
        "            self.layers, self.documents, self.document_metadata,",
        "            self.embeddings, self.semantic_relations, self.metadata",
        "        )",
        "",
        "        # Convert back to Python",
        "        (restored_layers, restored_docs, restored_meta,",
        "         restored_embeddings, restored_relations, restored_metadata) = from_proto(proto)",
        "",
        "        # Verify layers",
        "        self.assertEqual(len(restored_layers), 4)",
        "        layer0 = restored_layers[CorticalLayer.TOKENS]",
        "        self.assertEqual(len(layer0.minicolumns), 2)",
        "",
        "        neural = layer0.minicolumns[\"neural\"]",
        "        self.assertEqual(neural.occurrence_count, 10)",
        "        self.assertEqual(neural.pagerank, 0.05)",
        "        self.assertEqual(neural.tfidf, 2.5)",
        "",
        "        # Verify documents",
        "        self.assertEqual(restored_docs, self.documents)",
        "",
        "        # Verify document metadata",
        "        self.assertEqual(len(restored_meta), 2)",
        "        self.assertEqual(restored_meta[\"doc1\"][\"source\"], \"test\")",
        "",
        "        # Verify embeddings",
        "        self.assertEqual(len(restored_embeddings), 2)",
        "        self.assertEqual(restored_embeddings[\"neural\"], [0.1, 0.2, 0.3])",
        "",
        "        # Verify semantic relations",
        "        self.assertEqual(len(restored_relations), 2)",
        "        self.assertEqual(restored_relations[0][0], \"neural\")",
        "        self.assertEqual(restored_relations[0][1], \"RelatedTo\")",
        "        self.assertEqual(restored_relations[0][2], \"network\")",
        "        self.assertEqual(restored_relations[0][3], 0.8)",
        "",
        "        # Verify metadata",
        "        self.assertEqual(restored_metadata[\"created\"], \"2025-01-01\")",
        "        self.assertEqual(restored_metadata[\"settings\"][\"alpha\"], 0.85)",
        "        self.assertEqual(restored_metadata[\"settings\"][\"enabled\"], True)",
        "",
        "    def test_minimal_state(self):",
        "        \"\"\"Test minimal processor state (layers and documents only).\"\"\"",
        "        proto = to_proto(self.layers, self.documents)",
        "        (restored_layers, restored_docs, restored_meta,",
        "         restored_embeddings, restored_relations, restored_metadata) = from_proto(proto)",
        "",
        "        self.assertEqual(len(restored_layers), 4)",
        "        self.assertEqual(restored_docs, self.documents)",
        "        self.assertEqual(restored_meta, {})",
        "        self.assertEqual(restored_embeddings, {})",
        "        self.assertEqual(restored_relations, [])",
        "        self.assertEqual(restored_metadata, {})",
        "",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestPersistenceIntegration(unittest.TestCase):",
        "    \"\"\"Test protobuf integration with persistence module.\"\"\"",
        "",
        "    def setUp(self):",
        "        \"\"\"Create test data.\"\"\"",
        "        self.layers = {",
        "            CorticalLayer.TOKENS: HierarchicalLayer(CorticalLayer.TOKENS),",
        "            CorticalLayer.BIGRAMS: HierarchicalLayer(CorticalLayer.BIGRAMS),",
        "            CorticalLayer.CONCEPTS: HierarchicalLayer(CorticalLayer.CONCEPTS),",
        "            CorticalLayer.DOCUMENTS: HierarchicalLayer(CorticalLayer.DOCUMENTS)",
        "        }",
        "",
        "        layer0 = self.layers[CorticalLayer.TOKENS]",
        "        col = layer0.get_or_create_minicolumn(\"test\")",
        "        col.occurrence_count = 5",
        "        col.add_lateral_connection(\"L0_data\", 2.0)",
        "",
        "        self.documents = {\"doc1\": \"Test data\"}",
        "        self.document_metadata = {\"doc1\": {\"source\": \"test\"}}",
        "        self.embeddings = {\"test\": [0.1, 0.2]}",
        "        self.semantic_relations = [(\"test\", \"RelatedTo\", \"data\", 0.7)]",
        "        self.metadata = {\"version\": \"1.0\"}",
        "",
        "    def test_save_and_load_protobuf(self):",
        "        \"\"\"Test saving and loading with protobuf format.\"\"\"",
        "        with tempfile.NamedTemporaryFile(delete=False, suffix='.pb') as f:",
        "            filepath = f.name",
        "",
        "        try:",
        "            # Save with protobuf format",
        "            save_processor(",
        "                filepath, self.layers, self.documents,",
        "                self.document_metadata, self.embeddings,",
        "                self.semantic_relations, self.metadata,",
        "                verbose=False, format='protobuf'",
        "            )",
        "",
        "            # Load with protobuf format",
        "            (restored_layers, restored_docs, restored_meta,",
        "             restored_embeddings, restored_relations, restored_metadata) = load_processor(",
        "                filepath, verbose=False, format='protobuf'",
        "            )",
        "",
        "            # Verify data",
        "            self.assertEqual(len(restored_layers), 4)",
        "            layer0 = restored_layers[CorticalLayer.TOKENS]",
        "            self.assertEqual(len(layer0.minicolumns), 1)  # Only \"test\" minicolumn",
        "",
        "            test_col = layer0.minicolumns[\"test\"]",
        "            self.assertEqual(test_col.occurrence_count, 5)",
        "            self.assertEqual(len(test_col.lateral_connections), 1)",
        "            self.assertIn(\"L0_data\", test_col.lateral_connections)",
        "",
        "            self.assertEqual(restored_docs, self.documents)",
        "            self.assertEqual(restored_meta, self.document_metadata)",
        "            self.assertEqual(restored_embeddings, self.embeddings)",
        "            self.assertEqual(len(restored_relations), 1)",
        "",
        "        finally:",
        "            if os.path.exists(filepath):",
        "                os.unlink(filepath)",
        "",
        "    def test_save_and_load_pickle(self):",
        "        \"\"\"Test saving and loading with pickle format (backward compatibility).\"\"\"",
        "        with tempfile.NamedTemporaryFile(delete=False, suffix='.pkl') as f:",
        "            filepath = f.name",
        "",
        "        try:",
        "            # Save with pickle format (default)",
        "            save_processor(",
        "                filepath, self.layers, self.documents,",
        "                self.document_metadata, self.embeddings,",
        "                self.semantic_relations, self.metadata,",
        "                verbose=False, format='pickle'",
        "            )",
        "",
        "            # Load with pickle format",
        "            (restored_layers, restored_docs, restored_meta,",
        "             restored_embeddings, restored_relations, restored_metadata) = load_processor(",
        "                filepath, verbose=False, format='pickle'",
        "            )",
        "",
        "            # Verify data",
        "            self.assertEqual(len(restored_layers), 4)",
        "            self.assertEqual(restored_docs, self.documents)",
        "",
        "        finally:",
        "            if os.path.exists(filepath):",
        "                os.unlink(filepath)",
        "",
        "    def test_auto_detect_format(self):",
        "        \"\"\"Test automatic format detection.\"\"\"",
        "        with tempfile.NamedTemporaryFile(delete=False, suffix='.pkl') as f:",
        "            pickle_file = f.name",
        "        with tempfile.NamedTemporaryFile(delete=False, suffix='.pb') as f:",
        "            proto_file = f.name",
        "",
        "        try:",
        "            # Save in both formats",
        "            save_processor(",
        "                pickle_file, self.layers, self.documents,",
        "                verbose=False, format='pickle'",
        "            )",
        "            save_processor(",
        "                proto_file, self.layers, self.documents,",
        "                verbose=False, format='protobuf'",
        "            )",
        "",
        "            # Load without specifying format (auto-detect)",
        "            (layers1, docs1, _, _, _, _) = load_processor(pickle_file, verbose=False)",
        "            (layers2, docs2, _, _, _, _) = load_processor(proto_file, verbose=False)",
        "",
        "            # Both should load successfully",
        "            self.assertEqual(len(layers1), 4)",
        "            self.assertEqual(len(layers2), 4)",
        "            self.assertEqual(docs1, self.documents)",
        "            self.assertEqual(docs2, self.documents)",
        "",
        "        finally:",
        "            if os.path.exists(pickle_file):",
        "                os.unlink(pickle_file)",
        "            if os.path.exists(proto_file):",
        "                os.unlink(proto_file)",
        "",
        "    def test_invalid_format_error(self):",
        "        \"\"\"Test error handling for invalid format.\"\"\"",
        "        with tempfile.NamedTemporaryFile(delete=False) as f:",
        "            filepath = f.name",
        "",
        "        try:",
        "            with self.assertRaises(ValueError):",
        "                save_processor(",
        "                    filepath, self.layers, self.documents,",
        "                    verbose=False, format='json'",
        "                )",
        "        finally:",
        "            if os.path.exists(filepath):",
        "                os.unlink(filepath)",
        "",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestComplexDataStructures(unittest.TestCase):",
        "    \"\"\"Test protobuf serialization with complex data structures.\"\"\"",
        "",
        "    def test_nested_metadata(self):",
        "        \"\"\"Test nested dictionaries in metadata.\"\"\"",
        "        layers = {",
        "            CorticalLayer.TOKENS: HierarchicalLayer(CorticalLayer.TOKENS)",
        "        }",
        "        documents = {\"doc1\": \"test\"}",
        "        metadata = {",
        "            \"config\": {",
        "                \"params\": {",
        "                    \"alpha\": 0.85,",
        "                    \"beta\": 0.15,",
        "                    \"nested\": {",
        "                        \"value\": 42,",
        "                        \"enabled\": True",
        "                    }",
        "                },",
        "                \"lists\": [1, 2, 3, \"four\", 5.0]",
        "            }",
        "        }",
        "",
        "        proto = to_proto(layers, documents, metadata=metadata)",
        "        (_, _, _, _, _, restored_metadata) = from_proto(proto)",
        "",
        "        self.assertEqual(restored_metadata[\"config\"][\"params\"][\"alpha\"], 0.85)",
        "        self.assertEqual(restored_metadata[\"config\"][\"params\"][\"nested\"][\"value\"], 42)",
        "        self.assertEqual(restored_metadata[\"config\"][\"params\"][\"nested\"][\"enabled\"], True)",
        "        self.assertEqual(restored_metadata[\"config\"][\"lists\"], [1, 2, 3, \"four\", 5.0])",
        "",
        "    def test_large_embeddings(self):",
        "        \"\"\"Test large embedding vectors.\"\"\"",
        "        layers = {",
        "            CorticalLayer.TOKENS: HierarchicalLayer(CorticalLayer.TOKENS)",
        "        }",
        "        documents = {\"doc1\": \"test\"}",
        "        embeddings = {",
        "            \"term1\": [float(i) for i in range(300)],  # 300-dimensional embedding",
        "            \"term2\": [float(i * 0.5) for i in range(300)]",
        "        }",
        "",
        "        proto = to_proto(layers, documents, embeddings=embeddings)",
        "        (_, _, _, restored_embeddings, _, _) = from_proto(proto)",
        "",
        "        self.assertEqual(len(restored_embeddings[\"term1\"]), 300)",
        "        self.assertEqual(restored_embeddings[\"term1\"][0], 0.0)",
        "        self.assertEqual(restored_embeddings[\"term1\"][299], 299.0)",
        "",
        "    def test_many_semantic_relations(self):",
        "        \"\"\"Test many semantic relations.\"\"\"",
        "        layers = {",
        "            CorticalLayer.TOKENS: HierarchicalLayer(CorticalLayer.TOKENS)",
        "        }",
        "        documents = {\"doc1\": \"test\"}",
        "        relations = [",
        "            (f\"term{i}\", \"RelatedTo\", f\"term{i+1}\", float(i) / 100.0)",
        "            for i in range(100)",
        "        ]",
        "",
        "        proto = to_proto(layers, documents, semantic_relations=relations)",
        "        (_, _, _, _, restored_relations, _) = from_proto(proto)",
        "",
        "        self.assertEqual(len(restored_relations), 100)",
        "        self.assertEqual(restored_relations[50][0], \"term50\")",
        "        self.assertEqual(restored_relations[50][2], \"term51\")",
        "        self.assertEqual(restored_relations[50][3], 0.5)",
        "",
        "",
        "if __name__ == '__main__':",
        "    unittest.main()"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    }
  ],
  "hour_of_day": 9,
  "day_of_week": "Sunday",
  "seconds_since_last_commit": -100598,
  "is_merge": true,
  "is_initial": false,
  "parent_count": 2,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}