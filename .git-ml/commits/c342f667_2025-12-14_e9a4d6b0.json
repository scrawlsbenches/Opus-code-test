{
  "hash": "c342f667ad44086ddd389f99065a441f0753e654",
  "message": "Merge remote-tracking branch 'origin/main' into claude/replace-pkl-git-friendly-01DD3ra3P5hj9NK57johJff5",
  "author": "Claude",
  "timestamp": "2025-12-14 01:10:20 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    ".github/workflows/ci.yml",
    "cortical/cli_wrapper.py",
    "pyproject.toml",
    "requirements.txt",
    "tests/performance/test_performance.py"
  ],
  "insertions": 31,
  "deletions": 8,
  "hunks": [
    {
      "file": "workflows/ci.yml b/.github/workflows/ci.yml",
      "function": "jobs:",
      "start_line": 89,
      "lines_added": [
        "        pip install -e \".[dev]\""
      ],
      "lines_removed": [
        "        pip install pytest"
      ],
      "context_before": [
        "    - uses: actions/checkout@v4",
        "",
        "    - name: Set up Python 3.11",
        "      uses: actions/setup-python@v5",
        "      with:",
        "        python-version: '3.11'",
        "",
        "    - name: Install test dependencies",
        "      run: |",
        "        python -m pip install --upgrade pip"
      ],
      "context_after": [
        "",
        "    - name: Run smoke tests",
        "      run: |",
        "        echo \"=== Running Smoke Tests ===\"",
        "        python -m pytest tests/smoke/ -v --tb=short",
        "        echo \"✅ Smoke tests passed\"",
        "",
        "  # ==========================================================================",
        "  # Stage 2: Unit Tests with Coverage (< 2 min)",
        "  # Fast, isolated tests for individual components"
      ],
      "change_type": "modify"
    },
    {
      "file": "workflows/ci.yml b/.github/workflows/ci.yml",
      "function": "jobs:",
      "start_line": 117,
      "lines_added": [
        "        pip install -e \".[dev]\""
      ],
      "lines_removed": [
        "        pip install pytest coverage"
      ],
      "context_before": [
        "    - uses: actions/checkout@v4",
        "",
        "    - name: Set up Python 3.11",
        "      uses: actions/setup-python@v5",
        "      with:",
        "        python-version: '3.11'",
        "",
        "    - name: Install test dependencies",
        "      run: |",
        "        python -m pip install --upgrade pip"
      ],
      "context_after": [
        "",
        "    - name: Run unit tests with coverage",
        "      run: |",
        "        echo \"=== Running Unit Tests ===\"",
        "        # Run unit tests - pytest handles both pytest AND unittest style tests",
        "        # Using a single pytest call is faster than multiple unittest discovers",
        "        # Note: Legacy tests removed 2025-12-13 - now covered by tests/unit/",
        "        coverage run --source=cortical -m pytest \\",
        "          tests/unit/ \\",
        "          -v --tb=short"
      ],
      "change_type": "modify"
    },
    {
      "file": "workflows/ci.yml b/.github/workflows/ci.yml",
      "function": "jobs:",
      "start_line": 159,
      "lines_added": [
        "        pip install -e \".[dev]\""
      ],
      "lines_removed": [
        "        pip install pytest coverage"
      ],
      "context_before": [
        "    - uses: actions/checkout@v4",
        "",
        "    - name: Set up Python 3.11",
        "      uses: actions/setup-python@v5",
        "      with:",
        "        python-version: '3.11'",
        "",
        "    - name: Install test dependencies",
        "      run: |",
        "        python -m pip install --upgrade pip"
      ],
      "context_after": [
        "",
        "    - name: Run integration tests with coverage",
        "      run: |",
        "        echo \"=== Running Integration Tests ===\"",
        "        # Run integration tests - single pytest call is faster than multiple unittest discovers",
        "        # Includes tests/integration/ plus remaining legacy tests that provide unique coverage",
        "        # Note: 3 legacy tests removed 2025-12-13 (test_behavioral.py, test_intent_query.py,",
        "        #       test_query_optimization.py) - now covered by unit tests",
        "        coverage run --source=cortical -m pytest \\",
        "          tests/integration/ \\"
      ],
      "change_type": "modify"
    },
    {
      "file": "workflows/ci.yml b/.github/workflows/ci.yml",
      "function": "jobs:",
      "start_line": 211,
      "lines_added": [
        "        pip install -e \".[dev]\""
      ],
      "lines_removed": [
        "        pip install pytest"
      ],
      "context_before": [
        "    - uses: actions/checkout@v4",
        "",
        "    - name: Set up Python 3.11",
        "      uses: actions/setup-python@v5",
        "      with:",
        "        python-version: '3.11'",
        "",
        "    - name: Install test dependencies",
        "      run: |",
        "        python -m pip install --upgrade pip"
      ],
      "context_after": [
        "",
        "    - name: Run regression tests",
        "      run: |",
        "        echo \"=== Running Regression Tests ===\"",
        "        python -m pytest tests/regression/ -v --tb=short",
        "        echo \"✅ All regressions still fixed\"",
        "",
        "  # ==========================================================================",
        "  # Stage 5: Behavioral Tests (< 2 min)",
        "  # Tests for user-facing quality and relevance"
      ],
      "change_type": "modify"
    },
    {
      "file": "workflows/ci.yml b/.github/workflows/ci.yml",
      "function": "jobs:",
      "start_line": 239,
      "lines_added": [
        "        pip install -e \".[dev]\""
      ],
      "lines_removed": [
        "        pip install pytest"
      ],
      "context_before": [
        "    - uses: actions/checkout@v4",
        "",
        "    - name: Set up Python 3.11",
        "      uses: actions/setup-python@v5",
        "      with:",
        "        python-version: '3.11'",
        "",
        "    - name: Install test dependencies",
        "      run: |",
        "        python -m pip install --upgrade pip"
      ],
      "context_after": [
        "",
        "    - name: Run behavioral tests",
        "      run: |",
        "        echo \"=== Running Behavioral Tests ===\"",
        "        # Note: tests/test_behavioral.py removed 2025-12-13 - superseded by tests/behavioral/",
        "        python -m pytest tests/behavioral/ -v --tb=short",
        "        echo \"✅ Behavioral quality verified\"",
        "",
        "  # ==========================================================================",
        "  # Stage 6: Performance Tests (< 1 min, no coverage)"
      ],
      "change_type": "modify"
    },
    {
      "file": "workflows/ci.yml b/.github/workflows/ci.yml",
      "function": "jobs:",
      "start_line": 268,
      "lines_added": [
        "        pip install -e \".[dev]\""
      ],
      "lines_removed": [
        "        pip install pytest"
      ],
      "context_before": [
        "    - uses: actions/checkout@v4",
        "",
        "    - name: Set up Python 3.11",
        "      uses: actions/setup-python@v5",
        "      with:",
        "        python-version: '3.11'",
        "",
        "    - name: Install test dependencies",
        "      run: |",
        "        python -m pip install --upgrade pip"
      ],
      "context_after": [
        "",
        "    - name: Run performance tests",
        "      run: |",
        "        echo \"=== Running Performance Tests (no coverage) ===\"",
        "        python -m pytest tests/performance/ -v --tb=short -s",
        "        echo \"✅ Performance within thresholds\"",
        "",
        "  # ==========================================================================",
        "  # Stage 7: Full Coverage Report",
        "  # Combines coverage from unit + integration tests WITHOUT re-running tests"
      ],
      "change_type": "modify"
    },
    {
      "file": "cortical/cli_wrapper.py",
      "function": "def test_then_commit(",
      "start_line": 1008,
      "lines_added": [
        "# Tell pytest this is not a test function (it's a utility that runs tests)",
        "test_then_commit.__test__ = False",
        "",
        ""
      ],
      "lines_removed": [],
      "context_before": [
        "        if not add_result.success:",
        "            return False, results",
        "",
        "    # Commit",
        "    commit_result = run([\"git\", \"commit\", \"-m\", message], git=True)",
        "    results.append(commit_result)",
        "",
        "    return commit_result.success, results",
        "",
        ""
      ],
      "context_after": [
        "def commit_and_push(",
        "    message: str,",
        "    add_all: bool = True,",
        "    branch: Optional[str] = None,",
        ") -> Tuple[bool, List[ExecutionContext]]:",
        "    \"\"\"",
        "    Add, commit, and push in one go.",
        "",
        "    Example:",
        "        ok, _ = commit_and_push(\"Fix typo\")"
      ],
      "change_type": "add"
    },
    {
      "file": "pyproject.toml",
      "function": "classifiers = [",
      "start_line": 39,
      "lines_added": [
        "    \"pytest>=7.0\",",
        "    \"mcp>=1.0\",  # Required for MCP server tests",
        "    \"pyyaml>=6.0\",  # Required for workflow integration tests"
      ],
      "lines_removed": [],
      "context_before": [
        "    \"Topic :: Text Processing :: Linguistic\",",
        "    \"Typing :: Typed\",",
        "]",
        "",
        "# Zero runtime dependencies - pure stdlib!",
        "dependencies = []",
        "",
        "[project.optional-dependencies]",
        "dev = [",
        "    \"coverage>=7.0\","
      ],
      "context_after": [
        "]",
        "",
        "[project.urls]",
        "Homepage = \"https://github.com/scrawlsbenches/Opus-code-test\"",
        "Documentation = \"https://github.com/scrawlsbenches/Opus-code-test#readme\"",
        "Repository = \"https://github.com/scrawlsbenches/Opus-code-test\"",
        "Issues = \"https://github.com/scrawlsbenches/Opus-code-test/issues\"",
        "",
        "[tool.setuptools.packages.find]",
        "where = [\".\"]"
      ],
      "change_type": "add"
    },
    {
      "file": "pyproject.toml",
      "function": "omit = [",
      "start_line": 72,
      "lines_added": [
        "",
        "[tool.pytest.ini_options]",
        "# Treat warnings as errors to catch issues early",
        "filterwarnings = [\"error\"]"
      ],
      "lines_removed": [],
      "context_before": [
        "]",
        "",
        "[tool.coverage.report]",
        "exclude_lines = [",
        "    \"pragma: no cover\",",
        "    \"def __repr__\",",
        "    \"raise NotImplementedError\",",
        "    \"if TYPE_CHECKING:\",",
        "    \"if __name__ == .__main__.:\",",
        "]"
      ],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "requirements.txt",
      "function": null,
      "start_line": 3,
      "lines_added": [
        "pytest>=7.0          # Test framework (required by tests/unit/)",
        "mcp>=1.0             # MCP server tests (Model Context Protocol)",
        "pyyaml>=6.0          # Workflow integration tests"
      ],
      "lines_removed": [],
      "context_before": [
        "#",
        "# PRODUCTION: Zero dependencies!",
        "# This library uses only Python standard library modules.",
        "# No pip install required for production use.",
        "#",
        "# DEVELOPMENT: Install with `pip install -e \".[dev]\"`",
        "# Or install these manually:",
        "",
        "# Development dependencies",
        "coverage>=7.0        # Test coverage reporting"
      ],
      "context_after": [],
      "change_type": "add"
    },
    {
      "file": "tests/performance/test_performance.py",
      "function": "class TestScalabilityIndicators:",
      "start_line": 246,
      "lines_added": [
        "        # Warmup run to trigger any lazy imports/JIT compilation",
        "        warmup = CorticalTextProcessor()",
        "        for doc_id, content in docs[:3]:",
        "            warmup.process_document(doc_id, content)",
        "        del warmup",
        "",
        "        # Use a minimum floor for baseline to avoid division/multiplication issues",
        "        # when the baseline is very fast (e.g., < 10ms)",
        "        baseline = max(time_5_docs, 0.01)  # At least 10ms floor",
        "        expected_max = baseline * 5",
        "            f\"but 5 docs took {time_5_docs:.3f}s (baseline: {baseline:.3f}s). \""
      ],
      "lines_removed": [
        "        expected_max = time_5_docs * 5",
        "            f\"but 5 docs took {time_5_docs:.3f}s. \""
      ],
      "context_before": [
        "        \"\"\"",
        "        Processing time should scale roughly linearly with document count.",
        "",
        "        This catches O(n^2) issues in document processing.",
        "        \"\"\"",
        "        from cortical import CorticalTextProcessor",
        "        from tests.fixtures.small_corpus import SMALL_CORPUS_DOCS",
        "",
        "        docs = list(SMALL_CORPUS_DOCS.items())",
        ""
      ],
      "context_after": [
        "        # Time processing 5 docs",
        "        processor1 = CorticalTextProcessor()",
        "        start = time.perf_counter()",
        "        for doc_id, content in docs[:5]:",
        "            processor1.process_document(doc_id, content)",
        "        time_5_docs = time.perf_counter() - start",
        "",
        "        # Time processing 15 docs",
        "        processor2 = CorticalTextProcessor()",
        "        start = time.perf_counter()",
        "        for doc_id, content in docs[:15]:",
        "            processor2.process_document(doc_id, content)",
        "        time_15_docs = time.perf_counter() - start",
        "",
        "        # 15 docs should take roughly 3x time of 5 docs (linear scaling)",
        "        # Allow 5x to account for overhead and variability",
        "",
        "        assert time_15_docs < expected_max, (",
        "            f\"Processing 15 docs took {time_15_docs:.3f}s, \"",
        "            f\"Expected roughly linear scaling (< {expected_max:.3f}s). \"",
        "            f\"Possible O(n^2) issue in document processing.\"",
        "        )",
        "",
        "    def test_search_time_stable_across_queries(self, small_processor):",
        "        \"\"\"",
        "        Search time should be stable regardless of query complexity.",
        "",
        "        Large variance might indicate pathological cases.",
        "        \"\"\""
      ],
      "change_type": "modify"
    }
  ],
  "hour_of_day": 1,
  "day_of_week": "Sunday",
  "seconds_since_last_commit": -131668,
  "is_merge": true,
  "is_initial": false,
  "parent_count": 2,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}