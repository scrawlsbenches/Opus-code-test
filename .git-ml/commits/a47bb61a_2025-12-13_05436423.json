{
  "hash": "a47bb61a06bbccd3790b1acad1c3064e1b402089",
  "message": "Add louvain_resolution parameter to CorticalConfig",
  "author": "Claude",
  "timestamp": "2025-12-13 10:58:34 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    "cortical/config.py",
    "cortical/processor.py"
  ],
  "insertions": 24,
  "deletions": 3,
  "hunks": [
    {
      "file": "cortical/config.py",
      "function": "class CorticalConfig:",
      "start_line": 44,
      "lines_added": [
        "        louvain_resolution: Resolution parameter for Louvain clustering (>0).",
        "            Higher values produce more, smaller clusters. Lower values produce",
        "            fewer, larger clusters. Default 2.0 produces ~50-100 clusters for",
        "            medium corpora (50-200 docs). Typical range: 1.0-10.0."
      ],
      "lines_removed": [],
      "context_before": [
        "        pagerank_damping: Damping factor for PageRank (0-1). Higher values",
        "            give more weight to link structure vs uniform distribution.",
        "        pagerank_iterations: Maximum PageRank iterations before stopping.",
        "        pagerank_tolerance: Convergence threshold for PageRank. Algorithm",
        "            stops when max change between iterations is below this value.",
        "",
        "        min_cluster_size: Minimum nodes required to form a concept cluster.",
        "            Smaller values create more fine-grained concepts.",
        "        cluster_strictness: Controls clustering aggressiveness (0.0-1.0).",
        "            Lower values allow more cross-topic mixing."
      ],
      "context_after": [
        "",
        "        isolation_threshold: Documents below this average similarity are",
        "            considered isolated from the corpus.",
        "        well_connected_threshold: Documents above this average similarity",
        "            are considered well-integrated.",
        "        weak_topic_tfidf_threshold: Terms above this TF-IDF are considered",
        "            significant topics.",
        "        bridge_similarity_min: Minimum similarity for bridge opportunities.",
        "        bridge_similarity_max: Maximum similarity for bridge opportunities.",
        ""
      ],
      "change_type": "add"
    },
    {
      "file": "cortical/config.py",
      "function": "class CorticalConfig:",
      "start_line": 76,
      "lines_added": [
        "    louvain_resolution: float = 2.0  # Resolution for Louvain clustering (higher = more clusters)"
      ],
      "lines_removed": [],
      "context_before": [
        "    \"\"\"",
        "",
        "    # PageRank settings",
        "    pagerank_damping: float = 0.85",
        "    pagerank_iterations: int = 20",
        "    pagerank_tolerance: float = 1e-6",
        "",
        "    # Clustering settings",
        "    min_cluster_size: int = 3",
        "    cluster_strictness: float = 1.0"
      ],
      "context_after": [
        "",
        "    # Gap detection thresholds",
        "    isolation_threshold: float = 0.02",
        "    well_connected_threshold: float = 0.03",
        "    weak_topic_tfidf_threshold: float = 0.005",
        "    bridge_similarity_min: float = 0.005",
        "    bridge_similarity_max: float = 0.03",
        "",
        "    # Chunking settings for RAG",
        "    chunk_size: int = 512"
      ],
      "change_type": "add"
    },
    {
      "file": "cortical/config.py",
      "function": "class CorticalConfig:",
      "start_line": 166,
      "lines_added": [
        "        if self.louvain_resolution <= 0:",
        "            raise ValueError(",
        "                f\"louvain_resolution must be positive, got {self.louvain_resolution}\"",
        "            )",
        "        if self.louvain_resolution > 20:",
        "            import warnings",
        "            warnings.warn(",
        "                f\"louvain_resolution={self.louvain_resolution} is very high. \"",
        "                f\"This may produce hundreds of tiny clusters. \"",
        "                f\"Typical range is 1.0-10.0.\"",
        "            )"
      ],
      "lines_removed": [],
      "context_before": [
        "",
        "        # Clustering validation",
        "        if self.min_cluster_size < 1:",
        "            raise ValueError(",
        "                f\"min_cluster_size must be at least 1, got {self.min_cluster_size}\"",
        "            )",
        "        if not (0 <= self.cluster_strictness <= 1):",
        "            raise ValueError(",
        "                f\"cluster_strictness must be between 0 and 1, got {self.cluster_strictness}\"",
        "            )"
      ],
      "context_after": [
        "",
        "        # Threshold validation",
        "        if self.isolation_threshold < 0:",
        "            raise ValueError(",
        "                f\"isolation_threshold must be non-negative, got {self.isolation_threshold}\"",
        "            )",
        "        if self.well_connected_threshold < 0:",
        "            raise ValueError(",
        "                f\"well_connected_threshold must be non-negative, got {self.well_connected_threshold}\"",
        "            )"
      ],
      "change_type": "add"
    },
    {
      "file": "cortical/config.py",
      "function": "class CorticalConfig:",
      "start_line": 224,
      "lines_added": [
        "            louvain_resolution=self.louvain_resolution,"
      ],
      "lines_removed": [],
      "context_before": [
        "",
        "        Returns:",
        "            A new CorticalConfig instance with the same values.",
        "        \"\"\"",
        "        return CorticalConfig(",
        "            pagerank_damping=self.pagerank_damping,",
        "            pagerank_iterations=self.pagerank_iterations,",
        "            pagerank_tolerance=self.pagerank_tolerance,",
        "            min_cluster_size=self.min_cluster_size,",
        "            cluster_strictness=self.cluster_strictness,"
      ],
      "context_after": [
        "            isolation_threshold=self.isolation_threshold,",
        "            well_connected_threshold=self.well_connected_threshold,",
        "            weak_topic_tfidf_threshold=self.weak_topic_tfidf_threshold,",
        "            bridge_similarity_min=self.bridge_similarity_min,",
        "            bridge_similarity_max=self.bridge_similarity_max,",
        "            chunk_size=self.chunk_size,",
        "            chunk_overlap=self.chunk_overlap,",
        "            max_query_expansions=self.max_query_expansions,",
        "            semantic_expansion_discount=self.semantic_expansion_discount,",
        "            cross_layer_damping=self.cross_layer_damping,"
      ],
      "change_type": "add"
    },
    {
      "file": "cortical/config.py",
      "function": "class CorticalConfig:",
      "start_line": 262,
      "lines_added": [
        "            'louvain_resolution': self.louvain_resolution,"
      ],
      "lines_removed": [],
      "context_before": [
        "",
        "        Returns:",
        "            Dictionary representation of the configuration.",
        "        \"\"\"",
        "        return {",
        "            'pagerank_damping': self.pagerank_damping,",
        "            'pagerank_iterations': self.pagerank_iterations,",
        "            'pagerank_tolerance': self.pagerank_tolerance,",
        "            'min_cluster_size': self.min_cluster_size,",
        "            'cluster_strictness': self.cluster_strictness,"
      ],
      "context_after": [
        "            'isolation_threshold': self.isolation_threshold,",
        "            'well_connected_threshold': self.well_connected_threshold,",
        "            'weak_topic_tfidf_threshold': self.weak_topic_tfidf_threshold,",
        "            'bridge_similarity_min': self.bridge_similarity_min,",
        "            'bridge_similarity_max': self.bridge_similarity_max,",
        "            'chunk_size': self.chunk_size,",
        "            'chunk_overlap': self.chunk_overlap,",
        "            'max_query_expansions': self.max_query_expansions,",
        "            'semantic_expansion_discount': self.semantic_expansion_discount,",
        "            'cross_layer_damping': self.cross_layer_damping,"
      ],
      "change_type": "add"
    },
    {
      "file": "cortical/processor.py",
      "function": "class CorticalTextProcessor:",
      "start_line": 982,
      "lines_added": [
        "        resolution: Optional[float] = None,",
        "            resolution: For louvain only. Resolution parameter for modularity",
        "                (default from config.louvain_resolution, typically 2.0).",
        "                - 2.0 (recommended default): ~50-100 clusters for medium corpora"
      ],
      "lines_removed": [
        "        resolution: float = 1.0,",
        "            resolution: For louvain only. Resolution parameter for modularity.",
        "                - 1.0 (default): Standard modularity"
      ],
      "context_before": [
        "                        f\"chain: {stats['chain_connections']}, \"",
        "                        f\"cooccur: {stats['cooccurrence_connections']}{skip_msg})\")",
        "        return stats",
        "",
        "    def build_concept_clusters(",
        "        self,",
        "        min_cluster_size: Optional[int] = None,",
        "        clustering_method: str = 'louvain',",
        "        cluster_strictness: Optional[float] = None,",
        "        bridge_weight: float = 0.0,"
      ],
      "context_after": [
        "        verbose: bool = True",
        "    ) -> Dict[int, List[str]]:",
        "        \"\"\"",
        "        Build concept clusters from token layer.",
        "",
        "        Args:",
        "            min_cluster_size: Minimum tokens per cluster (default from config)",
        "            clustering_method: Algorithm to use for clustering.",
        "                - 'louvain' (default): Louvain community detection.",
        "                  Recommended for dense graphs. Produces meaningful clusters",
        "                  by optimizing modularity.",
        "                - 'label_propagation': Legacy label propagation algorithm.",
        "                  May produce mega-clusters on dense graphs (not recommended).",
        "            cluster_strictness: For label_propagation only. Controls clustering",
        "                aggressiveness (0.0-1.0, default from config).",
        "                - 1.0: Strict clustering, topics stay separate",
        "                - 0.5: Moderate mixing, allows some cross-topic clustering",
        "                - 0.0: Minimal clustering, most tokens group together",
        "            bridge_weight: For label_propagation only. Weight for synthetic",
        "                inter-document connections (0.0-1.0).",
        "                - Higher values (>1.0): More, smaller clusters",
        "                - Lower values (<1.0): Fewer, larger clusters",
        "            verbose: Print progress messages",
        "",
        "        Returns:",
        "            Dictionary mapping cluster_id to list of token contents",
        "",
        "        Example:",
        "            >>> # Default Louvain clustering (recommended)",
        "            >>> clusters = processor.build_concept_clusters()",
        "            >>>",
        "            >>> # Louvain with higher resolution for more clusters"
      ],
      "change_type": "modify"
    },
    {
      "file": "cortical/processor.py",
      "function": "class CorticalTextProcessor:",
      "start_line": 1032,
      "lines_added": [
        "        if resolution is None:",
        "            resolution = self.config.louvain_resolution"
      ],
      "lines_removed": [],
      "context_before": [
        "            >>> # Legacy label propagation (backward compatibility)",
        "            >>> clusters = processor.build_concept_clusters(",
        "            ...     clustering_method='label_propagation',",
        "            ...     cluster_strictness=0.5",
        "            ... )",
        "        \"\"\"",
        "        if min_cluster_size is None:",
        "            min_cluster_size = self.config.min_cluster_size",
        "        if cluster_strictness is None:",
        "            cluster_strictness = self.config.cluster_strictness"
      ],
      "context_after": [
        "",
        "        if clustering_method == 'louvain':",
        "            clusters = analysis.cluster_by_louvain(",
        "                self.layers[CorticalLayer.TOKENS],",
        "                min_cluster_size=min_cluster_size,",
        "                resolution=resolution",
        "            )",
        "        elif clustering_method == 'label_propagation':",
        "            clusters = analysis.cluster_by_label_propagation(",
        "                self.layers[CorticalLayer.TOKENS],"
      ],
      "change_type": "add"
    }
  ],
  "hour_of_day": 10,
  "day_of_week": "Saturday",
  "seconds_since_last_commit": -182774,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}