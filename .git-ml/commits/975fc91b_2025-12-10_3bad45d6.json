{
  "hash": "975fc91b67a58bb9cb528d186c38080659a30cfd",
  "message": "Add intent-based code search enhancement tasks (#48-52)",
  "author": "Claude",
  "timestamp": "2025-12-10 13:54:38 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    ".claude/skills/codebase-search/SKILL.md",
    "TASK_LIST.md"
  ],
  "insertions": 158,
  "deletions": 22,
  "hunks": [
    {
      "file": ".claude/skills/codebase-search/SKILL.md",
      "function": null,
      "start_line": 1,
      "lines_added": [
        "This skill enables **meaning-based search** over the Cortical Text Processor codebase. It finds relevant code by understanding intent and concepts, not just exact keyword matching.",
        "",
        "## Key Capabilities",
        "",
        "- **Meaning-based retrieval**: Finds related code even when exact words don't match",
        "- **Query expansion**: Automatically includes related terms via co-occurrence and semantic relations",
        "- **Context-aware**: Uses PageRank, TF-IDF, and concept clustering for relevance",
        "- **No ML required**: Works through graph algorithms on corpus statistics",
        "- Finding implementations: \"how does PageRank work\"",
        "- Locating code by intent: \"where do we handle errors\"",
        "- Understanding relationships: \"what connects to the tokenizer\"",
        "- Exploring concepts: \"authentication and validation\"",
        "Ensure the corpus is indexed:",
        "| Option | Description |",
        "|--------|-------------|",
        "| `--top N` | Number of results (default: 5) |",
        "| `--verbose` | Show full passage text |",
        "| `--expand` | Show query expansion terms |",
        "| `--interactive` | Interactive search mode |",
        "# Find by concept (not exact words)",
        "python scripts/search_codebase.py \"graph importance algorithm\"",
        "# Natural language intent",
        "python scripts/search_codebase.py \"how do we compute term relevance\"",
        "# See what terms the system associates",
        "python scripts/search_codebase.py \"lateral connections\" --expand",
        "1. **Use natural language** - ask questions as you would to a colleague",
        "2. **Check expansion** (`--expand`) - see what related terms are being searched",
        "3. **Broad then narrow** - start general, refine based on results",
        "4. **Interactive mode** - use `/expand`, `/concepts`, `/stats` for exploration"
      ],
      "lines_removed": [
        "This skill enables semantic search over the Cortical Text Processor codebase using the system's own IR algorithms.",
        "- Finding implementations of specific features",
        "- Understanding how algorithms work",
        "- Locating relevant code for modifications",
        "- Discovering related functions and classes",
        "- Exploring the codebase structure",
        "Before using search, ensure the corpus is indexed:",
        "- `--top N` or `-n N`: Number of results (default: 5)",
        "- `--verbose` or `-v`: Show full passage text",
        "- `--expand` or `-e`: Show query expansion terms",
        "- `--interactive` or `-i`: Interactive search mode",
        "# Find PageRank implementation",
        "python scripts/search_codebase.py \"PageRank algorithm implementation\"",
        "# Find bigram handling code",
        "python scripts/search_codebase.py \"bigram separator\" --verbose",
        "# Explore query expansion",
        "python scripts/search_codebase.py \"query expansion semantic\" --expand",
        "1. Use natural language queries - the system understands concepts",
        "2. Check query expansion (`--expand`) to see related terms",
        "3. Start with broad queries, then refine",
        "4. Use interactive mode for exploration sessions"
      ],
      "context_before": [
        "---",
        "name: codebase-search",
        "description: Search the Cortical Text Processor codebase using semantic search. Use when looking for code patterns, understanding how features work, or finding relevant implementations. This skill uses the system's own IR algorithms to search its own codebase (dog-fooding).",
        "allowed-tools: Read, Bash, Glob",
        "---",
        "# Codebase Search Skill",
        ""
      ],
      "context_after": [
        "",
        "## When to Use",
        "",
        "",
        "## Prerequisites",
        "",
        "",
        "```bash",
        "python scripts/index_codebase.py",
        "```",
        "",
        "This creates `corpus_dev.pkl` with the indexed codebase.",
        "",
        "## Search Commands",
        "",
        "### Basic Search",
        "",
        "```bash",
        "python scripts/search_codebase.py \"your query here\"",
        "```",
        "",
        "### Options",
        "",
        "",
        "### Example Queries",
        "",
        "```bash",
        "",
        "",
        "",
        "# Interactive exploration",
        "python scripts/search_codebase.py --interactive",
        "```",
        "",
        "## Understanding Results",
        "",
        "Results include:",
        "- **File:Line** reference (e.g., `cortical/analysis.py:127`)",
        "- **Score** indicating relevance (higher is better)",
        "- **Passage** showing relevant code or text",
        "",
        "## Tips",
        ""
      ],
      "change_type": "modify"
    },
    {
      "file": "TASK_LIST.md",
      "function": "Currently these are always 0 due to the bug.",
      "start_line": 1657,
      "lines_added": [
        "## Intent-Based Code Search Enhancements",
        "",
        "The following tasks enhance the system's ability to understand developer intent and retrieve code by meaning rather than exact keyword matching.",
        "",
        "---",
        "",
        "### 48. Add Code-Aware Tokenization",
        "",
        "**Files:** `cortical/tokenizer.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** High",
        "",
        "**Problem:**",
        "Current tokenizer treats code like prose. It doesn't understand that `getUserCredentials`, `get_user_credentials`, and `fetch user credentials` are semantically equivalent.",
        "",
        "**Solution:**",
        "1. Add `split_identifier()` function to break camelCase and snake_case",
        "2. Expand tokens to include both original and split forms",
        "3. Add programming keyword recognition (function, class, def, return, etc.)",
        "4. Preserve meaningful punctuation context (parentheses for calls, brackets for indexing)",
        "",
        "**Example:**",
        "```python",
        "# Input: \"getUserCredentials\"",
        "# Output tokens: [\"getUserCredentials\", \"get\", \"user\", \"credentials\"]",
        "```",
        "",
        "---",
        "",
        "### 49. Add Synonym/Concept Mapping for Code Patterns",
        "",
        "**Files:** `cortical/semantics.py`, new `cortical/code_concepts.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** High",
        "",
        "**Problem:**",
        "The system doesn't know that \"fetch\", \"get\", \"retrieve\", \"load\" are often interchangeable in code contexts, or that \"auth\", \"authentication\", \"credentials\", \"login\" form a concept cluster.",
        "",
        "**Solution:**",
        "1. Create `CODE_CONCEPT_GROUPS` mapping common programming synonyms",
        "2. Add `expand_code_concepts()` to query expansion",
        "3. Include domain patterns: auth/security, data/storage, network/api, error/exception",
        "",
        "**Concept Groups:**",
        "```python",
        "CODE_CONCEPT_GROUPS = {",
        "    'retrieval': ['get', 'fetch', 'load', 'retrieve', 'read', 'query'],",
        "    'storage': ['save', 'store', 'write', 'persist', 'cache'],",
        "    'auth': ['auth', 'authentication', 'login', 'credentials', 'token', 'session'],",
        "    'error': ['error', 'exception', 'fail', 'catch', 'handle', 'throw'],",
        "    ...",
        "}",
        "```",
        "",
        "---",
        "",
        "### 50. Add Intent-Based Query Understanding",
        "",
        "**Files:** `cortical/query.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** High",
        "",
        "**Problem:**",
        "Natural language queries like \"where do we handle authentication?\" aren't decomposed into searchable intents.",
        "",
        "**Solution:**",
        "1. Add `parse_intent_query()` to extract action + subject + context",
        "2. Map question words to search strategies:",
        "   - \"where\" → location/file search",
        "   - \"how\" → implementation search",
        "   - \"what\" → definition search",
        "   - \"why\" → comment/documentation search",
        "3. Weight results by intent match",
        "",
        "**Example:**",
        "```python",
        "parse_intent_query(\"where do we handle authentication?\")",
        "# Returns: {",
        "#   'action': 'handle',",
        "#   'subject': 'authentication',",
        "#   'intent': 'location',",
        "#   'expanded_terms': ['handle', 'auth', 'authentication', 'login', ...]",
        "# }",
        "```",
        "",
        "---",
        "",
        "### 51. Add Fingerprint Export API",
        "",
        "**Files:** `cortical/processor.py`, `cortical/embeddings.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** Medium",
        "",
        "**Problem:**",
        "No way to export or compare the semantic representation of code blocks.",
        "",
        "**Solution:**",
        "1. Add `get_fingerprint(text)` method returning interpretable vector",
        "2. Add `compare_fingerprints(fp1, fp2)` for similarity scoring",
        "3. Add `explain_fingerprint(fp)` showing top contributing terms",
        "4. Export format includes: term weights, relation types, concept memberships",
        "",
        "**Use Cases:**",
        "- Compare similarity between functions",
        "- Find duplicate/similar code blocks",
        "- Explain why two code blocks are related",
        "",
        "---",
        "",
        "### 52. Optimize Query-to-Corpus Comparison",
        "",
        "**Files:** `cortical/query.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** Medium",
        "",
        "**Problem:**",
        "Each query recomputes expansions and scores against all documents. For interactive use, this should be faster.",
        "",
        "**Solution:**",
        "1. Pre-compute inverted index: term → [(doc_id, position, score)]",
        "2. Use set intersection for initial candidate filtering",
        "3. Only score top candidate documents fully",
        "4. Add `--fast` mode to search script using approximate matching",
        "",
        "**Target:** <100ms query latency for 10K document corpus",
        "",
        "---",
        "",
        "*Updated 2025-12-10*"
      ],
      "lines_removed": [
        "*Updated from comprehensive code review on 2025-12-10*"
      ],
      "context_before": [
        "",
        "**Completed:** 5/13 tasks",
        "**High Priority Remaining:** 0 tasks",
        "**Medium Priority Remaining:** 4 tasks",
        "**Low Priority Remaining:** 4 tasks",
        "",
        "**Total Tests:** 408 (all passing)",
        "",
        "---",
        ""
      ],
      "context_after": [],
      "change_type": "modify"
    }
  ],
  "hour_of_day": 13,
  "day_of_week": "Wednesday",
  "seconds_since_last_commit": -431410,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}