{
  "hash": "821f0d6c10ea82d2da794483dfd02f47db4c5496",
  "message": "Add Task #65: Document metadata prerequisite for search ranking",
  "author": "Claude",
  "timestamp": "2025-12-11 00:05:37 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    "TASK_LIST.md"
  ],
  "insertions": 54,
  "deletions": 1,
  "hunks": [
    {
      "file": "TASK_LIST.md",
      "function": "Add documentation explaining:",
      "start_line": 2117,
      "lines_added": [
        "### 65. Add Document Metadata to Chunk-Based Indexing (Prerequisite)",
        "",
        "**Files:** `scripts/index_codebase.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** High",
        "**Blocks:** #63",
        "",
        "**Problem:**",
        "Chunk-based indexing loses all document metadata, making it impossible to implement document-type boosting for search.",
        "",
        "**Current Code (line 859):**",
        "```python",
        "# Metadata is None - no file_type, no headings, nothing!",
        "documents = [(doc_id, content, None) for doc_id, content in all_docs.items()]",
        "```",
        "",
        "**Additional Gaps:**",
        "1. `index_file()` only extracts metadata for Python files (lines 481-486)",
        "2. Markdown files get no special treatment (no heading extraction)",
        "3. Chunk format doesn't store metadata at all",
        "",
        "**Solution:**",
        "1. Add `doc_type` field to chunk operations:",
        "   ```json",
        "   {\"op\": \"add\", \"doc_id\": \"docs/algorithms.md\", \"doc_type\": \"docs\", \"headings\": [\"PageRank\", \"TF-IDF\"]}",
        "   ```",
        "",
        "2. Extract markdown headings during indexing:",
        "   ```python",
        "   if file_path.suffix == '.md':",
        "       headings = re.findall(r'^##+ (.+)$', content, re.MULTILINE)",
        "       metadata['headings'] = headings",
        "       metadata['doc_type'] = 'docs' if doc_id.startswith('docs/') else 'root_docs'",
        "   ```",
        "",
        "3. Update `ChunkWriter` and `ChunkLoader` to preserve metadata",
        "",
        "4. Pass metadata when building processor from chunks:",
        "   ```python",
        "   documents = [(doc_id, content, metadata) for doc_id, content, metadata in all_docs]",
        "   ```",
        "",
        "**This is a prerequisite for Task #63** - without metadata, we can't boost docs in search.",
        "",
        "---",
        "",
        "**Depends on:** #65"
      ],
      "lines_removed": [],
      "context_before": [
        "- Example commands",
        "",
        "---",
        "",
        "## Dog-Fooding Findings (2025-12-10)",
        "",
        "The following issues were identified during a dog-fooding session reviewing the docs folder and testing search quality.",
        "",
        "---",
        ""
      ],
      "context_after": [
        "### 63. Improve Search Ranking for Documentation Files",
        "",
        "**Files:** `cortical/query.py`, `scripts/search_codebase.py`",
        "**Status:** [ ] Not Started",
        "**Priority:** High",
        "",
        "**Problem:**",
        "When searching for conceptual terms like \"PageRank algorithm\" or \"4-layer architecture\", the search returns code implementations (processor.py) instead of documentation files (docs/algorithms.md, docs/architecture.md) that explicitly explain these concepts.",
        "",
        "**Observed Behavior:**",
        "```bash",
        "$ python scripts/search_codebase.py \"PageRank algorithm\"",
        "# Returns: cortical/processor.py:578 (score: 1.904)",
        "# Expected: docs/algorithms.md (has \"PageRank - Importance Scoring\" section)",
        ""
      ],
      "change_type": "add"
    },
    {
      "file": "TASK_LIST.md",
      "function": "def get_doc_type(doc_id: str) -> str:",
      "start_line": 2211,
      "lines_added": [
        "| 65 | High | Add document metadata to chunk indexing | [ ] Not Started | Infrastructure |",
        "**Dependency Chain:** #65 → #63 → #64",
        "",
        "**Key Insight:** The dog-fooding loop isn't complete - documentation was indexed but doesn't surface well in search results. The \"better docs → better search\" feedback loop requires:",
        "1. **Infrastructure** (#65): Store document metadata (file type, headings) in chunks",
        "2. **Ranking** (#63): Use metadata to boost docs for conceptual queries",
        "3. **UX** (#64): Show document types in search results"
      ],
      "lines_removed": [
        "**Key Insight:** The dog-fooding loop isn't complete - documentation was indexed but doesn't surface well in search results. The \"better docs → better search\" feedback loop requires search improvements to actually prefer documentation for conceptual queries."
      ],
      "context_before": [
        "    else:",
        "        return 'CODE'",
        "```",
        "",
        "---",
        "",
        "## Dog-Fooding Summary",
        "",
        "| # | Priority | Task | Status | Category |",
        "|---|----------|------|--------|----------|"
      ],
      "context_after": [
        "| 63 | High | Improve search ranking for docs | [ ] Not Started | Search Quality |",
        "| 64 | Low | Add document type indicator | [ ] Not Started | UX |",
        "",
        "",
        "---",
        "",
        "## Code Review Summary (PR #23)",
        "",
        "| # | Priority | Task | Status | Category |",
        "|---|----------|------|--------|----------|",
        "| 59 | Low | Rename TimeoutError to avoid shadowing | [ ] Not Started | Code Quality |",
        "| 60 | Medium | Add Windows compatibility for timeout | [ ] Not Started | Compatibility |",
        "| 61 | Low | Add chunk size warning | [ ] Not Started | UX |"
      ],
      "change_type": "modify"
    }
  ],
  "hour_of_day": 0,
  "day_of_week": "Thursday",
  "seconds_since_last_commit": -394751,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}