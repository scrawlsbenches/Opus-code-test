{
  "hash": "aac63a7db2569be2364dfa9c518612c3f8ceb274",
  "message": "feat: Add comprehensive delegation command template",
  "author": "Claude",
  "timestamp": "2025-12-15 13:19:53 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    ".claude/commands/delegate.md"
  ],
  "insertions": 165,
  "deletions": 0,
  "hunks": [
    {
      "file": ".claude/commands/delegate.md",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "# Delegated Task: $ARGUMENTS",
        "",
        "You are a delegated agent with NO prior context. Everything you need is in this prompt.",
        "",
        "---",
        "",
        "## ENVIRONMENT",
        "",
        "```",
        "Working Directory: /home/user/Opus-code-test",
        "Project: Cortical Text Processor (Python library for hierarchical text analysis)",
        "Key Docs: CLAUDE.md (read first if unsure about anything)",
        "```",
        "",
        "## SETUP (always do this first)",
        "",
        "```bash",
        "cd /home/user/Opus-code-test",
        "git fetch origin",
        "git status",
        "```",
        "",
        "If the task mentions a specific branch, checkout that branch:",
        "```bash",
        "git checkout <branch-name>",
        "```",
        "",
        "---",
        "",
        "## TASK CLASSIFICATION",
        "",
        "Based on the task description, identify the type:",
        "",
        "| Type | Keywords | Mode | Output |",
        "|------|----------|------|--------|",
        "| **sanity-check** | \"sanity\", \"verify\", \"pre-merge\" | READ-ONLY | PASS/FAIL table |",
        "| **code-review** | \"review\", \"audit\", \"check code\" | READ-ONLY | Findings list |",
        "| **investigate** | \"why\", \"debug\", \"find\", \"understand\" | READ-ONLY | Analysis report |",
        "| **test** | \"test\", \"coverage\", \"add tests\" | WRITE | Test files + results |",
        "| **fix** | \"fix\", \"bug\", \"broken\", \"error\" | WRITE | Fix + verification |",
        "| **implement** | \"add\", \"create\", \"implement\", \"build\" | WRITE | Code + tests |",
        "",
        "---",
        "",
        "## TASK-SPECIFIC GUIDANCE",
        "",
        "### For SANITY-CHECK tasks:",
        "```bash",
        "# 1. Verify clean state",
        "git status --short",
        "",
        "# 2. Check dependencies",
        "python /home/user/Opus-code-test/scripts/run_tests.py --check-deps",
        "",
        "# 3. Run smoke tests",
        "python /home/user/Opus-code-test/scripts/run_tests.py smoke -q",
        "",
        "# 4. Verify key commands work (if ML-related)",
        "python /home/user/Opus-code-test/scripts/ml_data_collector.py stats",
        "```",
        "",
        "### For CODE-REVIEW tasks:",
        "1. Identify files to review: `git diff --name-only origin/main..HEAD`",
        "2. Read each file, focusing on:",
        "   - Logic errors",
        "   - Edge cases not handled",
        "   - Security issues",
        "   - Performance concerns",
        "3. Do NOT make changes - report findings only",
        "",
        "### For INVESTIGATE tasks:",
        "1. Reproduce the issue first",
        "2. Read relevant code (use absolute paths)",
        "3. Form hypothesis",
        "4. Verify hypothesis with targeted tests",
        "5. Report root cause and recommended fix",
        "",
        "### For TEST tasks:",
        "1. Check current coverage: `python -m coverage report --include=\"cortical/*\"`",
        "2. Identify untested paths in target module",
        "3. Create test file at `tests/unit/test_<module>.py`",
        "4. Run new tests: `python -m unittest tests.unit.test_<module> -v`",
        "5. Verify coverage improved",
        "",
        "### For FIX tasks:",
        "1. Reproduce the bug first",
        "2. Write a failing test that captures the bug",
        "3. Implement the fix",
        "4. Verify test now passes",
        "5. Run smoke tests to check for regressions",
        "",
        "### For IMPLEMENT tasks:",
        "1. Read CLAUDE.md for patterns and conventions",
        "2. Check for similar implementations in codebase",
        "3. Implement following existing patterns",
        "4. Add tests for new code",
        "5. Update documentation if needed",
        "",
        "---",
        "",
        "## UNIVERSAL RULES",
        "",
        "1. **Absolute paths only** - Always use `/home/user/Opus-code-test/...`",
        "2. **Never use `cd`** after setup - it persists and causes confusion",
        "3. **Distinguish issues**:",
        "   - ENV issue: missing dependency, permissions (not your fault)",
        "   - CODE issue: bug, test failure, syntax error (report this)",
        "4. **No hallucinating** - If a file doesn't exist, say so",
        "5. **Ask if stuck** - If task is ambiguous, state assumptions clearly",
        "",
        "---",
        "",
        "## OUTPUT FORMAT",
        "",
        "Always end with a structured report:",
        "",
        "```markdown",
        "## Delegation Report",
        "",
        "**Task:** [one-line summary]",
        "**Type:** [sanity-check|code-review|investigate|test|fix|implement]",
        "**Branch:** [branch name or \"main\"]",
        "",
        "### Results",
        "",
        "| Check/Action | Status | Notes |",
        "|--------------|--------|-------|",
        "| ... | PASS/FAIL/SKIP | ... |",
        "",
        "### Findings (if any)",
        "- Finding 1: ...",
        "- Finding 2: ...",
        "",
        "### Changes Made (if WRITE mode)",
        "- File 1: [created|modified] - description",
        "- File 2: ...",
        "",
        "### Verdict",
        "**[PASS|FAIL|NEEDS-REVIEW]**: [one sentence summary]",
        "",
        "### Recommended Next Steps (if any)",
        "1. ...",
        "2. ...",
        "```",
        "",
        "---",
        "",
        "## FAILURE HANDLING",
        "",
        "| Problem | Action |",
        "|---------|--------|",
        "| pytest not installed | Use `python -m unittest discover -s tests -v` instead |",
        "| coverage not installed | Skip coverage, note as ENV limitation |",
        "| File not found | Verify path, check if on correct branch |",
        "| Permission denied | Note as ENV issue, not code problem |",
        "| Tests fail | Report which tests, include error output |",
        "| Ambiguous task | State your interpretation, proceed with assumptions noted |",
        "",
        "---",
        "",
        "## NOW EXECUTE",
        "",
        "Task: $ARGUMENTS",
        "",
        "Begin by classifying the task type, then follow the appropriate guidance above."
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    }
  ],
  "hour_of_day": 13,
  "day_of_week": "Monday",
  "seconds_since_last_commit": -1495,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}