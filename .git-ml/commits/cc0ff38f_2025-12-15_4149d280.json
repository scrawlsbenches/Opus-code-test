{
  "hash": "cc0ff38fd9a0f2160e09a1c107452a553a51c977",
  "message": "feat: Add reusable pre-merge sanity check command",
  "author": "Claude",
  "timestamp": "2025-12-15 13:11:40 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    ".claude/commands/sanity-check.md"
  ],
  "insertions": 79,
  "deletions": 0,
  "hunks": [
    {
      "file": ".claude/commands/sanity-check.md",
      "function": null,
      "start_line": 0,
      "lines_added": [
        "# Pre-merge sanity check for branch: $ARGUMENTS",
        "",
        "You have NO prior context. This is a fresh thread.",
        "",
        "## SETUP (do this first)",
        "",
        "```bash",
        "cd /home/user/Opus-code-test",
        "git fetch origin $ARGUMENTS",
        "git checkout $ARGUMENTS",
        "```",
        "",
        "## CHECKS (use absolute paths throughout)",
        "",
        "Run these in order, report results for each:",
        "",
        "1. **Git status** - should be clean",
        "   ```bash",
        "   git status --short",
        "   ```",
        "",
        "2. **Check test dependencies**",
        "   ```bash",
        "   python /home/user/Opus-code-test/scripts/run_tests.py --check-deps",
        "   ```",
        "",
        "3. **Run smoke tests**",
        "   ```bash",
        "   python /home/user/Opus-code-test/scripts/run_tests.py smoke -q",
        "   ```",
        "   - If pytest missing and can't install, try: `python -m unittest discover -s tests/smoke -v`",
        "",
        "4. **Verify ML collector commands work** (if applicable)",
        "   ```bash",
        "   python /home/user/Opus-code-test/scripts/ml_data_collector.py stats",
        "   python /home/user/Opus-code-test/scripts/ml_data_collector.py quality-report",
        "   ```",
        "",
        "5. **Check for syntax errors in new/modified files**",
        "   ```bash",
        "   git diff --name-only origin/main..HEAD -- '*.py' | head -10",
        "   # Then for each: python -m py_compile <file>",
        "   ```",
        "",
        "## RULES",
        "",
        "- Use ABSOLUTE paths only (never relative paths)",
        "- Do NOT use `cd` after setup - it persists and causes confusion",
        "- Distinguish between:",
        "  - **ENV issues**: missing pytest, permissions, etc. (not PR's fault)",
        "  - **CODE issues**: actual bugs, syntax errors, failing tests (PR's fault)",
        "- Do NOT make any changes - this is read-only verification",
        "",
        "## REPORT FORMAT",
        "",
        "```",
        "## Sanity Check: <branch-name>",
        "",
        "| Check | Result | Notes |",
        "|-------|--------|-------|",
        "| Git status | PASS/FAIL | |",
        "| Dependencies | PASS/FAIL | |",
        "| Smoke tests | PASS/FAIL | |",
        "| ML commands | PASS/FAIL/SKIP | |",
        "| Syntax check | PASS/FAIL | |",
        "",
        "**Verdict: PASS** (ready to merge)",
        "-- or --",
        "**Verdict: FAIL** (issues found)",
        "- Issue 1: ...",
        "- Issue 2: ...",
        "```",
        "",
        "## CLEANUP",
        "",
        "When done, return to original branch:",
        "```bash",
        "git checkout -",
        "```"
      ],
      "lines_removed": [],
      "context_before": [],
      "context_after": [],
      "change_type": "add"
    }
  ],
  "hour_of_day": 13,
  "day_of_week": "Monday",
  "seconds_since_last_commit": -1988,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}