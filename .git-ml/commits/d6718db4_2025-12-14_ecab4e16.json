{
  "hash": "d6718db4ec84fa9a5a90cfb8cabe6c8ee816cf97",
  "message": "fix: Update skipped tests for processor/ package refactor",
  "author": "Claude",
  "timestamp": "2025-12-14 15:19:25 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    "CLAUDE.md",
    "tests/test_generate_ai_metadata.py"
  ],
  "insertions": 79,
  "deletions": 14,
  "hunks": [
    {
      "file": "CLAUDE.md",
      "function": "class TestYourFeature(unittest.TestCase):",
      "start_line": 665,
      "lines_added": [
        "### Intentionally Skipped Tests",
        "",
        "Some tests are designed to skip under certain conditions. This is intentional, not a bug:",
        "",
        "| Test File | Skip Condition | Reason |",
        "|-----------|----------------|--------|",
        "| `tests/unit/test_protobuf_serialization.py` | `protobuf` not installed | Optional dependency for cross-language serialization |",
        "| `tests/test_evaluate_cluster.py` | `samples/` missing or < 5 files | Integration test requiring sample corpus |",
        "| `tests/unit/test_suggest_tasks.py` | `task_utils` not available | Optional task management feature |",
        "",
        "**Pattern for optional dependencies:**",
        "```python",
        "try:",
        "    from cortical.proto.serialization import to_proto, from_proto",
        "    PROTOBUF_AVAILABLE = True",
        "except ImportError:",
        "    PROTOBUF_AVAILABLE = False",
        "",
        "@unittest.skipIf(not PROTOBUF_AVAILABLE, \"protobuf package not installed\")",
        "class TestProtobufSerialization(unittest.TestCase):",
        "    ...",
        "```",
        "",
        "**Pattern for conditional resources:**",
        "```python",
        "def setUp(self):",
        "    if not os.path.exists(self.required_resource):",
        "        self.skipTest(\"Required resource not available\")",
        "```",
        ""
      ],
      "lines_removed": [],
      "context_before": [
        "| `fresh_processor` | function | Empty processor for isolated tests |",
        "| `small_corpus_docs` | function | Raw document dict |",
        "",
        "**Always test:**",
        "- Empty corpus case",
        "- Single document case",
        "- Multiple documents case",
        "- Edge cases specific to your feature",
        "- Add regression test if fixing a bug",
        ""
      ],
      "context_after": [
        "### CI/CD Best Practices",
        "",
        "**CRITICAL: Pytest runs unittest-based tests natively!**",
        "",
        "Never run both pytest and unittest on the same test files - this doubles CI time:",
        "",
        "```bash",
        "# âŒ WRONG - runs tests twice (doubles CI time from ~7min to ~15min+)",
        "coverage run -m pytest tests/",
        "coverage run --append -m unittest discover -s tests"
      ],
      "change_type": "add"
    },
    {
      "file": "tests/test_generate_ai_metadata.py",
      "function": "def test_func():",
      "start_line": 529,
      "lines_added": [
        "    def test_cortical_processor_package_metadata(self):",
        "        \"\"\"Test metadata generation for cortical/processor/ package modules.",
        "",
        "        Note: processor.py was refactored into processor/ package with mixins",
        "        as part of LEGACY-095. This test now checks the compute.py module",
        "        which contains the ComputeMixin class and compute_all method.",
        "        \"\"\"",
        "        # Test the compute module which has ComputeMixin and compute_all",
        "        compute_path = os.path.join(",
        "            '..', 'cortical', 'processor', 'compute.py'",
        "        if not os.path.exists(compute_path):",
        "            self.skipTest(\"processor/compute.py not found\")",
        "        analyzer = ModuleAnalyzer(compute_path)",
        "        # Should find the ComputeMixin class",
        "        self.assertIn('ComputeMixin', metadata['classes'])",
        "        # Should find compute_all method (may be listed as function or method)",
        "        self.assertTrue(",
        "            any('compute_all' in name for name in func_names),",
        "            f\"compute_all not found in functions: {func_names}\"",
        "        )",
        "        compute_all_keys = [k for k in func_names if 'compute_all' in k]",
        "        if compute_all_keys:",
        "            self.assertIn('complexity', metadata['functions'][compute_all_keys[0]])",
        "",
        "    def test_cortical_processor_documents_metadata(self):",
        "        \"\"\"Test metadata generation for processor/documents.py module.",
        "",
        "        This module contains DocumentsMixin with process_document method.",
        "        \"\"\"",
        "        documents_path = os.path.join(",
        "            os.path.dirname(__file__),",
        "            '..', 'cortical', 'processor', 'documents.py'",
        "        )",
        "",
        "        if not os.path.exists(documents_path):",
        "            self.skipTest(\"processor/documents.py not found\")",
        "",
        "        analyzer = ModuleAnalyzer(documents_path)",
        "        metadata = analyzer.generate_metadata()",
        "",
        "        # Should find the DocumentsMixin class",
        "        self.assertIn('DocumentsMixin', metadata['classes'])",
        "",
        "        # Should find process_document method",
        "        func_names = list(metadata['functions'].keys())",
        "        self.assertTrue(",
        "            any('process_document' in name for name in func_names),",
        "            f\"process_document not found in functions: {func_names}\"",
        "        )"
      ],
      "lines_removed": [
        "    def test_cortical_processor_metadata(self):",
        "        \"\"\"Test metadata generation for actual cortical/processor.py.\"\"\"",
        "        processor_path = os.path.join(",
        "            '..', 'cortical', 'processor.py'",
        "        if not os.path.exists(processor_path):",
        "            self.skipTest(\"processor.py not found\")",
        "        analyzer = ModuleAnalyzer(processor_path)",
        "        # Should find the main class",
        "        self.assertIn('CorticalTextProcessor', metadata['classes'])",
        "        # Should find key functions",
        "        self.assertTrue(any('process_document' in name for name in func_names))",
        "        self.assertTrue(any('compute_all' in name for name in func_names))",
        "        compute_all_key = [k for k in func_names if 'compute_all' in k][0]",
        "        self.assertIn('complexity', metadata['functions'][compute_all_key])"
      ],
      "context_before": [
        "        yaml_content = generate_metadata_for_file(self.test_file)",
        "",
        "        # Empty file still has 1 line (empty string split gives [''])",
        "        self.assertIn('lines: 1', yaml_content)",
        "        self.assertIn('functions: {}', yaml_content)",
        "",
        "",
        "class TestIntegration(unittest.TestCase):",
        "    \"\"\"Integration tests for the metadata generator.\"\"\"",
        ""
      ],
      "context_after": [
        "            os.path.dirname(__file__),",
        "        )",
        "",
        "",
        "        metadata = analyzer.generate_metadata()",
        "",
        "",
        "        func_names = list(metadata['functions'].keys())",
        "",
        "        # Should have complexity hints for expensive functions",
        "",
        "",
        "if __name__ == '__main__':",
        "    unittest.main()"
      ],
      "change_type": "modify"
    }
  ],
  "hour_of_day": 15,
  "day_of_week": "Sunday",
  "seconds_since_last_commit": -80723,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}