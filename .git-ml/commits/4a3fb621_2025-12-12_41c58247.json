{
  "hash": "4a3fb621bc6da66fced3e3f567d2035c6aa523f6",
  "message": "Remove TestShowcaseCorpusRegression: redundant slow tests",
  "author": "Claude",
  "timestamp": "2025-12-12 12:15:45 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    "tests/test_analysis.py"
  ],
  "insertions": 0,
  "deletions": 106,
  "hunks": [
    {
      "file": "tests/test_analysis.py",
      "function": "class TestClusteringQualityRegression(unittest.TestCase):",
      "start_line": 513,
      "lines_added": [],
      "lines_removed": [
        "class TestShowcaseCorpusRegression(unittest.TestCase):",
        "    \"\"\"Regression tests using the full showcase corpus (Task #124).",
        "",
        "    These tests ensure that clustering produces expected results on the",
        "    actual showcase corpus, which contains 100+ documents across multiple",
        "    domains (ML, cooking, law, astronomy, customer service, etc.).",
        "    \"\"\"",
        "",
        "    @classmethod",
        "    def setUpClass(cls):",
        "        \"\"\"Load the showcase corpus once for all tests.\"\"\"",
        "        from pathlib import Path",
        "",
        "        cls.processor = CorticalTextProcessor()",
        "        samples_dir = Path(__file__).parent.parent / 'samples'",
        "",
        "        if not samples_dir.exists():",
        "            cls.skip_reason = \"samples/ directory not found\"",
        "            return",
        "",
        "        txt_files = list(samples_dir.glob('*.txt'))",
        "        if len(txt_files) < 10:",
        "            cls.skip_reason = f\"Only {len(txt_files)} sample files found, need at least 10\"",
        "            return",
        "",
        "        cls.skip_reason = None",
        "        for f in txt_files:",
        "            cls.processor.process_document(f.stem, f.read_text())",
        "",
        "        cls.processor.compute_all(verbose=False)",
        "",
        "    def setUp(self):",
        "        \"\"\"Skip if corpus not available.\"\"\"",
        "        if hasattr(self.__class__, 'skip_reason') and self.__class__.skip_reason:",
        "            self.skipTest(self.__class__.skip_reason)",
        "",
        "    def test_showcase_produces_expected_cluster_count(self):",
        "        \"\"\"Regression test: 100+ docs should produce 15+ clusters.",
        "",
        "        The showcase corpus contains documents from many distinct domains.",
        "        With Louvain community detection, we expect at least 15 clusters",
        "        to capture the domain diversity.",
        "",
        "        Note: This threshold is conservative. Current implementation produces",
        "        ~35 clusters for ~100 documents.",
        "        \"\"\"",
        "        layer2 = self.processor.layers[CorticalLayer.CONCEPTS]",
        "",
        "        self.assertGreaterEqual(",
        "            layer2.column_count(), 15,",
        "            f\"Showcase corpus ({len(self.processor.documents)} docs) should produce \"",
        "            f\"at least 15 clusters, got {layer2.column_count()}\"",
        "        )",
        "",
        "    def test_showcase_no_mega_cluster(self):",
        "        \"\"\"Regression test: No single cluster should dominate the showcase corpus.",
        "",
        "        Even though the showcase corpus is large and diverse, label propagation",
        "        would converge to 1-3 giant clusters. With Louvain, we expect no single",
        "        cluster to contain more than 20% of all tokens.",
        "        \"\"\"",
        "        layer0 = self.processor.layers[CorticalLayer.TOKENS]",
        "        layer2 = self.processor.layers[CorticalLayer.CONCEPTS]",
        "",
        "        total_tokens = layer0.column_count()",
        "        max_cluster_size = max(",
        "            len(c.feedforward_connections)",
        "            for c in layer2.minicolumns.values()",
        "        )",
        "",
        "        cluster_ratio = max_cluster_size / total_tokens",
        "        self.assertLess(",
        "            cluster_ratio, 0.20,",
        "            f\"Largest cluster contains {cluster_ratio:.1%} of tokens in showcase corpus. \"",
        "            f\"Expected no cluster to dominate with >20% of tokens.\"",
        "        )",
        "",
        "    def test_showcase_cluster_distribution(self):",
        "        \"\"\"Regression test: Clusters should have reasonable size distribution.",
        "",
        "        The showcase corpus should produce clusters of varying sizes,",
        "        not just many tiny clusters or a few large ones.",
        "        \"\"\"",
        "        layer2 = self.processor.layers[CorticalLayer.CONCEPTS]",
        "",
        "        cluster_sizes = [",
        "            len(c.feedforward_connections)",
        "            for c in layer2.minicolumns.values()",
        "        ]",
        "",
        "        # Should have at least 5 clusters with 10+ tokens (non-trivial clusters)",
        "        substantial_clusters = sum(1 for size in cluster_sizes if size >= 10)",
        "        self.assertGreaterEqual(",
        "            substantial_clusters, 5,",
        "            f\"Expected at least 5 substantial clusters (10+ tokens), \"",
        "            f\"got {substantial_clusters}\"",
        "        )",
        "",
        "        # Should have variety in cluster sizes (not all same size)",
        "        unique_sizes = len(set(cluster_sizes))",
        "        self.assertGreater(",
        "            unique_sizes, 3,",
        "            f\"Cluster sizes should vary. Only {unique_sizes} unique sizes found.\"",
        "        )",
        "",
        ""
      ],
      "context_before": [
        "        # At least 50% of clusters should be semantically coherent",
        "        if total_clusters > 0:",
        "            coherent_ratio = coherent_clusters / total_clusters",
        "            self.assertGreaterEqual(",
        "                coherent_ratio, 0.5,",
        "                f\"Only {coherent_ratio:.1%} of clusters are semantically coherent \"",
        "                f\"(have internal connections). Expected at least 50%.\"",
        "            )",
        "",
        ""
      ],
      "context_after": [
        "class TestClusteringQualityMetrics(unittest.TestCase):",
        "    \"\"\"Tests for clustering quality metrics (Task #125).",
        "",
        "    Tests modularity, silhouette, and balance computation.",
        "    \"\"\"",
        "",
        "    def test_quality_metrics_empty_processor(self):",
        "        \"\"\"Test quality metrics with empty processor.\"\"\"",
        "        processor = CorticalTextProcessor()",
        "        quality = processor.compute_clustering_quality()"
      ],
      "change_type": "delete"
    }
  ],
  "hour_of_day": 12,
  "day_of_week": "Friday",
  "seconds_since_last_commit": -264543,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}