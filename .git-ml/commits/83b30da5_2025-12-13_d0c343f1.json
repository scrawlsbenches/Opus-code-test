{
  "hash": "83b30da53dcd3e2d7b4adf6643de629db1da470d",
  "message": "Add 'Changing Validation Logic' guidelines to prevent scattered test failures",
  "author": "Claude",
  "timestamp": "2025-12-13 11:22:27 +0000",
  "branch": "claude/multi-index-design-DvifZ",
  "files_changed": [
    "CLAUDE.md"
  ],
  "insertions": 27,
  "deletions": 0,
  "hunks": [
    {
      "file": "CLAUDE.md",
      "function": "processor.add_document_incremental(doc_id, text)",
      "start_line": 332,
      "lines_added": [
        "### Changing Validation Logic (IMPORTANT!)",
        "",
        "When modifying validation rules (e.g., parameter ranges, input constraints), **tests are scattered across multiple files**. Missing any will cause CI failures.",
        "",
        "**Before changing validation:**",
        "```bash",
        "# Find ALL tests related to the parameter/function you're changing",
        "# Example: changing alpha parameter validation",
        "grep -rn \"alpha\" tests/ | grep -i \"invalid\\|error\\|raise\\|ValueError\"",
        "",
        "# More specific patterns:",
        "grep -rn \"alpha.*0\\|alpha.*1\\|invalid.*alpha\" tests/",
        "```",
        "",
        "**Checklist for validation changes:**",
        "1. ✅ Search for the parameter name + \"invalid\", \"error\", \"raise\", \"ValueError\" in tests/",
        "2. ✅ Check both `tests/unit/` AND legacy `tests/test_*.py` files",
        "3. ✅ Check `tests/test_coverage_gaps.py` (often has validation edge cases)",
        "4. ✅ Update ALL matching tests, not just the first one found",
        "5. ✅ Run full test suite locally before pushing: `python -m pytest tests/ -v`",
        "",
        "**Example: Changing alpha from (0, 1] to [0, 1]**",
        "```bash",
        "# This finds tests expecting alpha=0 to be invalid:",
        "grep -rn \"alpha.*0\\.0\\|alpha.*=.*0[^.]\\|exclusive of 0\" tests/",
        "```",
        ""
      ],
      "lines_removed": [],
      "context_before": [
        "# WRONG - may be using stale data",
        "if processor.is_stale(processor.COMP_PAGERANK):",
        "    # PageRank values may be outdated!",
        "    pass",
        "",
        "# CORRECT - ensure freshness",
        "if processor.is_stale(processor.COMP_PAGERANK):",
        "    processor.compute_importance()",
        "```",
        ""
      ],
      "context_after": [
        "### Staleness Tracking System",
        "",
        "The processor tracks which computations are up-to-date vs needing recalculation. This prevents unnecessary recomputation while ensuring data consistency.",
        "",
        "#### Computation Types",
        "",
        "| Constant | What it tracks | Computed by |",
        "|----------|---------------|-------------|",
        "| `COMP_TFIDF` | TF-IDF scores per term | `compute_tfidf()` |",
        "| `COMP_PAGERANK` | PageRank importance | `compute_importance()` |"
      ],
      "change_type": "add"
    }
  ],
  "hour_of_day": 11,
  "day_of_week": "Saturday",
  "seconds_since_last_commit": -181341,
  "is_merge": false,
  "is_initial": false,
  "parent_count": 1,
  "session_id": null,
  "related_chats": [],
  "ci_result": null,
  "reverted": false,
  "amended": false
}